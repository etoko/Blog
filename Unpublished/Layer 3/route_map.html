<h1>Route-maps</h1>
<p>
Route-maps provide If/Then/Else logic like in programming languages. 
Route-maps are very flexible in matching prefixes. 
A single route-map consists of a series of route-map statements with the same name
but uniquely identified using its sequence number. When a route is matched
by a route-map statement, either as a permit or deny, processing stops of the  
route-map.
</p>
<p>
A route-map statement references an ACL or prefix-list to match against a route
with the action to take i.e.,permit or deny. 
</p>
<p>
A single route-map contains one or more route-map commands (entries). Each route-map 
entry has underlying matching parameters, configured with the <code><b>match</b></code>
command.
</p>
<p>
The flexibility of route maps means that they can be utilized in many routing 
scenarios such as the following:
<ul>
  <li>Attribute manipulation in BGP</li>
  <li>Route tagging in routing protocols such as OSPF</li>
  <li>Policy based routing(PBR)</li>
</ul>
</p>

<h1>Matching Prefixes Using Route-maps</h1>
<p>
When configuring a route-map, the first action should be a match statement.
Route-maps use the following 
features to match routes:
<ul>
  <li>Access control lists</li>
  <li>Prefix-lists</li>
  <li>Route-type</li>
  <li>Metric, metric type</li>
  <li>Next hop</li>
  <li>BGP attributes</li>
</ul>
</p>
<p>
Actions consist of permit or deny. 
If a route-map references an ACL or prefix-list, the ACL and prefix-list permit 
statement means match this prefix. The deny statement means do not match the 
prefix.

Route-maps have an implicity deny all statement at the end.
Route-maps support modifying prefix attributes. This is heavily utilized in BGP.
</p>
<p>
Processing of route-maps starts with the lowest sequence number and proceeds 
sequentially, until a match statement; processing then stops. However, if a 
route-map statement has the "continue" keyword, processing continues in spite 
of the match statement. The <code><b>code</b></code> continue keyword is used in 
route-map statements when logical "AND" processing is needed.
</p>
<p>
When configuring filtering using prefix lists, only one prefix list can be used 
for filtering per direction(ingress or egress). However, when filtering using 
route maps, a route map can be configured with many statements each using different 
prefix lists.
</p>

<h2>Sequence numbers</h2>
<p>
The first route map statement a sequence number of 10 by default. Route-maps do not 
automatically increment the sequence number like ACLs. If no sequence number is 
entered, subsequent statements  overwrite the first statement.
</p>
<p>

<!--
Task 1: Permit /24 to /27 from 192.168.0.0/16

ip prefix-list PL1 permit 192.168.0.0/16 ge 24 le 27

route-map RM1 permit 10
  match ip address prefix-list PL1
</p>
<p>
Deny /24 to /27 from 192.168.0.0/16 if routes are internal. Allow external routes 
from the same range:
<code><b>
ip prefox-list PL1 permit 192.168.0.0/16 ge 24 le 27
route-map RM2 deny 10
  match ip address prefix-list PL1
  match route-type internal
route-map RM2 permit 20
  match ip address prefix-list PL1
  match route-type external
</b></code>
</p>

--->
</p>


<h1>Configuration</h1>

<ol>

<li><b>Define the route map:</b>
The route map is defined by specifying the route map name, processing action and 
sequence number. The command used is <code><b>route-map &lt;route-map-name&gt; 
[permit | deny] &lt;sequence-number&gt;</b></code>.

</li>
<li><b>Matching</b>
<p>
Route mps use ACLs or prefix-lists match the prefixes. The route-map tells what to do with the 
matched routes using permit or deny. A permit action in the ACL or 
prefix list means match the prefix and a deny action means do not match the prefix.
All ACLs types are supported i.e., named or numbered standard and extended ACLs. 
</p>
<p>
Matching is done using the command 
<code><b>match ip address [1-199 | 1300 - 1699 | acl-name | prefix-list &lt;prefix-list-name&gt;]</b></code>.
</p>
<p>
A route-map without the match statement is equivalent to match any.
</p>

<p>
When processing a route-map, the processing starts at the top with the lowest 
sequence number and progress sequentially. The first successful match ends 
the execution of the prefix-list except if the continue statement is used.
A deny statement in the ACL/Prefix list that is referenced by a permit statement 
in the RM results in no match and execution of the RM moves to the next RM 
sequence number.
</p>

<p>
When matching prefixes, it is possible to chain ACLs or prefixes using the <code>
<b>match ip address &lt;acl-1&gt; &lt;acl-2&gt; &lt;acl-2&gt;</b></code> command.
This represents and OR function where matching is done successfully if any of the 
ACLs is matched.
</p>
</li>
<li><b>Specify the action to be carried out on matched routes (Optional):</b>
This is implemented using the <code><b>set</b></code> command.
</li>
<li><b>Application of Route Maps</b>
<p>
Where route maps are applied depends on what they will be used for:
<ul>
  <li>To manipulate BGP attributes, apply it to BGP</li>
  <li>For PBG, use the <code><b>policy</b></code> command under the interface</li>
  
</ul>
</p>

</li>

</ol>


<h1>Verification</h1>
<p>

</p>

<h2><code>show route-map</code></h2>
<p>

</p>

