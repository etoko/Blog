 <h1>Configuring MPLS Layer 3 VPN on Cisco IOS</h1>
 
<h1>Introduction</h1>
<p>
MPLS Layer 3 VPNs (L3VPNs) are used by service providers (SPs) to provide for 
the ability for a enterprise to share routes between the enterprise’s different sites
through the service provider's network. MPLS L3VPNs are defined by RFC 4364. 

SPs are able to deliver enterprise traffic to different remote sites regardless of 
whether the different enterprise sites use the same IP addresses for example 
Enterprise A uses 10.10.10.0/24 network at site 1 and 10.10.20.0/24 at site 2. 
Enterprise B uses 10.10.20.0/24 at site 1 and 10.10.10.0/24 at site 2. L3VPNs will 
be used to differentiate the traffic and forward it to the appropriate destination. 
Traffic for different enterprises is differentiated using VPNv4 addresses.
</p>
<p>
The following topology will be used to configure MPLS Layer 3 VPNs.

 

</p>
<p>
The routers R2 and R7 in the topology above are referred to as Provider Edge (PE) 
routers or edge Label Switch Routers (LSR). The MPLS network is usually referred 
to as the P network and the enterprise network the C network. All LSRs in the P 
network have MPLS configured. PE routers have VRFs for each enterprise. Enterprise 
Edge (CE) routers have no knowledge of MPLS or VRFs. CE routers connect to Provider
Edge (PE) routers.
</p>
<p>
At the PE routers, a VRF needs to be created for each CE as one PE router may 
connect to many CE routers. Each enterprise’s routes will be separated from other 
enterprises in their own routing table.
</p>
<p>
If a given LSR is to run MP-BGP, ensure that BGP peer address and the MPLS 
router ID match for ease of configuration.
</p>
<p>
Routes learned from CE routers will be redistributed into MultiProtocol BGP 
(MP-BGP) by PE routers. These routes are then shared with the BGP peer across 
the MPLS domain. This BGP peer then redistributes the routes into the interior 
gateway protocol and shares the routes with the CE routers.
</p>
<p>
In Layer 3 MPLS, usually the PE routers or edge LSRs run MP-BGP. The intermediate
LSRs do not run BGP. They only run MPLS. The PE routers form an iBGP neighborship.
PE routers will receive enterprise routes shared from the CE routes usually through 
an IGP neighborship. However, there may be cases where eBGP is run between PE and CE routers.
</p>

<p>
MPLS L3VPNs have two basic components:
  <ol>
    <li>Separation of customer routing information.
      <ul>
        <li>This is implemented through configuration of VRF instances where 
        different customers have different "virtual" routing tables.</li>
        <li>IGP/BGP run inside the VRF between the customer and SP.</li>
      </ul>
      </li>
    <li>Exchange of customer's routing info inside the SP.
    <ul>
      <li>MP-BGP operates through the SP network.</li>
      <li>Traffic is label switched towards BGP next-hops.</li>
    </ul>
    </li>
  </ol>
</p>

<h1>Steps to Create L3VPNs (MPLS)</h1>
<p>
To create L3VPNs, the following steps should be taken.
<ul>
<li>Step 1: Ensure MPLS infrastructure is in place. i.e. IP routing, MPLS.</li>
<li>Step 2: Create the VRFs and associate interfaces with the created VRFs on PE or edge LSRs</li>
<li>Step 3: Configure MP-BGP peerings between the PE routers using VPNv4 address-family.</li>
<li>Step 4: Route Exchange Between the PE and CE devices.</li>
<li>Step 5: Redistribute routes between MP-BGP VRF address-family and PE-CE 
routing protoocol (this is not needed if PE-CE routing uses eBGP).</li>
<li>Step 6: Test connectivity.</li>
</ul>
</p>

<h2>Step 1: Ensure MPLS Infrastructure is in Place</h2>
<p>
Guidance on how to configure an operational MPLS infrastructure can be found 
<a href="https://emmanueltoko.blogspot.com/2021/02/configuring-mpls-in-cisco-ios.html">here</a>.
</p>

<h2>Step 2: Create VRFs on PE Routers</h2>
<p>
Virtual Routing and Forwarding (VRFs) are used to create separate routing tables 
on a router. These routing tables are separated from the global routing table (RIB).
There are two ways to create a VRF; 
<ol>
  <li><code style="font-size:120%;"><b>ip vrf &lt;vrf-name&gt;</b></code> (older method).

  <p>
<div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
      	<code style="font-size:130%">
R1(config)#<b>ip vrf CUST-1</b>                       <br>
R1(config-vrf)#<b>rd 65000:1000                  </b> <br>
R1(config-vrf)#<b>route-target export 65000:1001 </b> <br>
R1(config-vrf)#<b>route-target import 65000:1011 </b> <br>
R1(config-vrf)#<b>ip vrf CUST-2                  </b> <br>
R1(config-vrf)#<b>rd 65000:2000                  </b> <br>
R1(config-vrf)#<b>route-target export 65000:2001 </b> <br>
R1(config-vrf)#<b>route-target import 65000:2011 </b> <br>
</code></div>
</p>

  <p>
Two VRFs CUST-1 and CUST-2 have been created. However, configuring VRFs with the 
<code style="font-size:130%"><b>ip vrf CUST-1</b></code> command results in VRFs defined only for IPv4 
as the command supports IPv4 only. 
If IPv6 is required, the VRFs should be created using the command 
<code style="font-size:130%"><b>vrf definition CUST-1</b></code>.
</p>
  
  </li> 
  <li> <code style="font-size:120%;"><b>vrf definition vrf_name</b></code>.
  <p>
  <div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
      	<code style="font-size:130%">
R7(config)#<b>vrf definition CUST-1_BRANCH           </b> <br>
R7(config-vrf)#<b>rd 65000:1010                      </b> <br>
R7(config-vrf)#<b>address-family ipv4                </b> <br>
R7(config-vrf-af)#<b>route-target export 65000:1011  </b> <br>
R7(config-vrf-af)#<b>route-target import 65000:1001  </b> <br>
R7(config)#<b>vrf definition CUST-2_BRANCH           </b> <br>
R7(config-vrf)#<b>rd 65000:2010                      </b> <br>
R7(config-vrf)#<b>address-family ipv4                </b> <br>
R7(config-vrf-af)#<b>route-target export 65000:2011  </b> <br>
R7(config-vrf-af)#<b>route-target import 65000:2001  </b>
</code></div>
</p>
<p>
Here, two VRFs are created VRF CUST-1_BRANCH and CUST-2_BRANCH. VRF names do not
need to match as they are locally significant.
</p>
  </li>
  </ol>
</p>



<h3>Route Distinguisher (RD)</h3>
<p>
The Route Distinguisher (RD) is a 64-bit(8byte) value usually of the format ASN:nn or 
IP address:nn where ASN is the Autonomous system number and nn is any random 
number. RD is used by the PE to distinguish the different VRFs; to make different 
multiple routes coming from different customers.
It is locally significant and does not need to match on the remote PE.
</p>

<h3>VPNv4</h3>
<p>
The RD is used to create <b>VPNv4 addresses</b>. This is a <b>96-bit</b> value that consists 
of the RD (64bit) and the IP address/network address (32-bit). It is usually in 
the format RD:IP address. An example can be 65000:10000:10.10.20.1. VPNv4 
addresses make addresses from the different enterprises unique. This results in the 
ability of an MPLS SP to route traffic for different enterprises who happen to use
the same network addresses. The VPNv4 addres includes the MPLS VPN label.
</p>
<p>
VPNv4 NLRI main attributes include:
<ul>
  <li>8 byte route distinguisher(RD)</li>
  <li>IPv4 prefix and length</li>
  <li>Next hop</li>
  <li>MPLS VPN lable</li>
</ul>
</p>

<h4>Controlling VPNv4 Routes</h4>
<p>
Route Distingiusher(RD) is used solely to make routes unique. It allows for 
overlapping IPv4 addresses between customers. The new BGP extended community 
attribute "route-target" is used to control what enters/exits the VRF table.
<ul>
  <li><b>export</b> route target: what routes will go from VRF into BGP.</li>
  <li><b>"import"</b> route target: what routes will go from BGP into VRF.</li>
</ul>
It allows for granular control over what sites have what routes; the use of 
route-map "import map" and "export map" allow control on a per prefix basis as an 
alternative to the use of RD.
</p>

<h3>Route Target (RT)</h3>
<p>
A route-target (RT) is a 64-bit value similar in format to the RD i.e. ASN:nn or 
IP addess:nn. It is used by MP-BGP to differentiate the routes from the different 
enterprises. The routes defined in the VRF of one enterprise can be tagged for export
to the remote PE enterprise VRF using the command <code style="font-size:120%;"><b>route-target export ASN:nn</b></code>. To 
import these routes into the appropriate VRF at the remote PE router, the command 
route-target import ASN:nn is used.

The new BGP extended-community Route Target (RT) is used to control what enters/exits 
VRF table. Basically, the RT export command determines what routes will go from 
VRF into BGP; and the RT import command determines what routes will go from BGP into VRF.

RT controls the route’s VPN VRF membership(s). It is possible to have multiple 
RTs per VPNv4 route but one RD per VPNv4 route. VPNv4 speakers only accept VPNv4 
routes with an RT matching a local VRF. Some exceptions include route reflectors. 
VPNv4 routes can have more than one RT. This allows for complex VPN topologies 
such as full mesh, hub and spoke, central services.

In the VRF creation command snippet; <code style="font-size:120%;"><b>R1(config-vrf)#route-target export 65000:2001</b></code> 
is used, on PE R2, to export the routes in VRF CUST-2. In PE R7, the command 
<code style="font-size:120%;"><b>R7(config-vrf-af)#route-target import 65000:2001</b></code> is used to import those routes 
from CUST-1 in R2 to VRF CUST-2_BRANCH. Note that the RT used to export the routes
in the VRF one PE router should be the same RT used to import these routes in the
remote PE into the appropriate VRF.
</p>
<p>
It is important to note that one RD is required per VPNv4 route, multiple RTs 
can be used for VPNv4 route.
</p>
<p>
RT is defined by RFC 4360 (BGP extended communities attribute). Its format is 
similar to route distinguisher. VPNv4 speakers only accept VPNv4 routes with a 
route-target marching a local VRF; some exceptions include route reflectors.
</p>
<p>
VPNv4 routes can have more than one RT. RT allows for complex VPN topologies such as 
full mesh, hub and spoke and central services.
</p>

<h3><code style="font-size:120%;">vrf upgrade-cli</code></h3>
<p>
The global configuration command <code style="font-size:120%;"><b>vrf upgrade-cli</b></code> 
is an important command to 
use particularly when introducing VRFs in IPv6 in a network where IPv4 VRFs are 
operational. It has been previously mentioned that the <code style="font-size:120%;"><b>
vrf definition &lt;vrf-name&gt;</b></code> command supports creation IPv6 VRFs. 
If the VRFs were created like in following configuration;
</p>
<p>
<div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
      	<code style="font-size:130%">
R7(config)#<b>vrf definition CUST-1_BRANCH           </b> <br>
R7(config-vrf)#<b>rd 65000:1010                      </b> <br>
R7(config-vrf)#<b>address-family ipv4                </b> <br>
R7(config-vrf-af)#<b>route-target export 65000:1011  </b> <br>
R7(config-vrf-af)#<b>route-target import 65000:1001  </b> <br>
R7(config)#<b>vrf definition CUST-2_BRANCH           </b> <br>
R7(config-vrf)#<b>rd 65000:2010                      </b> <br>
R7(config-vrf)#<b>address-family ipv4                </b> <br>
R7(config-vrf-af)#<b>route-target export 65000:2011  </b> <br>
R7(config-vrf-af)#<b>route-target import 65000:2001  </b>
</code></div>
</p>
<p>
The command <code style="font-size:120%;"><b>vrf upgrade-cli multi-af-mode common-policies</b></code> 
will apply the same RT values configured for address-family IPv4 to IPv6 
configuration automatically. This can help make applying the same configuration 
of IPv4 VRFs to IPv6 much easier.

When configuring RT or other settings in new format VRF, the address family 
configuration takes precedence over any other similar settings that may have been
configured under the VRF sub-mode.
</p>

<h3 id="VERIFICATION">Verification</h3>
<p>
To verify the creation of VRFs, use the command <code style="font-size:120%;"><b>show vrf</b></code>.
<p>
<div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
      	<code style="font-size:130%">
R7#<b>show vrf </b>                                                                        <br>                                                                  
&nbsp;&nbsp;Name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Default RD&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Protocols&nbsp;&nbsp; Interfaces       <br>                                                                  
&nbsp;&nbsp;CUST-1_BRANCH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;65000:1010&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ipv4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Gi1/0            <br>                                                                  
&nbsp;&nbsp;CUST-2_BRANCH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;65000:2010&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ipv4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Se5/0            <br>                                                                  
R7#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                 <br>                                                                  
R7#<b>show vrf detail</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                <br>                                                                  
VRF CUST-1_BRANCH (VRF Id = 6); default RD 65000:1010 default VPNID &lt;not set&gt; <br>                                                                                
&nbsp;&nbsp;Interfaces:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                 <br>                                                                  
&nbsp;&nbsp;&nbsp;&nbsp;Gi1/0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                 <br>                                                                  
Address family ipv4 (Table ID = 6 (0x6)):&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                 <br>                                                                  
&nbsp;&nbsp;Export VPN route-target communities&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                 <br>                                                                  
&nbsp;&nbsp;&nbsp;&nbsp;RT:65000:1011&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                 <br>                                                                     
&nbsp;&nbsp;Import VPN route-target communities&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                 <br>                                                                  
&nbsp;&nbsp;&nbsp;&nbsp;RT:65000:1001&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                 <br>                                                                     
&nbsp;&nbsp;No import route-map&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                 <br>                                                                  
&nbsp;&nbsp;No export route-map&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                 <br>                                                                  
&nbsp;&nbsp;VRF label distribution protocol: not configured&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                 <br>                                                                  
&nbsp;&nbsp;VRF label allocation mode: per-prefix&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                 <br>                                                                  
Address family ipv6 not active&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                <br>                                                                  
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                <br>                                                                  
VRF CUST-2_BRANCH (VRF Id = 8); default RD 65000:2010; default VPNID &lt;not set&gt;<br>                                                                                
&nbsp;&nbsp;Interfaces:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                 <br>                                                                  
&nbsp;&nbsp;&nbsp;&nbsp;Se5/0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                 <br>                                                                  
Address family ipv4 (Table ID = 8 (0x8)):&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                 <br>                                                                  
&nbsp;&nbsp;Export VPN route-target communities&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                 <br>                                                                  
&nbsp;&nbsp;&nbsp;&nbsp;RT:65000:2011&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                 <br>                                                                   
&nbsp;&nbsp;Import VPN route-target communities&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                 <br>                                                                  
&nbsp;&nbsp;&nbsp;&nbsp;RT:65000:2001&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                 <br>                                                                   
&nbsp;&nbsp;No import route-map&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                 <br>                                                                  
&nbsp;&nbsp;No export route-map&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                 <br>                                                                  
&nbsp;&nbsp;VRF label distribution protocol: not configured&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                 <br>                                                                  
&nbsp;&nbsp;VRF label allocation mode: per-prefix&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                 <br>                                                                  
Address family ipv6 not active&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                   
</code>
</div>
</p>
<p>
From the output, it can be observed that the different VRFs have ID values. In 
the case of VRF CUST-1_BRANCH, it has an ID of 6. The default / global RIB is 
for the provider network and has a VRF ID of zero(0). The VRF ID value is 
incremented by one (1) when a new VRF is created.
</p>

<h2>Step 3: Configure MP-BGP Peerings between the PE routers using VPNv4 address-family</h2>
<p>
The PE routes need to form an iBGP neighborship. This neighborship should be 
formed using the VPNv4 address family. iBGP neighborships occur over a maximum 
of 255 hops. To configure an iBGP neigborship on R2;
</p>
<p>
<div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
      	<code style="font-size:130%">
R2(config)#<b>router bgp 65000                                 </b>  <br>
R2(config-router)#<b>bgp log-neighbor-changes                  </b>  <br>
R2(config-router)#<b>no bgp default ipv4-unicast               </b>  <br>
R2(config-router)#<b>neighbor 7.7.7.7 remote-as 65000          </b>  <br>
R2(config-router)#<b>neighbor 7.7.7.7 update-source Loopback10 </b>  <br>
R2(config-router)#<b>address-family vpnv4                      </b>  <br>
R2(config-router-af)#<b>neighbor 7.7.7.7 activate              </b>  <br>
R2(config-router-af)#<b>exit-address-family                    </b>  <br>
                                                              <br>
!On R7                                                         <br>
                                                              <br>
R7(config)#<b>router bgp 65000                                 </b>  <br>
R7(config-router)#<b>bgp log-neighbor-changes                  </b>  <br>
R7(config-router)#<b>no bgp default ipv4-unicast               </b>  <br>
R7(config-router)#<b>neighbor 2.2.2.2 remote-as 65000          </b>  <br>
R7(config-router)#<b>neighbor 2.2.2.2 update-source Loopback10 </b>  <br>
R7(config-router)#<b>address-family vpnv4                      </b>  <br>
R7(config-router-af)#<b>neighbor 2.2.2.2 activate              </b>  <br>
R7(config-router-af)#<b>exit-address-family                    </b>  <br>
</code>
</div>
<p>
The command <code style="font-size:120%;"><b>neighbor 2.2.2.2 send-community extended</b></code> is 
automatically added by MP-BGP as it uses extended communities to route VPNv4 
traffic. This can be verified by the command <code style="font-size:120%;"><b>show run | section bgp</b></code>.
</p>
<h3>MPLS Layer 3 VPN Label Stack</h3>
<p>
In order to forward traffic across an MPLS L3VPN, at least 2 labels are required. 
The first label attached is the VPN label and the second is the transport/Label 
Distribution Protocol (LDP) label. The VPN label is used by the egress LSR/PE 
router to determine enterprise specifics about the packet and what to do with it. 
The LDP label(transport label) is used for label switching from PE to PE through the MPLS domain 
as intermediate LSRs run only MPLS and not BGP. The transport label basically 
tells SP MPLS core LSRs which PE traffic is destined to (exit point). It is 
derived from LDP (sometimes called IGP label). The VPN label tells the PE router 
which CE traffic is destined to. It is derived from VPNv4 advertisements of PEs.
</p>
<p>
VPN labels are learned between PE routers over the MP-BGP peering. Labeled 
packets are advertised using BGP extended communities.
MPLS generates labels for VPNv4 routes and adds [V] after the prefix to indicate 
that the label is a VPNv4 label.
In the L3VPN Label stack, the VPN label is usually at the bottom of the stack 
(nearest to the Layer 3 header) as indicated by the 1-value is the S-section of 
the MPLS header.
</p>

<h3>Verification</h3>
<p>
Once the iBGP peering has been completed, this neighborship can be confirmed 
using the command <code style="font-size:120%;"><b>show bgp vpnv4 unicast all summary</b></code>. The 
result of this command is indicated in the following snippet.
<div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
      	<code style="font-size:130%">
R2(config-router-af)#<b>do show bgp vpnv4 unicast all summary</b>          <br>
BGP router identifier 2.2.2.2, local AS number 65000                <br>
BGP table version is 255, main routing table version 255            <br>
20 network entries using 3360 bytes of memory                       <br>
20 path entries using 1280 bytes of memory                          <br>
8/8 BGP path/bestpath attribute entries using 1152 bytes of memory  <br>
7 BGP extended community entries using 1540 bytes of memory         <br>
0 BGP route-map cache entries using 0 bytes of memory               <br>
0 BGP filter-list cache entries using 0 bytes of memory             <br>
BGP using 7332 total bytes of memory                                <br>
BGP activity 26/6 prefixes, 129/109 paths, scan interval 60 secs    <br>
<br>
Neighbor&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;V&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AS MsgRcvd MsgSent&nbsp;&nbsp; TblVer&nbsp;&nbsp;InQ OutQ Up/Down&nbsp;&nbsp;State/PfxRcd <br>
7.7.7.7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;65000&nbsp;&nbsp;&nbsp;&nbsp; 694&nbsp;&nbsp;&nbsp;&nbsp; 758&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;255&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;0 09:51:51&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;6&nbsp;&nbsp;&nbsp;&nbsp; <br>
R2(config-router-af)#
</code>
</div>
<p>
This shows that the iBGP peering was created. In this snippet, a similar command 
was run on PE R7 and routes have already been shared as indicated by the PfxRcd 
column with value 6.
</p>

<h2>Step 4: Route Exchange Between the PE And CE Devices</h2>
<p>
This can be implemented through configuration of an IGP between the PE-CE routers 
or BGP with an eBGP relationship.
</p>
<p>
A routing protocol needs to be configured between the PE and CE routers. Usually 
this is an Interior Gateway Protocol (IGP) such as EIGRP, IS-IS or OSPF. Some 
enterprises may prefer running BGP. This routing protocol is to share the enterprise
routes from the CE to the PE.
</p>
<p>
When configuring the routing protocol, the physical interface that the PE connects
to the CE should be placed in the appropriate VRF that was configured for the 
enterprise to which that interface points. Between CE R1 and PE R2, the configured 
routing protocol is EIGRP with named EIGRP being configured on R2.
</p>
<p>
<div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
      	<code style="font-size:130%">
R1(config)#<b>router eigrp EIGRP_NAMED                                                               </b><br>
R1(config-router)#<b>address-family ipv4 unicast autonomous-system 10                                </b><br>
R1(config-router-af)#<b>eigrp router-id 1.1.1.1                                                      </b><br>
R1(config-router-af)#<b>network 172.30.1.0 0.0.0.255                                                 </b><br>
R1(config-router-af)#<b>network 172.30.2.0 0.0.0.255                                                 </b><br>
R1(config-router-af)#<b>network 172.30.3.0 255.255.255.0                                             </b><br>
R1(config-router-af)#<b>network 10.10.12.0 0.0.0.3                                                   </b><br>
R1(config-router-af)#                                                                                </b><br>
                                                                                                     </b><br>
                                                                                                     </b><br>
R2(config)#<b>interface g3/0                                                                         </b><br>
R2(config-if)#<b>vrf forwarding CUST-1                                                               <br>
% Interface GigabitEthernet3/0 IPv4 disabled and address(es) removed due to enabling VRF CUST-1      </b><br>
R2(config-if)#<b>ip address 10.10.12.2 255.255.255.252                                               </b><br>
R2(config-if)#<b>router eigrp EIGRP_ENTERPRISES                                                        </b><br>
R2(config-router)#<b>address-family ipv4 vrf CUST-1 autonomous-system 10                             </b><br>
R2(config-router-af)#<b>network 10.10.12.0 0.0.0.3                                                   </b><br>
R2(config-router-af)#
*Feb  9 11:44:21.427: %DUAL-5-NBRCHANGE: EIGRP-IPv4 10: Neighbor 10.10.12.1 (GigabitEthernet3/0) is up: new adjacency
</code>
</div>
</p>
<p>
Note that VRFs are only configured on the PE routers. On CE routers, VRFs are 
not required for MPLS L3VPN functionality. If they are configured, then it could 
be for another purpose unrelated to MPLS L3VPN.
</p>
<p>
The IGPs on the running on the PE-CE interfaces of the different PE-CE pairings 
does not have to be the same. To illustrate this, the PE-CE IGP on R7 is OSPF.
</p>
<p>
<div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
      	<code style="font-size:130%">
R8(config)#<b>router ospf 1000                                </b><br>
R8(config-router)#<b>router-id 8.8.8.8                        </b><br>
R8(config-router)#<b>network 172.31.0.0 0.0.255.255 area 0    </b><br>
R8(config-router)#<b>network 10.10.78.0 0.0.0.3 area 10       </b><br>
                                                              </b><br>
                                                              </b><br>
R7(config)#<b>router ospf 1000 vrf CUST-1_BRANCH              </b><br>
R7(config-router)#<b>router-id 77.77.77.77                    </b><br>
R7(config-router)#<b>network 10.10.78.0 0.0.0.3 area 10       </b><br>
R7(config-router)#<b>exit                                     </b><br>
</code>
</div>
</p>

<h3>Verification</h3>
<p>
Routes should enterprise local and remote enterprise site routes should start appearing 
in the MP-BGP VPNv4 table at this point. This can be verified by the command; 
<code style="font-size:120%;"><b>show bgp vpnv4 unicast all</b></code>. This shows the routes in the 
MP-BGP table for all VRFs. To view the routes for a specific VRF in the MP-BGP 
table, issue the following command; show bgp vpnv4 unicast vrf CUST-1.
</p>

<div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
      	<code style="font-size:130%">
R2#<b>show bgp vpnv4 unicast all</b>                                            <br>
BGP table version is 339, local router ID is 2.2.2.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <br>
Status codes: s suppressed, d damped, h history, * valid, > best, i - internal, <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r RIB-failure, S Stale, m multipath, b backup-path, f RT-Filter,  <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x best-external, a additional-path, c RIB-compressed,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   <br>
Origin codes: i - IGP, e - EGP, ? - incomplete&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <br>
RPKI validation codes: V valid, I invalid, N Not found&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <br>
&nbsp;&nbsp;&nbsp;&nbsp; Network&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Next Hop&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Metric LocPrf Weight Path&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   <br>
Route Distinguisher: 65000:1000 (default for vrf CUST-1)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <br>
 *>&nbsp;&nbsp;10.10.12.0/30&nbsp;&nbsp;&nbsp;&nbsp;0.0.0.0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 32768 ?&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <br>
 *>i 10.10.78.0/30&nbsp;&nbsp;&nbsp;&nbsp;7.7.7.7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;100&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 ?&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <br>
 *>&nbsp;&nbsp;172.30.1.0/24&nbsp;&nbsp;&nbsp;&nbsp;10.10.12.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 10880&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 32768 ?&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <br>
 *>&nbsp;&nbsp;172.30.2.0/24&nbsp;&nbsp;&nbsp;&nbsp;10.10.12.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 10880&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 32768 ?&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <br>
 *>&nbsp;&nbsp;172.30.3.0/24&nbsp;&nbsp;&nbsp;&nbsp;10.10.12.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 10880&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 32768 ?&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <br>
 *>i 172.31.1.1/32&nbsp;&nbsp;&nbsp;&nbsp;7.7.7.7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;100&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 ?&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <br>
 *>i 172.31.2.1/32&nbsp;&nbsp;&nbsp;&nbsp;7.7.7.7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;100&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 ?&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <br>
 *>i 10.10.78.0/30&nbsp;&nbsp;&nbsp;&nbsp;7.7.7.7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;100&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 ?&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <br>
 *>i 172.31.1.1/32&nbsp;&nbsp;&nbsp;&nbsp;7.7.7.7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;100&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 ?&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <br>
 *>i 172.31.2.1/32&nbsp;&nbsp;&nbsp;&nbsp;7.7.7.7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;100&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 ?&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <br>
Route Distinguisher: 65000:2000 (default for vrf CUST-2)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <br>
 *>&nbsp;&nbsp;10.10.29.0/30&nbsp;&nbsp;&nbsp;&nbsp;0.0.0.0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 32768 ?&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <br>
&nbsp;&nbsp;&nbsp;&nbsp; Network&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Next Hop&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Metric LocPrf Weight Path&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   <br>
 *>i 10.10.70.0/30&nbsp;&nbsp;&nbsp;&nbsp;7.7.7.7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;100&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 ?&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <br>
 *>i 172.30.1.0/24&nbsp;&nbsp;&nbsp;&nbsp;7.7.7.7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 16116062&nbsp;&nbsp;&nbsp;&nbsp;100&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 ?&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <br>
 *>&nbsp;&nbsp;172.30.2.0/24&nbsp;&nbsp;&nbsp;&nbsp;10.10.29.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;16116062&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 32768 ?&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <br>
 *>&nbsp;&nbsp;172.30.3.0/24&nbsp;&nbsp;&nbsp;&nbsp;10.10.29.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;16116062&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 32768 ?&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <br>
 *>&nbsp;&nbsp;172.30.5.0/24&nbsp;&nbsp;&nbsp;&nbsp;10.10.29.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;16116062&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 32768 ?&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <br>
 *>i 172.30.6.0/24&nbsp;&nbsp;&nbsp;&nbsp;7.7.7.7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 16116062&nbsp;&nbsp;&nbsp;&nbsp;100&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 ?&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <br>
...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <br>
R7#<b>show bgp vpnv4 unicast vrf CUST-2</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   <br>
BGP table version is 590, local router ID is 7.7.7.7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <br>
Status codes: s suppressed, d damped, h history, * valid, > best, i - internal, <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r RIB-failure, S Stale, m multipath, b backup-path, f RT-Filter,  <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x best-external, a additional-path, c RIB-compressed,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   <br>
Origin codes: i - IGP, e - EGP, ? - incomplete&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <br>
RPKI validation codes: V valid, I invalid, N Not found&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <br>
&nbsp;&nbsp;&nbsp;&nbsp; Network&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Next Hop&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Metric LocPrf Weight Path&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   <br>
Route Distinguisher: 65000:2010 (default for vrf CUST-2)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <br>
 *>i 10.10.29.0/30&nbsp;&nbsp;&nbsp;&nbsp;2.2.2.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;100&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 ?&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <br>
 *>&nbsp;&nbsp;10.10.70.0/30&nbsp;&nbsp;&nbsp;&nbsp;0.0.0.0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 32768 ?&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <br>
 *>&nbsp;&nbsp;172.30.1.0/24&nbsp;&nbsp;&nbsp;&nbsp;10.10.70.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;16116062&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 32768 ?&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <br>
 *>i 172.30.2.0/24&nbsp;&nbsp;&nbsp;&nbsp;2.2.2.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 16116062&nbsp;&nbsp;&nbsp;&nbsp;100&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 ?&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <br>
 *>i 172.30.3.0/24&nbsp;&nbsp;&nbsp;&nbsp;2.2.2.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 16116062&nbsp;&nbsp;&nbsp;&nbsp;100&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 ?&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <br>
 *>i 172.30.5.0/24&nbsp;&nbsp;&nbsp;&nbsp;2.2.2.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 16116062&nbsp;&nbsp;&nbsp;&nbsp;100&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 ?&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <br>
 *>&nbsp;&nbsp;172.30.6.0/24&nbsp;&nbsp;&nbsp;&nbsp;10.10.70.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;16116062&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 32768 ?&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <br>
R7#                                                                             <br>
</code></div>
<p>
Note that the routes learned through MP-BGP VPNv4, have the next-hop as the iBGP remote PE peer.
</p>

<h2>Step 5: Redistribute Routes Between MP-BGP VRF Address-family and PE-CE Routing Protocol</h2>
<p>
Route redistribution between the IGP and MP-BGP occurs at the PE router. Enterprise 
routes learned from the remote PE router are stored in the MP-BGP VPNv4 table. 
These can then be redistributed into the IGP running on the PE-CE link. Also, 
routes learned from the connected enterprise site through the IGP can be 
redistributed into MP-BGP to be forwarded to the remote enterprise site. This is 
accomplished using the redistribution command in the appropriate address-family.
</p>
<p>
On R2:
<div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
      	<code style="font-size:130%">
R2(config)#<b>router bgp 65000                                                </b>    <br>
R2(config-router)#<b>no bgp default ipv4-unicast                              </b>    <br>
!REDISTRIBUTE CUST-1 ROUTES INTO MP-BGP (LOCAL ENTERPRISE SITE TO REMOTE SITES)  <br>
R2(config-router)#<b>address-family ipv4 vrf CUST-1                           </b>    <br>
R2(config-router-af)#<b>redistribute eigrp 10                                 </b>    <br>
R2(config-router-af)#<b>exit-address-family                                   </b>    <br>
R2(config-router)#<b>exit                                                     </b>    <br>
!REDISTRIBUTE MP-BGP ROUTES INTO EIGRP (REMOTE ENTERPRISE SITES TO LOCAL SITE)   <br>
R2(config)#<b>router eigrp EIGRP_ENTERPRISES                                    </b>    <br>
R2(config-router)#<b>address-family ipv4 vrf CUST-1 autonomous-system 10      </b>    <br>
R2(config-router-af)#<b>topology base                                         </b>    <br>
R2(config-router-af-topology)#<b>redistribute bgp 65000 100000 100 250 10 1500</b>
</code></div>
</p>
<p>
On R7
<div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
      	<code style="font-size:130%">
R7(config)#<b>router bgp 65000                                </b> <br>
R7(config-router)#<b>address-family ipv4 vrf CUST-1_BRANCH    </b> <br>
R7(config-router-af)#<b>redistribute ospf 1000                </b> <br>
R7(config-router-af)#<b>exit-address-family                   </b> <br>
R7(config-router)#<b>exit                                     </b> <br>
R7(config)#<b>router ospf 1000 vrf CUST-1_BRANCH              </b> <br>
R7(config-router)#<b>redistribute eigrp 10                    </b> <br>
R7(config-router-af)#<b>exit-address-family                   </b>
</code></div>
<p>
Note that with eBGP, no redistribution of PE-CE routes is required. These routes 
will simply be shared through the eBGP relationship from MP-BGP.
</p>

<h3>Verification</h3>
<p>
To verify that the appropriate routes have been redistributed;
</p>
<p>
On the PE router;
<div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
      	<code style="font-size:130%">
R2#<b>show ip route vrf CUST-2</b>                                            <br>
                                                                              <br>
Routing Table: CUST-2                                                         <br>
Codes: L - local, C - connected, S - static, R - RIP, M - mobile, B - BGP     <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; D - EIGRP, EX - EIGRP external, O - OSPF, IA - OSPF inter area         <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; N1 - OSPF NSSA external type 1, N2 - OSPF NSSA external type 2         <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; E1 - OSPF external type 1, E2 - OSPF external type 2                   <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; i - IS-IS, su - IS-IS summary, L1 - IS-IS level-1, L2 - IS-IS level-2  <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ia - IS-IS inter area, * - candidate default, U - per-user static route<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; o - ODR, P - periodic downloaded static route, H - NHRP, l - LISP      <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; + - replicated route, % - next hop override                            <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                    <br>
Gateway of last resort is not set                                             <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                    <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10.0.0.0/8 is variably subnetted, 3 subnets, 2 masks                    <br>
C&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10.10.29.0/30 is directly connected, Serial6/0                       <br>
L&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10.10.29.1/32 is directly connected, Serial6/0                       <br>
B&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10.10.70.0/30 [200/0] via 7.7.7.7, 00:23:10                          <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;172.30.0.0/24 is subnetted, 5 subnets                                   <br>
B&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;172.30.1.0 [200/16116062] via 7.7.7.7, 00:11:06                      <br>
D&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;172.30.2.0 [90/16116062] via 10.10.29.2, 00:21:51, Serial6/0         <br>
D&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;172.30.3.0 [90/16116062] via 10.10.29.2, 00:21:51, Serial6/0         <br>
D&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;172.30.5.0 [90/16116062] via 10.10.29.2, 00:21:51, Serial6/0         <br>
B&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;172.30.6.0 [200/16116062] via 7.7.7.7, 00:11:06                      <br>
R2#
</code></div>
</p>
<p>
On the CE router;
<div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
      	<code style="font-size:130%">
R1#<b>show ip route</b>                                                       <br>
Codes: L - local, C - connected, S - static, R - RIP, M - mobile, B - BGP     <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; D - EIGRP, EX - EIGRP external, O - OSPF, IA - OSPF inter area         <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; N1 - OSPF NSSA external type 1, N2 - OSPF NSSA external type 2         <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; E1 - OSPF external type 1, E2 - OSPF external type 2                   <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; i - IS-IS, su - IS-IS summary, L1 - IS-IS level-1, L2 - IS-IS level-2  <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ia - IS-IS inter area, * - candidate default, U - per-user static route<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; o - ODR, P - periodic downloaded static route, H - NHRP, l - LISP      <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; + - replicated route, % - next hop override                            <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                    <br>
Gateway of last resort is not set                                             <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                    <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10.0.0.0/8 is variably subnetted, 3 subnets, 2 masks                    <br>
C&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10.10.12.0/30 is directly connected, GigabitEthernet3/0              <br>
L&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10.10.12.1/32 is directly connected, GigabitEthernet3/0              <br>
D EX&nbsp;&nbsp;&nbsp;&nbsp; 10.10.78.0/30                                                        <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [170/568320] via 10.10.12.2, 00:00:52, GigabitEthernet3/0          <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;172.30.0.0/16 is variably subnetted, 6 subnets, 2 masks                 <br>
C&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;172.30.1.0/24 is directly connected, Loopback100                     <br>
L&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;172.30.1.1/32 is directly connected, Loopback100                     <br>
C&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;172.30.2.0/24 is directly connected, Loopback110                     <br>
L&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;172.30.2.1/32 is directly connected, Loopback110                     <br>
C&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;172.30.3.0/24 is directly connected, Loopback120                     <br>
L&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;172.30.3.1/32 is directly connected, Loopback120                     <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;172.31.0.0/32 is subnetted, 2 subnets                                   <br>
D EX&nbsp;&nbsp;&nbsp;&nbsp; 172.31.1.1 [170/568320] via 10.10.12.2, 00:00:52, GigabitEthernet3/0 <br>
D EX&nbsp;&nbsp;&nbsp;&nbsp; 172.31.2.1 [170/568320] via 10.10.12.2, 00:00:52, GigabitEthernet3/0 <br>
R1#
</code></div>
</p>

<h2>Step 6: Test Connectivity</h2>
<p>
A ping test or traceroute test can be used to confirm the operation of the MPLS L3VPN.
</p>
<p>
<h3><code style="font-size:120%;">traceroute</code></h3>
<div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
      	<code style="font-size:130%">
R8#<b>traceroute 172.30.1.1 source 172.31.1.1</b>                           <br>
Type escape sequence to abort.                                              <br>
Tracing the route to 172.30.1.1                                             <br>
VRF info: (vrf in name/id, vrf out name/id)                                 <br>
&nbsp;&nbsp;1 10.10.78.1 788 msec 12 msec 416 msec                                    <br>
&nbsp;&nbsp;2 10.10.47.1 [MPLS: Labels 4002/2026 Exp 0] 1100 msec 144 msec 1244 msec  <br>
&nbsp;&nbsp;3 10.10.34.1 [MPLS: Labels 3000/2026 Exp 0] 460 msec 92 msec 1224 msec    <br>
&nbsp;&nbsp;4 10.10.12.2 [MPLS: Label 2026 Exp 0] 336 msec 136 msec 896 msec          <br>
&nbsp;&nbsp;5 10.10.12.1 720 msec 504 msec 708 msec <br>
R8#
</code></div>
</p>
<p>
In the output of the traceroute command, at the third hop with IP 10.10.34.1, two 
(2) MPLS labels are displayed; one label is the transport (MPLS) label and the 
other label is the VPN label. This confirms operation of MPLS L3VPN. In this case, 
the transport label is 3000 and VPN label 2026. As can be noticed, the transport
label is continually swapped as the packet is switched from hop to hop while the
VPN label travels with the packet from the nearby PE router to the remote PE 
where it finally gets popped and the packet is then redistributed into the IGP 
at the PE-CE link and routed using IP.
</p>
<h3><code style="font-size:120%;">ping</code></h3>
<p>
<div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
      	<code style="font-size:130%">
R8#<b>ping  172.30.1.1 source 172.31.1.1</b>                                <br>
Type escape sequence to abort.                                              <br>
Sending 5, 100-byte ICMP Echos to 172.30.1.1, timeout is 2 seconds:         <br>
Packet sent with a source address of 172.31.1.1                             <br>
!!!!!                                                                       <br>
Success rate is 100 percent (5/5), round-trip min/avg/max = 92/745/1668 ms  <br>
R8#
</code></div>
</p>
<p>
The ping command confirms the connectivity from enterprise site to remote enterprise site across the SP MPLS L3VPN.
</p>
<p>
To view the MPLS LFIB
<div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
      	<code style="font-size:130%">
R7#<b>show mpls forwarding-table</b>                                       <br>
Local&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Outgoing&nbsp;&nbsp; Prefix&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Bytes Label&nbsp;&nbsp; Outgoing&nbsp;&nbsp; Next Hop   <br>
Label&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Label&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or Tunnel Id&nbsp;&nbsp;&nbsp;&nbsp; Switched&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;interface&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;     <br>
7000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Pop Label&nbsp;&nbsp;4.4.4.4/32&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Gi2/0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10.10.47.1 <br>
7001&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4001&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3.3.3.3/32&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Gi2/0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10.10.47.1 <br>
7002&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4002&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2.2.2.2/32&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Gi2/0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10.10.47.1 <br>
7003&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4006&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 10.10.36.0/30&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Gi2/0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10.10.47.1 <br>
7004&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4007&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 10.10.26.0/30&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Gi2/0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10.10.47.1 <br>
7005&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4008&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 10.10.23.0/30&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Gi2/0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10.10.47.1 <br>
7006&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Pop Label&nbsp;&nbsp;10.10.34.0/30&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Gi2/0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10.10.47.1 <br>
7007&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; No Label&nbsp;&nbsp; 10.10.78.0/30[V] 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; aggregate/CUST-1      <br>
7008&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; No Label&nbsp;&nbsp; 172.31.1.1/32[V] 4152&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Gi1/0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10.10.78.2 <br>
7009&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; No Label&nbsp;&nbsp; 172.31.2.1/32[V] 252&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Gi1/0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10.10.78.2 <br>
7010&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; No Label&nbsp;&nbsp; 10.10.70.0/30[V] 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; aggregate/CUST-2      <br>
7017&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; No Label&nbsp;&nbsp; 172.30.1.0/24[V] 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Se5/0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;point2point<br>
7018&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; No Label&nbsp;&nbsp; 172.30.6.0/24[V] 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Se5/0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;point2point<br>
R7#
</code></div>
</p>
<p>
L3VPN routes have a [V] next to the learned route.

To view the FIB for the different VRFs run the command <code style="font-size:120%;"><b>show ip cef vrf &lt;vrf_name&gt;</b></code>.
</p>
<p>
<div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
      	<code style="font-size:130%">
R2#<b>show ip cef vrf CUST-2</b>                               <br>
Prefix&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Next Hop&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Interface            <br>
0.0.0.0/0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;no route&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                    <br>
0.0.0.0/8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;drop&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                    <br>
0.0.0.0/32&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; receive&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                   <br>
10.10.29.0/30&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;attached&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Serial6/0            <br>
10.10.29.0/32&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;receive&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Serial6/0            <br>
10.10.29.1/32&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;receive&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Serial6/0            <br>
10.10.29.3/32&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;receive&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Serial6/0            <br>
10.10.70.0/30&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10.10.23.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GigabitEthernet0/0   <br>
127.0.0.0/8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;drop&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                    <br>
172.30.1.0/24&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10.10.23.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GigabitEthernet0/0   <br>
172.30.2.0/24&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10.10.29.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Serial6/0            <br>
172.30.3.0/24&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10.10.29.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Serial6/0            <br>
172.30.5.0/24&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10.10.29.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Serial6/0            <br>
172.30.6.0/24&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10.10.23.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GigabitEthernet0/0   <br>
224.0.0.0/4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;drop&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                    <br>
224.0.0.0/24&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; receive&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                   <br>
240.0.0.0/4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;drop&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                    <br>
255.255.255.255/32&nbsp;&nbsp; receive&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                   <br>
</code></div>
</p>
<p>
Additionally, to view the MPLS L3VPN on a specific route in the VRF LIB
</p>
<p>
<div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
      	<code style="font-size:130%">
R2#<b>show ip cef vrf CUST-2 172.30.6.0</b>              <br>
172.30.6.0/24                                            <br>
&nbsp;&nbsp;nexthop 10.10.23.2 GigabitEthernet0/0 label 3003 7020  <br>
R2#<b>show ip cef vrf CUST-2 172.30.1.0</b>                     <br>
172.30.1.0/24                                            <br>
&nbsp;&nbsp;nexthop 10.10.23.2 GigabitEthernet0/0 label 3003 7019  <br>
R2#
</code></div>
</p>