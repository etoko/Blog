<h1>Access Control Lists</h1>

<p>
An Access Control List (ACL) is a sequential list of rules containing permit 
or deny statements, that are used to match traffic. When applied to interfaces, 
ACLs are used to perform a network control service. Each rule in the ACL is known 
as an Access Control Entry (ACE) and sometimes referred to as ACL statements. 
 
Each ACE can permit or deny specific traffic. Depending on the type of ACL, each 
ACE contains match criteria that packets transiting the device are subjected to 
such as: 
<ul>
  <li>Source IP address</li>
  <li>Destination IP address</li>
  <li>IP protocols such as TCP, UDP, ICMP, OSPF, EIGRP etc</li>
  <li>TCP/UDP source <!--and destination port numbers.--></li>
</ul>
</p>
<p>
In addition to network traffic control, ACLs serve many other purposes such as; 
<ul>
  <li>Performing a matching service with Network Address Translation (NAT)</li>
  <li>Policy Based Routing (PBR)</li> 
  <li>Object tracking</li>
  </ul>
  </p>
  <p>
One common application of ACLs is in packet filtering where packets 
that meet specified criteria will be permitted through the router to their destination 
or dropped.
By default, routers do not filter traffic; they examine the destination IP address 
and refer to the routing table to determine which interface to forward the traffic 
through. When an ACL is applied to a router interface:
<ul>
  <li>It evaluates all network packets</li>
  <li>Determines if the packet is permitted or denied.</li>
</ul>

A router processing an ACL checks the header 
of each packet to determine whether it matches the criteria specified in each ACE 
of an ACL. If any packet matches any of the ACEs, it will examine the action to 
be taken as specified in the ACE (permit or deny). A permit action allows the 
packet through. A deny action results in a dropped packet.
Each ACE is issued with a sequence number. If not specified during configuration, 
sequence numbers have a default increment of 10; with the first ACE having a sequence 
number of 10, second 20, third 30 and so on.
ACL entries are processed in sequence from top to bottom of the list. 
</p>
<p>
By default, ACLs have an implicit deny added to the end of the ACL and these ACLs
are used for through-the-box access rules. Management ACLs control to-the-box traffic. 
These ACLs do not have the implicit deny at the end of the ACL. 
</p>
<p>
A router can filter packets using ACLs that are applied inbound or outbound. An 
inbound ACL filters packets coming into an interface but before any route processing 
takes place i.e., before they are routed to the outbound interface. An outbound 
ACL filters packets after route processing.

If a packet matches any of the ACEs in an ACL, the action (permit or deny) is 
applied and the router immediately stops processing the ACL. The first match ends 
the processing of an ACL. Because of this, when configuring ACLs, the ordering 
of the ACEs is extremely important.
<p>
ACLs use wildcard bits and not subnet masks to match traffic. Wildcard bits allow for more 
specific matching of traffic compared to subnet masks. The bits that are set to 
zero in a wildcard bit must match. For instance;
172.16.1.1 0.15.255.255 matches addresses in the range 172.16.1.1 172.31.255.255
</p>

<h1>Types of ACLs</h1>
<p>
There are several types of ACLs:
  <li>Standard</li>
  <li>Extended ACLs</li>
  <li>Infrastructure</li>
  <li>Transit</li>
  <li>Time-based</li>
  <li>Dynamic</li>
  <li>IP Named</li>
  <li>Reflexive</li>
  <li>Context-based</li>
</p>

<h1>Application of ACLs</h1>
<p>
The original intent of ACLs was packet filtering. ACLs application has increased 
tp include multiple applications such as:
<ul>
  <li>Filtering traffic (egress or ingress): most commonly used application of ACLs</li>
  <li>Quality of Server (QoS) operations such as queueing, policing</li>
  <li>Route maps</li>
  <li>Network identification in routing protocols</li>
  <li>Route modification/filtering</li>
  <li>Management plane restrictions such as Telnet, SSH, VPN</li>
</ul>
</p>


<h1>Processing of ACLs</h1>
<p>
ACLs are processed sequentially from top to bottom with ACEs at the top having the 
lowest numerical sequence number. If a packet is matched on an ACE, the ACL stops 
processing and applies the action which can be permit or deny.
There is an implicit deny statement at the end of every ACL.
</p>
<p>
ACLs for traffic filtering do not block local router generated traffic.
</p>

<h2>Ordering of ACEs</h2>
<p>
When defining network ranges to be permitted or denied, the more specific address 
entries should be configured before the more general entries. The most specific 
network address entry is that defining a specific host IP address using the 
keyword <code><b>host</b></code> or wildcard bit <code><b>0.0.0.0</b></code>.
These should then be followed by the more general wildcard bits. Some illustrative 
examples include:
<ul>
  <li><code><b>deny host 192.168.1.1</b></code></li>
  <li><code><b>permit 192.168.1.0 0.0.0.127</b></code></li>
  <li><code><b>deny 192.168.1.0 0.0.0.255 </b></code></li>
</ul>
</p>
<p>
If the more specific addresses are entered after the more general addresses which
overlap the more specific address i.e., the more specific address is a subset of 
the more general address, IOS will display an error message. 
<b style="color: red;">TODO: Add Error Message</b>
</p>

<h1>Wildcard Bits</h1>
<p>
IP standard and extended ACls use wildcard bits to match binary 0s and 1s of 
the IP address. Wildcard bits use the following rules to match binary 0s and 1s:
<ul>
  <li>Wildcard bit bit 0: Match the corresponding bit value in the address.</li>
  <li>Wildcard bit bit 1: Ignore the corresponding bit value in the address. 
  If a bit is set in the wildcard bit, it means, do not 
  care.</li>  
</ul>
</p>
<p>
Unlike wildcard masks used in OSPF, wildcard bits do not have to be contiguous; 
they can be on or off anywhere to represent sections of the IP address that have 
to match and sections that do not have to match.
</p>
<p>
 To determine the wildcard bit to use, subtract the subnet mask value (in dotted 
 decimal notation) from the broadcast subnet mask i.e., 255.255.255.255 (/24) 
</p>

<h2>Matching Subnets</h2>
<h3>Example 1</h3>
<p>
 If an 
 IP address 192.168.1.0 has a subnet mask of 255.255.255.0, then the wilcard 
 mask can be determined as follows:
<div>
  <figure>
    <img alt="Determination of wildcard bit" src="images/acl/wildcard bit.png">
  </figure>
</div>
</p>

<h3>Example 2</h3>
<p>
Given an IP address 172.16.1.30 with a subnet mask of 255.255.255.224 (/27), the 
wildcard bit can be determined as follows:
<div>
  <figure>
    <img alt="Wildcard bit example 2" src="images/acl/wildcard_mask_2.png">
  </figure>
</div>
</p>

<h3>Example 3</h3>
<p>
In this instance, given three hosts: 
<ol>
   <li>A with IP address 150.57.0.9</li>
   <li>B with IP address 120.37.19.20</li> 
   <li>C with IP address 8.17.29.100</li>
 </ol>
   If an ACL with ACE 
<code><b>access-list 1 permit 150.75.1.0 255.255.254.254</b></code> is applied 
to an interface in the ingress direction:
<ul>
  <li>The first and second octets of the wildcard bit indicates do not match anything.
  Therefore, all hosts A, B, and C match this criteria.
  </li>
  <li>The third octet of the wildcard bit indicates match an odd number. This 
  is because it has one bit set but the address it is matching has one(1) in the 
  third octet. Hosts B, and C match this third octet.</li>
  <li>The fourth octet of the wildcard bit matches an even number.
  Hosts B, and C match this third octet.
  </li>
</ul>
Hosts B, and C will be permitted through as their IP addresses match the ACE.
</p>

<h2>Matching Hosts</h2>
<p>
To match a specific host's IP address, ACLs use three approaches:
<ol>
  <li>A wildcard bit with all 0 bits: <code><b>permit 192.168.1.1 0.0.0.0</b></code></li>
  <li>The <code><b>host</b></code> keyword: <code><b>permit host 192.168.1.1</b></code></li>
  <li>The full host IP address without a wildcard mask: <code><b>permit 192.168.1.1</b></code></li>
</ol>
</p>

<h2>Matching any/all hosts</h2>
<p>
To permit any source IP address, ACLs use two approaches; using the 255.255.255.255 
wildcard bit or the <code><b>any</b></code> keyword. The <code><b>any</b></code> 
keyword denotes the IP address and wildcard bits of <code><b>0.0.0.0 0.0.0.0</b></code>.
</p>
<p>
An example can be <code><b>access-list 1 permit 0.0.0.0 255.255.255.255</b></code>.
</p>

<h1>ACL Placement</h1>
<p>
The best location for the placement of ACLs is as close to the source of the 
traffic as possible. This helps with saving network bandwidth by blocking traffic 
before it consumes network bandwidth. However, this may depend on the network 
design and type of ACL.
</p>
<p>
The recommended standard for placement of ACLs is for one ACL, per interface 
 per direction (ingress or egress), per protocol (IPv4 or IPv6). Regarding the 
 types of ACLs: 
 <ul>
   <li><b>Extended ACLs</b> are usually placed near the source; undesirable 
 traffic is denied close to the source and not wasting the available network 
 bandwidth.</li>
 <li><b>Standard ACLs</b> are usually placed near the destination of the traffic 
 because standard ACLs do not specify destination addresses.
 </li>
 </ul>
</p>
<p>
Additional factors that may determine the placement of ACLs include:
<ul>
  <li>The available network bandwidth</li>
  <li>Ease of configuration</li>
  <li>Extend of administrative control over the network</li>
</ul>
</p>

<p>
When applying an ACL to filter traffic, the following keywords are used:
<ul>
  <li><b>Interface:</b> <code><b>ip access-group [acl-name | acl-number] [in | out]</b></code></li>
  <li><b>VTY Line:</b> <code><b>access-class  [acl-name | acl-number] [in | out]</b></code></li>
</ul>
</p>


<h1>Named ACL Recommendations</h1>

<p>
The ACL naming recommendations include the following:
<ul>
  <li>Name cannot contain spaces or punctuation marks.</li>
  <li>ACL name cannot begin with a number</li>
  <li>ACL name must be unique</li>
  <li>ACL name can have a mixture alpahnumeric characters</li>
  <li>Recommended that the ACL name be written in capital letters</li>
  <li>ACLs of different types cannot have the same name</li>
  <li>ACL names are locally significant. Multiple routers on the network can be 
  configured to have the same name</li>
  <li>Choose names that identify the function of the ACL</li>
</ul>
</p>

<h1>Standard Access Control Lists</h1>
<p>
A standard ACL filters traffic based on source IP address of a packet. 
Based on the ACL number, standard ACLs have two ranges i.e. 1-99 and 1300-1999 (expanded).
</p>
<p>
There are three ways to write access control lists:
<ul>
  <li>Modern named</li>
  <li>Classical numbered</li>
  <li>Modern numbered</li>
</ul>
</p>
<p>
By default, there is an <b>implied deny</b> ACL for traffic that was not matched.
</p>


<h2>Modern Named</h2>
<p>
Named standard ACLs can be uniquely identified by the name. The name of the ACL 
is guided by the ACL naming recommendations as previously discussed.
</p>
<p>
To configure a named standard ACL:
<ol>
  <li><b>Define the ACL</b> using the command <code><b>ip access-list standard &lt;ACL-NAME&gt;</b></code>
  </li>
  <li><b>Specify the permit or deny statements:</b> using the command <code><b>
  [permit | deny] {&lt;ip-address&gt; &lt;wildcard-mask&gt; | any}</b></code>. If specifying 
  a specific host IP address, use the <code><b>host</b></code> keyword instead of 
  adding the wildcard bit <code><b>0.0.0.0</b></code> using the command
  <code><b>
  [permit | deny] host &lt;ip-address&gt;</b></code>
  </li>
  <li><b>Apply the ACL to the interface</b> using the interface mode command  
    <code><b>ip access-group &lt;ACL-NAME&gt; [in | out]</b></code>.
  </li>
</ol>

#permit 192.168.1.0 0.0.0.128
#permit 192.168.1.128 0.0.0.128
</p>

<h2>Classical Numbered</h2>
<p>
To configure a classical numbered access control list:
<ol>
  <li><b>Configure the ACL:</b> in global configuration mode using the command 
  <code><b>access-list &lt;1-99&gt; [permit | deny] &lt;ip-address&gt; &lt;wildcard bit&gt;</b></code>.
  <ul>
	  <li> <code><b>permit</b></code>: implies that the traffic will not be 
	  filtered</li>
	  <li><code><b>deny</b></code>: implies that traffic will be filtered.</li>
	  </li>
  </ul>
  <p>
  A descriptive message can be added to the ACL using the <code><b>remark</b></code> 
  keyword <code><b>access-list &lt;acl-number&gt; remark &lt;descriptive-text&gt;</b></code>. This helps with 
  the documentation of the ACL.
  </p>
  </li>
  <li><b>Apply the ACL to the interface:</b> using interface mode command 
  <code><b>ip access-group &lt;acl-number&gt; [ in | out ]</b></code>. 
  When applying the ACL to the interface, the direction of operation should be stated:
     <ul>
       <li><b>in:</b> packets are filtered as they enter the interface. ACLs 
       must check every packet.</li>
       <li><b>out:</b> packets are filtered as they exit the interface. These are 
       preferred over inbound ACLs.</li>
     </ul>
     The default direction is "out".
  </li>
</ol>
</p>

<h3>Editing Numbered ACLs</h3>
<h4>Delete Numbered ACL</h4>
<p>
To delete a standard numbered ACL, use the command <code><b>no access-list &lt;acl-number&gt;</b></code>.
This deletes the entire ACL including all its ACEs.
</p>
<p>
If an ACL has been associated with an interface, and the ACL is subsequently 
deleted as demonstrated; however, the interface still references the ACL in its
configuration. The traffic filtering behaviour of the interface may become 
unpredictable. It is recommended that when deleting an ACL, the ACL be disassociated with the interface 
first using the command <code><b>no ip access-group [acl-number | acl-name]</b></code>,
thereafter the ACL can be deleted.
</p>

<h4>Modifying Existing ACE</h4>
<p>
To modify a numbered ACL:
<ol>
  <li>Display the ACE sequence numbers using the command <code><b>show access-lists &lt;acl-number&gt;</b></code>.
  </li>
  <li>
  Remove the ACE that is to be modified by referencing its sequence number using 
  the ACL mode command <code><b>no &lt;acl-number&gt;</b></code>. 
  </li>
  <li>
  Enter the new ACE
  </li>
</ol>
</p>

<h4>Adding a new ACE</h4>
<p>
  To add a new ACE, to a named standard ACL:
  <ol>
  <li>Display the ACL details to determine where to add the new ACE using the command 
  <code><b>show access-lists &lt;acl-number&gt;</b></code></li>
    <li>Enter the ACL configuration mode using the command <code><b>access-list &lt;acl-number&gt;</b></code> 
    or <code><b>ip access-list standard &lt;acl-number&gt;</b></code>.</li>
    <li>Configure the new ACE with a desired sequence number to the existing ACL using 
    the command <code><b>&lt;1-99&gt; [permit | deny] &lt;ip-address&gt; &lt;wildcard-mask&gt;</b></code>.
  </ol>
</p>


<h2>Modern Numbered</h2>
<p>
Any ACL whose number matches can be considered as an ACE that is part of the ACL
with the specific matching number. Standard ACLs have numbers ranging from 1 – 99
and the expanded range 1300 – 1999. Extended ACL numbers are 100 - 199 and 2000 – 2699.
</p>
<p>
#access-list 30 deny 192.168.1.10 0.0.0.0`

#permit any
</p>


<h2>Verification of Standard ACLs</h3>

<h3><code>show access-lists</code></h3>
<p>
The command <code><b>show access-lists</b></code> displays configured ACLs. If 
any ACEs are configured with the <code><b>log</b></code> option, a summary of 
matches is included in the display.
</p>
<p>
In the output of this command, the host statements are listed first in order to be 
efficiently processed by the IOS keeping the original sequence numbers. The 
range statements are listed after the host statements, in the order that they 
were configured along with their original sequence number. This is regardless of 
of whether they may have a lower sequence number. 
</p>

<h3><code>show ip interface &lt;interface-id&gt;</code></h3>
<p>
Displays any configured interfaces and the traffic filtering direction i.e., whether 
inbound or outbound.
</p>

<h1>Extended Access Control Lists</h1>
<p>
Compared to standard ACLs, extended ACLs provide increased granular control over 
traffic filtering. 
Extended ACLs can be numbered or named. Numbered extended ACLs are assigned a 
number in the range from 100 - 199 and 2000 - 2699. Named extended ACLs are 
assigned a unique name.
Extended ACLs are processed from top to bottom. 
</p>
<p>
Extended ACLs filter traffic based on a number of criteria:
<ul>
  <li>Protocol type i.e., IP, ICMP, EIGRP, OSPF, TCP, UDP etc.</li>
  <li>Source IP address</li>
  <li>Destination IP address</li>
  <li>Source port number (TCP or UDP)</li>
  <li>Destination port number (TCP or UDP)</li>
</ul>
</p>
<p>
Extended ACLs support a many layer 3 and layer 4 protocols. The protocols are 
defined using the protocol name or number. Some supported protocol names include:
eigrp, esp, ip, ospf, tcp, udp, icmp, gre. The  supported protocol numbers are 
in the range 0 - 255. TCP has a protocol number of 6, UDP 17, OSPF 89.
</p>
<p>
With named extended ACLs, an ACE can be added or deleted within the ACL using the 
sequence number of the ACE. When modifying an existing ACE, it should first be 
deleted using the command <code><b>no &lt;sequence-number&gt;</b></code>. Then 
the new ACE can be entered with the same sequence number as the deleted one. Adding 
a new ACE without indicating the sequence number adds it to the bottom of the ACL 
and generates the highest sequence number for the ACE.
</p>
<p>
#access-list 100 – 199 action (permit or deny) protocol (tcp, udp, ip) source_network 
wildcard_mask destination_network wildcard_mask matching_port_number port_number_or_protocol

Matching action:
<ul>
  <li>eq: match one specific port</li>
  <li>range: to match a specified range of ports</li>
  <li>gt: match ports greater than</li>
  <li>lt: match ports less than</li>
</ul>
</p>
<p>
A remark can be added to an ACL to describe the purpose of the ACL.

#access-list 150 deny tcp
Verification

#show access-lists

#show ip interface: to view ACLs configured on an interface.

<h2>Accessing Layer 3 Options</h2>
<p>
Layer-3 options are accessed using the <code><b>ip</b></code> keyword. These 
options include:
<ul>
  <li><b>dscp:</b> matches packets with given dscp value</li>
  <li><b>fragments:</b> Check non-initial fragments</li>
  <li><b>log:</b> Log matches against this entry</li>
  <li><b>options:</b> matches packets with a given IP Options value</li>
  <li><b>precedence:</b> matches packets with a given precedence value</li>
</ul>
</p>

<h2>Accessing Layer 4/5 ACL Options</h2>
<p>
Extended ACLs provide the ability to match on Layer-4 and/or Layer-5 information 
using the TCP or UDP keywords as the top-level protocol. The UDP header is very 
basic and does not have many options. The TCP header is extensive with several 
options:
<ul>
  <li><b>ack:</b> Match the ACK-bit</li>
  <li><b>established:</b> Match established connections.</li>
  <li><b>fin:</b> match the FIN bit</li>
  <li><b>fragments:</b> Check non-initial fragments</li>
  <li><b>gt:</b> Match only packets with a greater port number</li>
  <li><b>log:</b>  </li>
  <li><b>ttl:</b> match packets with a specific TTL value.</li>
</ul>
</p>

<h3>Matching on TCP/UDP Port Numbers</h3>
<p>
Matching on TCP/UDP port numbers also matches Layer 3 (IP) options as well. Matching 
of TCP or UDP port numbers can use keywords such as www, telnet, ftp, ftp-data or 
port numbers. However, not all port numbers have keywords associated with them.
When matching TCP/UDP, the source and/or destination port numbers are optional.
If the port numbers are not specified, then all protocol traffic will be permitted 
or denied depending on the configured action.

Session-layer(Layer-5) port numbers may be matched in a variety of ways:
<ul>
  <li><code><b>eq 23:</b></code> matching on an exact port number that "equals" 
  the supplied value</li>
  <li><code><b>lt 1000</b></code> matching on any value less than the supplied 
  value.</li>
  <li><code><b>gt 500</b></code> : matching on any value greater than the supplied 
  value.</li>
  <li><code><b>neq 20</b></code> : matching on any value not equal to the 
  supplied value.</li>
  <li><code><b>range 100-200</b></code> matching on any value in the supplied 
  range of values.
</ul>
</p>
<p>
When matching against port numbers, the destination port follows the destination 
IP address and the source port follows the source IP address. If you specify 
the protocol, source and destination IP addresses, source and destination port, etc,  
for a packet to match, all these parameters have to be the same for the packet,
to be registered as a match.
</p>

<h3>ACLs and Fragmentation</h3>
<p>
When a packet is fragmented by a router, the first fragment of the packet contains 
the layer-3 and layer 4 header details. With subsequent fragments, the layer 3 
header is copied from the first fragment; they do not contain the layer 4 header.
The TCP/UDP header is maintained only in the first fragment.
</p>
<p>
From an ACL perspective, matching on the TCP header fields matches on the first 
fragment of a packet. Subsequent fragments of the packet are not matched by this.
If the TCP header has the fragment offset value of 0(zero), then the packet is 
considered the first fragment or not a fragment at all. If a packet contains a 
value greater than zero in the fragment offset field, then this can be considered 
as not being a fragment. If a packet has a non-zero value for fragment offset, 
the router will permit the packet if the ACL is checking denying packets with 
specific TCP header values. This can be used in carrying out DoS attacks where 
fragmented packets are sent without sending the first fragment.
</p>
<p>
The <code><b>fragments</b></code> keyword is a layer 3 feature that can be used 
to query fragments.</p>
</p>
<p>
The TCP three-way handshake, when initiating a TCP connection, 
<ul>
   <li>Sender sets the SYNC flag</li>
   <li>Receiver sets ACK flag</li>
   <li>Sender sets ACK</li>
   </ul>
All subsequent traffic will contain ACK flags and reset flags set.
With this in mind, the traffic to a specific network/host can be permit to be 
initiated from a specific host/network and blocked if it is initiated from a different network/host.
The two potential solutions include:
<ol>
  <li>Matching on the ACK and reset flag.</li>
  <li>Matching on the established keyword</li>
</ol>
The two options do the same thing.
</p>

<h3>Sequence Numbers</h3>
<p>
When a new ACE is added to an ACL, by default, the first configured ACE is assigned 
a sequence number of 10. Subsequent ACEs have their sequence numbers generated in 
increments of 10 with the second ACE having sequence number 20, third ACE 30 and 
so on.
</p>
<p>
It is possible to modify the starting sequence number of an existing ACE as well 
as change the sequence number increment value using the command 
<code><b>ip access-list resequence &lt;acl-id&gt; &lt;starting-seq-number&gt; 
&lt;increment&gt;</b></code>. This feature is available for all ACLs.
</p>


<h2>Configuration</h2>
<p>
To configure an extended ACL:
<ol>
  <li><b>Define the extended ACL:</b> 
    <ol>
      <li><b>Classic numbered extended ACL:</b> 
  using the command <code><b>access-list 
  &lt;100-199 | 2000-2699&gt; [permit | deny] &lt;protocol&gt; &lt;source-ip&gt; [source-port] 
  &lt;destination-ip&gt; [destination-port]</b></code>.
  </li> 
  <li><b>Modern extended ACL:</b>
    <code><b>ip access-list extended  
  &lt;name | 100-199 | 2000-2699&gt; [permit | deny] &lt;protocol&gt; &lt;source-ip&gt; [source-port] 
  &lt;destination-ip&gt; [destination-port]</b></code>.
  </li>
  </ol>
  </li>
  <li>Specify the condition, protocol, destination and source addresses:  
  permit or match
</ol>
</p>

<h2>Extended ACLs in Routing Protocols</h2>
<h3>Interior Gateway Protocols</h3>
<p>
When applied to interior gateway protocols for network selection, source fields 
identify the network and destination fields identify the smallest prefix length 
in that network range. 
</p>
<p>
When matching networks in IGPs:
<ul>
  <li><code><b> permit ip any any </b></code>: permits all networks</li>
  <li><code><b>permit ip host 172.16.0.0 host 255.240.0.0 </b></code>: Permits all 
  networks in the range 172.16.0.0/12</li>
  <li><code><b>permit ip host 172.16.0.0 host 255.255.0.0 </b></code>: Permits 
  all networks in the 172.16.0.0/16 range</li>
  <li><code><b> permit host 192.168.1.1 </b></code>: Permits only the 192.168.1.1/32
  network</li>
</ul>
</p>

<h3>BGP</h3>
<p>
For BGP network selection, source fields identify the network and 
destination fields identify the network mask.
</p>
<p>
  <ul>
    <li><code><b>permit ip 10.0.0.0 0.0.0.0 255.255.0.0 0.0.0.0 </b></code>: Permits 
    only the 10.0.0.0/16 network</li>
    <li><code><b>Permit ip 10.0.0.0 0.0.255.0 255.255.255.0 0.0.0.0 </b></code>: 
    Permits any 10.0.any.0 network with a /24 prefix</li>
    <li><code><b>Permit ip 10.0.0.0 0.0.255.255 255.255.255.0 0.0.0.255 </b></code>: 
    Permits any 10.0.any.any network with a /24 - /32 prefix</li>
    <li><code><b>permit ip 10.0.0.0 0.0.255.255 255.255.255.128 0.0.0.127 </b></code>:
    Permits any 10.0.any.any network with a /25 - /32 prefix</li>
  </ul>
</p>

<h3>Extended ACLs in Packet Filtering</h3>
<p>
  <ul>
    <li>Allow all traffic</li>
    <li>Prevent 10.0.0.0/16 from sending UDP traffic to 192.168.1.1/32</li>
    <li>Prevent 172.16.1.1/32 from pinging hosts in 192.168.0.0/24</li>
    <li>Allow traffic from 10.0.0.0/16 to access the server at 2.2.2.2/32 using HTTPS</li>
    <li>Prevent all hosts using source UDP port numbers from 20000 - 30000 
    from accessing the server 3.3.3.3/32</li>
    <li>Allow hosts in 172.16.1.0/24 using TCP source greater than 9999 to access 
    all TCO ports on server  4.4.4.4 except port 23.
  </ul>
</p>


<h1>Applying an ACL</h1>
<h2>Packet Filtering using ACLs</h2>
<p>
ACLs are applied to an interface in a given direction; ingress or egress. Ingress 
is when traffic is entering a router interface and egress is when traffic is exiting the router through an interface.

To apply the ACL to an interface, you need to indicate the direction of traffic flow that the device should implement the ACL.

#ip access-group 1 out | in

Pinging a destination that is blocked by an ACL results in ICMP unreachable output indicated by U.U,U,U
</p>

<h1>Time-based ACLs</h1>
<p>
Time-based ACLs activate ACEs during times you define. Times are defined within 
a global time-range. Time-range can be periodic or absolute. Ensure that the 
device has an accurate clock.
</p>
<p>
Time-based ACLs are only active during a specified time range. The time-range 
configured on a router references the router’s clock. Configure NTP to ensure a 
correct clock. They are applied to extended ACLs.
It can be set to be periodic where it becomes active or inactive at specific times 
of the day or on specific days of the week e.g. every Wednesday from 10am – 2pm or 
absolute where there is a specific starting and stopping date and time.

You cannot create time-based rules that have the exact same protocol, source, 
destination, and service criteria of a rule that does not include a time range object. 
The non-time-based rule always overrides the duplicate time-based rule, as they are redundant.
</p>


<h2>Configuration of Time-based ACLs</h2>
<p>
<ol>
  <li><b>Ensure that the clock is accurate:<</b> 
    <p>
    <div><code>
    clock set hh:mm:ss dd month year
    </code></div>
    </p>
  </li>
  <li><b>Configure the time-range:</b>
    <ol type="a">
      <li><b>Define a global time-range:</b> 
		<p>
		<div><code>
		  time-range &lt;name&gt; <br> 
		</code></div>
		</p>
	  </li>
	  <li><b>Decide on absolute or periodic type:</b>
	  <p>
	  absolute happens only once and does not repeat. Periodic occurs repeatedly 
	  on the specified days. Time values are defined in 24-hour clock.
	  <code>
	  periodic weekdays 7:00 to 18:00
	  </code>
	  </li>
    </ol>
  </li>
  <li><b>Apply the time-range to the ACL:</b>
  <p>
  <div>
  <code><b>access-list deny tcp 2.2.0.0 0.0.255.255 any eq www time-range No-Internet</b><br>
  <b>access-list deny tcp 2.2.0.0 0.0.255.255 any eq 443 time-range No-Internet</b><br>
  <b>access-list permit ip any any</b>
  </code></div></p>
  </li>
  <li><b>Apply the ACL to the interface:</b> 
  <p>
  <code>
  <b>ip access-group 101 in</b>
  </code></p>
  
  </li>
</ol>
To configure a time-based ACL, you must specify the time-range, then apply it to the ACL.
</p>
<p>
#time-range TR_WORK_TIME
#periodic &lt;monday thru friday | weekend | weeekday&gt; 8:00 to 17:00
#absolute start hh:mm dd MM yy end hh:mm dd MM yyyy
#ip access-list extended ACL_FILTER_SOCIAL_MEDIA
#deny tcp any host 8.8.8.8 eq 80 time-range TR_WORK_TIME
</p>
<h2>Verification</h2>
<p>
#show time-range command will display ‘inactive’ if the current time is not within 
the range of the configured time.
</p>




<h1>Infrastructure ACLs</h1>
<p>
Is an extended ACL applied to routers residing at the edge of an enterprise network. 
The primary purpose is to prevent malicious traffic from entering the enterprise. 
It is usually applied inbound on the interface connecting to the external network.
</p>
<p>
#ip access-list extended INFRASTRUCTURE

#deny &lt;tcp | udp | icmp | ip &gt; any any fragments

#permit bgp | ssh | snmp | icmp …
</p>






<h1>Reflexive ACLs (IP Session Filtering)</h1>
<p>
Allows outbound traffic and limits inbound traffic in response to sessions that 
originate inside the router. 
Can be defined only with extended named IP ACLs.
Can be used in conjunction with other standard and static extended ACLs. 
</p>

<p>
Operates similar to a stateful firewall protecting internal users from external 
threats. Internal users are permitted to access external resources but external 
users cannot initial connections to internal resources.
Reflexive ACLs can be configured to track any protocol whether TCP, UDP, ICMP.
</p>

<p>
Reflexive ACLs permit a router to implement security features that firewalls 
implement where an inside network is labelled and an outside (and considered 
unsafe) network is identified. Connections initiated by hosts in the inside 
network and return traffic are permitted; traffic initiated by hosts in the 
outside network is denied. Reflexive ACLs monitor for permitted, outgoing data 
of any type. The type of expected traffic is defined e.g., SSH, HTTPS. An ACL is 
configured to permit the defined traffic types and the keyword reflect is added 
to this ACL. The reflex keyword causes the router to remember the traffic that 
matches the permitted traffic such as HTTPS session(source and destination, port
numbers, IP protocol field), and monitor all return traffic.  The reflexive ACLs 
create a mirror-image of transmitted traffic which will be permitted upon return; 
the return traffic is then expected to have the source and destination ports, 
source and destination IP addresses reversed. What was the source port in the 
original traffic will be the destination port in the return traffic.
</p>
<p>
Reflexive ACLs have create a mirror-image of transmitted traffic which will be 
permitted upon return.
The reflexive ACL creates a dynamic ACL on-the-fly where it is expecting and 
permitting a return packet. Return traffic is permitted because it matches the 
return traffic. 
</p>

<p>
Traffic that matches the implicit deny statement of the ACL does not trigger the 
creation of the reflexive ACL. Only permit statements create the reflexive ACLs
</p>

<p>
Reflexive ACLs should be applied on the interface connecting to the untrusted 
network/host.
</p>

<h2>Timeout Values</h2>
<p>
Reflexive entries expire after configurable timeout value. When this happens, that 
same TCP, UDP traffic will not be allowed on the interface. 
Reflexive ACLs have a timeout value that expires. This value can be configured.
After the expiry of the timeout value, the dynamic reflexive entry is removed and 
that same TCP and UDP information is no longer permitted on the interface.
</p>
<p>
<ol>
  <li>Graceful TCP close (2 segments seen with FIN flags). Timeout = 5 seconds.</li>
  <li>TCP reset: timeout is immediate.</li>
  <li>TCP packets no longer seen: timeout value is 300 seconds.</li>
  <li>UDP, ICMP and all others: timeout value is 300 seconds after last seen 
  packet</li>
</ol>
</p>
<p>
Timeout values for 1 and 2 can not be modified. The timeout values for 3 and 4 
can be modified.
</p>

<h2>Configuration</h2>
<p>
  <ol>
    <li><b>Configure a named extended ACL:</b> Can only be used with named 
    extended ACLs.
     <p>
<div>
<code>
ip access-list extended ACL_EGRESS<BR>
permit ip any any reflect MIRROR
</code>
</div>
</p>
<p>
The dynamic ACL MIRROR reflects the permitted traffic swapping the source and 
destination IP addresses, source and destination ports.
</p>

    </li>
    <li><b>Create a Named, Extended ACL for Monitoring ingress Traffic from Untrusted Sources:</b>
    <p>
      <div><code>
      ip access-list extended ACL_INGRESS<br>
      evaluate Mirror
      </code></div>
    </p>
    The name must match the name previously supplied after the "reflect" keyword.
    </li>
    
    <li><b>Apply both ACLs to interface facing untrusted networks:</b> 
    <p>
      <div><code>
       interface ga0/0<br>
       ip access-group ACL_EGRESS out<br>
       ip access-group ACL_INGRESS in
      </code></div>
    </p>
    </li>
    <li><b>Changing the timeout value:</b>
    The mirror ACL should be active for a defined period of time. If it is indefinite,
    this could become a security loophole.
    <ol>
      <li>Values for 1 and 2 cannot be changed.</li>
      <li>Vlues for 3 and 4 can be modified per ACE or globally.
        <ul>
          <li><b>Globally:</b> <code><b>ip reflexive-list timeout &lt;1-2147483&gt;</b></code>
          <li><b>Modifying within ACE Entries:</b>
          <p>
            <div><code>
            ip access-list extended ACL_EGRESS<br>
            permit tcp any any reflect Mirror timeout 30<br>
            permit udp any any reflect Mirror timeout 45<br>
            permit ip any any reflect Mirror timeout 120
            </code></div>
          </p>
        </ul>
      </li>
    </ol>
    </li>
  </ol>

</p>

<p>
To permit another protocol such as ICMP, adding the command 
<code><b>permit icmp any any</b></code> does not permit the traffic.

ICMP traffic has to be tracked on the ACL using the command 
<code><b>permit icmp any any reflect Mirror</b></code>.
</p>

<h2>Verification</h2>
<p>
The dynamic ACL created by the reflexive ACL can be verified using the command 
<code><b>show ip access-list</b></code>. This is used to determine if the reflexive 
ACL is in effect or not. 
Command displays the matched hosts even if the keyword "any" was used in the ACL.
</p>

<p>
Using the log keyword when defining the ACL will create Syslog messages that will 
indicate when the ACL was created.
</p>

<h2><code>debug ip access-list data-plane</code></h2>
<p>
Not recommended as it generates a lot of traffic on the network. To determine 
the timestamp when the reflexive ACL was created:
<ol>
  <li>disable logging to the console <code><b>no logging console</b></code>.</li>
  <li>Send logs with severity of debugging to the logging buffer using the command
   <code><b>logging buffer debug</b></code></li>
   <li>Increase buffer size: <code><b>logging buffer 100000</b></code></li>
   <li>Debug ACL: <code><code>debug ip access-list data-plabe</code></code></li>
   <li>To view the ACL creation timestamp: <code><b>show log | in Reflexive</b></code></li>
 </ol>
</p>






<h1>Dynamic Access Lists</h1>
<p>
Restrict network access to only authenticated users.  
</p>
<p>
Reflexive ACLs do not have absolute timeouts where regardless of activity or inactivity, 
traffic is denied at the absolute timeout interval. 
Dynamic ACLs provide support for permitting access based on an authentication 
server. Every authentication request is offloaded to a central authentication 
database. Might require manual configuration of each device. The device sends 
out an authentication request to the host before permitting access, e.g. SSH access 
to a network device.
</p>
<p>
Dynamic ACL forces the user to first telnet to the router; SSH support can alternatively 
be enabled. After successful 
authentication, Telnet session is closed and the dynamic ACL is created on the 
interface. Dynamic ACL is removed from the interface after configurable absolute-timeout 
or idle-timeout value expires.
</p>

<p>
Components of a dynamic access list inclide the following:
<ul>
  <li>Connection used for authentication: Telnet, SSH</li>
  <li>Extended Acces Control List (ACL) configured with dynamic entries</li>
  <li>Autocommand with access-enable option: this is implemented for the user, 
  or line level. 
    Autocommand: once authentication is successful, disconnect from the device. 
      Autocommand then executes access-enable.
    Access-enable ensures that the dynamic part of the ACL gets activated.
  </li> 
</ul>
</p>

<h2>Dynamic ACL Rules</h2>
<p>
Cannot be used to provide different access rights to different users. 
Dynamic ACLs may use either an idle-timeout or absolute timeout value.
Autocommand access-enable may be configured either: at the username level or 
within the VTY line. Dynamic ACLs are configured with named or numbered extended ACLs only.
Standard ACLs do not support dynamic ACLs.
</p>

<h2>Configuration</h2>
<p>
The use case for dynamic ACLs, if individuals require temporary access to the 
network, e.g. provide a user telnet access to a router for a specified period.
</p>
<p>
<ol>
  <li><b>Create a username:</b> 
  <code><b>username bob password 0 s3cr3t</b><br>
  </code>
  <p> The access can be enabled through the following methods:
  <ul>
    <li>
    <code><b>username bob autocommand access-enable timeout 5</b></code> Command temporarily present 
     the username and password prompt. 
		  <ul>
			<li><b>autocommand:</b> If they authenticate successfully or fail to 
		  authenticate three times unsuccessfully, close the authentication page.
			</li>
			<li><b>access-enable:</b> implement dynamic access list.</li>
			<li><b>timeout:</b> idle timeout value.</li>
			</ul>
     </li>
     <li>
       Add the autocommand directly under the VTY lines:
       <div>
       <code><b>line vty 0 4<br>
       autocommand access-enable timeout 5</b></code>
       </div>
     </li>
     </ul>
    </p>
    <p>
    The <code><b>autocommand</b></code> under the VTY line affects all users while 
    the command under the username applies only to that specific user and not others.
    </p>
  </li>
  <li>
  <b>Create the access list:</b> This applies to either named or numbered access-lists.
  <code><b>access-list 101 dynamic Project timeout 15 permit ip any any</b></code>. 
  The timeout specified here is the absolute timeout value. Both timeout values 
  can be specified. There is no default timeout value; if none of the timeout 
  values is not defined, then there is no timeout value for the dynamic ACL and 
  access is granted in indefinitely.
  <p>
  Only one ACE in an ACL can have the <code><b>dynamic</b></code> keyword. Typing 
  a second one triggers an error message.
  </p>
  </li>
  <li>
  <b>Create the ACE permitting the traffic to the router:</b> 
  <code><b>access-list 101 permit tcp any host 1.1.1.1 eq telnet</b></code>.
  </li>
  <li>
  Enable local login: 
  <div>
  <code>
  <b>line vty 0 4</b> <br>
  login local
  </code></div>
  </li>
  <li>
  Apply it to the interface pointing to the host that initiates the connection 
  in the inbound direction: A dynamic ACL is always in the inbound direction.
  <div><code>
    interface fastethernet0/0<br>
    ip access-group 101 in
  </code></div>
  </li>
</ol>
</p>


<h2>Timeout</h2>
<p>
Two timeout parameters can be configured: 
<ul>
 <li><b>Idle timeout:</b> One is enabled through the access-enable host command with the timeout 
 keyword where the value specified is in seconds.</li>
 <li><b>Absolute timeout:</b> specified with the dynamic entry</li>
</ul>
</p>



<h2>Clearing a Dynamic ACL</h2>
<p>
If a dynamic ACL is in place and you intend to delete it, use the command 
<code><b>clear ip access-template &lt;acl-name|acl-number&gt; &lt;dynamic-ACL-name&gt; 
&lt;source&gt; &lt;destination&gt; </b></code>.
</p>
<p>
If a dynamic ACL is cleared in the when a user has Telnet/SSH access, this 
access is disabled.
</p>

<h2>Extending Dynamic ACL Entries</h2>
<p>
IOS allows users to extend the life of their dynamic ACE by an additional 6 mminutes.
 Using the command <code><b>access-list dynamic-extended</b></code>, the user 
 Telnets back into the router and receives the additional time. The extended 
 value of 6 minutes is currently fixed and cannot be adjusted.
</p>

<h2>Monitoring</h2>
<p>

</p>

<h1>Object Groups</h1>
<p>
Object groups is a feature available in extended ACLs. Object group appears in 
the ACL high-level protocol field, source address field, destination address field.
Originally designed for ASA firewalls. Command syntax is slightly different on IOS 
routers than ASA firewalls. Object groups simplify ACL management by grouping 
similar "objects" together e.g., pubilc_web_servers group. It allows for more 
modular changes; a change to an object group dynamically affects all ACEs referencing 
that group.

Not every device supports object groups.
</p>
<p>
Traditionally, when modifying an existing ACL, the port that it is applied to 
is shutdown, and the ACEs of the ACL are modified. Then the port is re-enabled.
Usually, this configuration is carried out during out-of-office hours.

With object groups, the ACEs reference the object group. The object group can 
be modified and after completion, the ACL  gets updated without disabling a 
port that references the ACL.
</p>
<p>
On Cisco routers, there are two types of object groups: 
<ol>
  <li><b>Network group:</b> for defining IP address-related objects for example 
  host or subnet section of an ACE can be replaced by an object group and the ACE 
  references the object group.</li>
  <li><b>Service group:</b> for defining protocols and ports such as high-level 
  protocol, TCP/UDP port numbers,</li>
</ol>
</p>

<h2>Configuration</h2>
<p>
<div><code>
object-group network OUTSIDE_TRUSTED_HOSTS<br>
  host 200.0.0.1 <br>
  host 200.0.0.2 <br>
object-group network PUBLIC_INSIDE_SERVERS<br>
  host 10.0.0.100 <br>
  host 10.0.0.101 <br>
object-group service PUBLIC_INSIDE_SERVER_PORTS<br>
  tcp eq www <br>
  tcp eq 443<br>
  tcp eq smtp<br>
  
access-list 101 permit object-group PUBLIC_INSIDE_SERVER_PORTS object-group 
OUTSIDE_TRUSTED_HOSTS object-group PUBLIC_INSIDE_SERVERS
</code></div></p>

</p>
<h3>Object Groups with Dynamic ACLs</h3>
<p>
<div><code>
object-group network SOURCE<br>
  host 11.11.11.1 <br>
object-group network DESTINATION<br>
  host 22.22.22.22 <br>
  host 2.2.2.2 <br>
object-group service CONTRACTOR<br>
  tcp eq telnet  <br>
  icmp<br>
ip access-list extended Test <br>
 dynamic  PROJECT permit object-group CONTRACTOR object-group SOURCE object-group DESTINATION<br>
 permit tcp host 11.11.11.1 host 1.1.1.1 eq telnet <br>
 
 !Apply to interface:<br>
 ip access-group TEST in<br>
  </code></div>
</p>

<h2>Verification</h2>
<h3><code>show object-group</code></h3>
<p>
Displays the configuration of the object group.
</p>


<h1>Logging</h1>
<p>
ACE entries can be appended with logging-related keywords: <code><b>log</b></code> 
and <code><b>log-input</b></code>. 
These commands cause log messages to be generated if a packet matches the ACE
providing hit-counts and evidence of ACL activity. Logging forces packets matching the ACE 
entries to be process-switched resulting in increased CPU load. Additionally, 
printing out Syslogs increase the CPU load.
</p>
<p>
With log:
<ul>
  <li>Timestamp information is displayed</li>
  <li>ACL number</li>
  <li>Protocol</li>
  <li>Source and destination address</li>
  <li>Interface ACL is applied to (0/0)</li>
  <li>Number of packets matched</li>
</ul>

With <code><b>log-input</b></code>, additional information is displayed particularly 
the MAC address; this is the most recent MAC address.
</p>
<p>
An additional descriptive text can be added to the ACE to describe the particular 
role of the ACE e.g. <code><b>access-list 101 permit icmp any host 2.2.2.2 log-input EmailServer</b></code>.
This tags the ACE for traffic to the email server.
</p>

<h2>Log Interval</h2>
<p>
Individual ACEs can have the "log" or "log-input" keywords. When an ACL is applied 
to an interface, syslogs are generated:
<ul>
  <li>Once every 5 minutes for packets matching a particular ACE. The summary 
  of the number of packets that were matched over the last 5 minutes is displayed.</li>
  <li>If any log-enabled ACE in any ACL on any interface matches a packet within 
  one second of the initial log message, the match or matches aggregated statistics for 
  5 minutes are then reported.
</ul>
</p>
<p>
If you want logs for ACEs to be displayed more frequently than every 5 minutes, use 
the command <code><b>ip access-list log-update threshold &lt;0-2147483647&gt;</b></code>
with the value being the number of hits; display a syslog after x number of packets 
match the ACE. This applies to all ACEs of an ACL.
</p>
<p style="font-weight:bold;">
This increases the CPU Load. Even though logs for individual ACEs are only 
displayed every 5 minutes, every packet that matches the ACE must be process-switched.
</p>
<p>
To reduce this; use the command <code><b>ip access-list logging interval 
&lt;0-214748367&gt; </b></code>. The value is in milliseconds; for all the 
packets that match the ACE, send packets to the CPU every nth (configured) 
interval.
</p>

<h3>Filtering on Log Output</h3>
<p>
ACL syslogs have different identifiers depending on type of traffic that triggered 
the log.
</p>
<p>
  <img alt="LOG-CODES" src="">
</p>
<p>
When sending ACL syslogs to logging buffer, one can filter one these identifiers:
<ol>
  <li>Severity: 0-7: <code><b>logging buffer &lt;severity&gt;</b></code></li>
  <li>Filter the log output based on the applicable protocol: <code><b>show log | 
  include RP</b></code> filters for TCP and UDP generated logs. This displays 
  permitted or denied Syslogs.
</ol>
</p>

<h1>IPv6 ACLs</h1>
<p>
IPv6 ACls are only named ACLs. They offer similar features to extended ACLs. 
IPv6 ACLs use the prefix length instead of wilcard masks to match.
The host keyword can also be used with IPv6 ACLs.
</p>