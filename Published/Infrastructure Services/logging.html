
<p>
Logging can be used for fault identification, security auditing and network 
forensics. Logging aims to answer the three questions: what, when, who? 
Log messages are generated by the various services and protocols running on a network 
device. 
By default, output from system messages and debug commands is sent to a logging 
process. The logging process controls the distribution of logging messages to various 
destinations, such as the logging buffer, terminal lines, syslog server.
Messages are also sent to the console.
These are then viewed using syslog, local logging, debugs, conditional 
debugs. Logs are also used for forensics and compliance.
It is important to note that the time must be consistent. This can be done by 
configuring NTP to provide accurate datetime values. Troubleshooting 
can be difficult if you cannot correlate timestamps across devices.
</p>
<h2>Logging Messages</h2>
<p>
Syslog messages can be output to the console, local buffer or remote syslog server.
The messages follow this format:</p>
<p align="center">
<b>%FACILITY-SUBFACILITY-SEVERITY-MNEMONIC: message text</b>
</p>
<p>
Where:
<ul>
  <li><b>FACILITY-SUBFACILITY:</b> protocol, module or process that 
  generated the message.</li>
  <li><b>SEVERITY:</b> This is a level from 0 - 7 that specifies how important 
  the message is. When you enable logging for a specific level, it also enables 
  all levels above it. For example, if you enable level 4(warnings), it also will 
  enable levels 0 - 3.
  <p>
    <table cellspacing="0" width="100%">
      <thead style="background: #d3d3d3; font-weight:bold;">
        <tr>
          <td style="border-bottom:1px solid; border-top: 1px solid;">Level Number</td>
          <td style="border-bottom:1px solid; border-top: 1px solid;">Severity</td>
          <td style="border-bottom:1px solid; border-top: 1px solid;">Description</td>
          <td style="border-bottom:1px solid; border-top: 1px solid;">Syslog Definition</td>
        </tr>
      </thead>
      <tbody>
 
        <tr> 
          <td style="border-bottom: 1px solid;">0</td>
          <td style="border-bottom: 1px solid;">Emergencies</td>
          <td style="border-bottom: 1px solid;">System is unusable</td>
          <td style="border-bottom: 1px solid;">LOG_EMERG</td>
        </tr>
        <tr> 
          <td style="border-bottom: 1px solid;">1</td>
          <td style="border-bottom: 1px solid;">Alerts</td>
          <td style="border-bottom: 1px solid;">Action must be taken immediately</td>
          <td style="border-bottom: 1px solid;">LOG_ALERT</td>
        </tr>
        <tr> 
          <td style="border-bottom: 1px solid;">2</td>
          <td style="border-bottom: 1px solid;">Critical</td>
          <td style="border-bottom: 1px solid;">Critical conditions</td>
          <td style="border-bottom: 1px solid;">LOG_CRIT</td>
        </tr>
        <tr> 
          <td style="border-bottom: 1px solid;">3</td>
          <td style="border-bottom: 1px solid;">Errors</td>
          <td style="border-bottom: 1px solid;">Error conditions</td>
          <td style="border-bottom: 1px solid;">LOG_ERR</td>
        </tr>
        <tr> 
          <td style="border-bottom: 1px solid;">4</td>
          <td style="border-bottom: 1px solid;">Warnings</td>
          <td style="border-bottom: 1px solid;">Warning conditions</td>
          <td style="border-bottom: 1px solid;">LOG_WARNING</td>
        </tr>
        <tr> 
          <td style="border-bottom: 1px solid;">5</td>
          <td style="border-bottom: 1px solid;">Notifications</td>
          <td style="border-bottom: 1px solid;">Normal but significant conditions</td>
          <td style="border-bottom: 1px solid;">LOG_NOTICE</td>
        </tr>
        <tr> 
          <td style="border-bottom: 1px solid;">6</td>
          <td style="border-bottom: 1px solid;">Informational</td>
          <td style="border-bottom: 1px solid;">informational messages</td>
          <td style="border-bottom: 1px solid;">LOG_INFO</td>
        </tr>
        <tr> 
          <td style="border-bottom: 1px solid;">7</td>
          <td style="border-bottom: 1px solid;">Debugging</td>
          <td style="border-bottom: 1px solid;">debug-level messages</td>
          <td style="border-bottom: 1px solid;">LOG_DEBUG</td>
        </tr>
      </tbody>
    </table>
    </p>
  </li>
  <li><b>MNEMONIC:</b> a code that identifies the action reported</li>
  <li><b>Message text:</b> A plain text description of the event</li>
</ul>
</p>


<h1>Local Logging</h1>
<p>
By default, all logging is displayed on the console. This can be turned off with 
the <code><b>no logging</b></code> command.  
By default, monitor and buffer logging display messages with severity 
levels of debugging and lower.
For SSH/Telnet, the logging session settings can be configured using the command 
<code><b>terminal monitor</b></code>
</p>

<h2>Logging Console</h2>
<p>
To enable logging to console, use the command <code><b>
logging console</b></code>. By default, the logging severity level for console is 
debugging. To control the logging options, use the command <code><b>logging console &lt;level&gt;</b></code>.

<h2>Logging Buffer</h2>
<p>
For local logging, Cisco IOS can save syslog messages to an internal buffer i.e., 
all the logs are saved on the device itself. You 
can display these messages by using the <code><b>show logging</b></code> command. 
</p>
<p>
These messages are lost when the device is rebooted. The default buffer size is 
8192 bytes. When the buffer is full, the older logs get overwritten by the newer ones.
The size of the buffer can be increased using the command:
<code><b>logging buffered &lt;size&gt;</b></code>.
</p>

<h2>Logging Monitor</h2>
<p>
To enable logging to remote logins via SSH or telnet, use the command <code><b>
logging monitor &lt;level&gt;</b></code>. The default logging severity is debugging.
However, by default, the log messages do not appear in the login session of of SSH 
or telnet. To view the log messages in the login session of a vty line, issue 
the command <code><b>terminal monitor</b></code>.
</p>
<p>
Logging messages can be disabled from a vty login session using the command 
<code><b>terminal no monitor</b></code>.
</p>


<h2><code>logging synchronous</code></h2>
<p>
The command <code><b>logging synchronous [level &lt;severity-level&gt;|all] | 
limit &lt;0-2147483647&gt;</b></code>.
Enables synchronous logging of messages. It can be configured to prevent logging 
messages from interrupting the typing at a login session. 
The optional values:
<ul>
<li><b>severity-level:</b> indicates that messages with a severity 
level equal to or higher are printed asynchronously. The default is 2.</li>
<li><b>limit:</b> specifies the number of buffers to be queued for the terminal 
after which new messages are dropped. The default is 20. 
</ul>
</p>

<h2>Logging Flash</h2>
<p>
Logs can be stored as files on flash memory. This is accomplished using the 
command 
<code><b>logging file flash:&lt;file-name&gt; &max-file-size&gt; &lt;min-file-size
&gt; &lt;severity-level&gt;</b></code> where
<ul>
  <li>The maximum file size is in the range 4096 - 2147483647 bytes.</li>
  <li>The default size is 4096.</li> 
  <li>The minimum file-size is in the range 1024 - 2147483647 bytes.</li>
  <li>The severity-level is in the range 0 - 7.</li>
</ul>

The command <code><b>logging file flash:log_message.txt 40960 4096 3</b></code> 
stores log messages in a file in a flash memory. 
</p>

<h1>Debug</h1>
<p>
Debugging is a powerful tool for troubleshooting complex network issues. 
It displays detailed information about all supported protocols and features of 
the network device. Use the <code><b>debug</b></code> command with caution, on 
production networks, as it is a resource intensive tool and may impact operations.
Debugging can disrupt operations under high-CPU load conditions as debugging 
is processed by the CPU.
</p>
<p>
Best practices when using debugging include the following:
<ul>
  <li><code><b>show process cpu sorted</b></code>: helps understand current CPU 
  utilization. If the router is already loaded, debugging may impact the router.</li>
  <li>Consider output volume and time before enabling debug. If output is 
  voluminous, this may impact router performance.</li>
  <li>Excessive console logging can cause the network device to hang as its 
  CPU prioritizes this output. Use vty <code><b>terminal monitor</b></code> or logging buffered 
  instead.</li>
  <li>Disable debug commands after troubleshooting using <code><b>no debug all</b></code> 
  or <code><b>undebug all</b></code>.</li>
</ul>
</p>
<p>
Debugging messages can be enabled using the command <code><b>debug &lt;command&gt;</b></code>.
The debugging messages can then be sent to a logging service, in this case the 
console using the command <code><b>logging console</b></code>.
</p>
<p>
The following is an example of the debugging of OSPF: <code><b>debug ip ospf 
adj</b></code>.
</p>

<h2>Debug using IP Access Lists</h2>
<p>
 It allows debugging information that matches a configured IP access control list.
 
</p>
<p>
<div><code>
<b>access-list 100 permit ip any 192.168.1.1 0.0.0.0</b><br>
<b>debug ip packet 100</b>
</code></div>
</p>
<p>
Any debugs that do not match the access control list are not logged.
</p>


<h1>Conditional Debugs</h1>
<p>
Generates detailed information about a specific object such as matching a specific 
interface, username, MAC address, VLAN, etc.
Limit the number of packets punted to the CPU.  Conditional debugs are configured using the command 
<code><b>debug condition &lt;interface&gt;</b></code>. Conditional debugs can be 
stacked as such that the debugging messages that are displayed match all conditions 
in the stack.
</p>
<p>
<div><code>
<b>debug condition gigabitethernet1/0<br>
debug condition ip 1092.168.1.1<br>
debug ip ospf hello</b>
</code></div>
</p>
<p>
The above configuration will generate debug messages if they match all three 
commands.
</p>

<p>
To log debug messages for packets matching an ACL and specific interface: 
<code><b>debug interface &lt;interface-id&gt;</b></code>. Verify with <code><b>
show debug</b></code>.
</p>
<p>
With conditional debugs, you can attach an access-list to filter debug traffic to 
permitted traffic in the acces-list.
</p>
<h3>Verification</h3>
<p>
show debug
</p>
<p>
After disabling the debug, ensure that the debug condition is disabled as well.
</p>

<h3><code>show debug</code></h3>
<p>
Enabled debugging can be viewed using this command.
</p>

<h1>Syslog</h1>
<p>
Logs generated by a device can be sent to a logging buffer whose size can be 
modified, or an off-box syslog collector. Syslog listens 
for log messages on UDP port 514. 
Syslog is the standard for computer message logging. It allows the separation of 
software which generates messages from the systems that store it and the software 
that analyzes and reports it. It can be used for the security auditing and system 
management, debugging messages and analysis. The syslog is supported by a wide 
range of devices, including routers and receivers over multiple platforms. The 
syslog is used to intergrate the log data from many various types of systems 
into the central repository. <!--The format of the syslog packe is HEADER MSG.-->
</p>

<p>
Rate-limit: used to limit the rate of messages per second.
</p>
<p>
The syslogs can be forwarded to a syslog server using the following process
<ol>
  <li><b>Specify the syslog server:</b> <code><b>
logging host &lt;ip-address&gt;</b></code>.</li>
<li><b>Specify the type of messages:</b> the message type to be logged is specified 
using the command <code><b>logging trap &lt;severity&gt;</b></code>.
</ol> 
</p>

<h1>Filtering Logs</h1>
<h2>Logging Discriminator</h2>
<p>
A logging discriminator can be used to filter generated logs based on the text in 
the log. Log discriminators can be used to filter out specific logs that are repeatedly 
generated consuming the device log buffer. Some logs have a high severity level 
but are not so consequential such as up-down messages. It can be applied to the console, monitor, 
buffer or syslog server.
</p>
<p>
When creating a log discriminator, be as specific as possible and test the 
discriminator extensively before deploying it in a production environment. This 
will minimize the risk of filtering important messages.
</p>

<p>
To create a syslog message discriminator, use the command <code><b>logging 
discriminator &lt;discriminator-name&gt; &lt;facility&gt; &lt;mnemonics&gt; 
&lt;message-body&gt; &lt;includes&gt; &lt;severity&gt; rate-limit&gt; </b></code> 
where:
<ul>
<li><b>facility:</b> (Optional) Message subfilter for the facility pattern in an event message.</li>
<li><b>mnemonics:</b> (Optional) Message subfilter for the mnemonic pattern in an event message.</li>
<li><b>msg-body:</b> (Optional) Message subfilter for the msg-body pattern in an event message.</li>
<li><b>drops:</b> Drops messages that match the pattern, including the specified regular expression.</li>
<li><b>includes:</b> Delivers messages that match the pattern, including the specified regular expression string.</li>
<li><b>string:</b> (Optional) Expression used for message filtering.</li>
<li><b>severity:</b> (Optional) Message subfilter by severity level or group.</li>
<li><b>sev-num:</b> (Optional) Integer that identifies the severity level or multiple levels. Multiple levels must be separated with a comma (,)/</li>
<li><b>rate-limit:</b> (Optional) Specifies a number of messages to be processed within a unit of time.</li>
<li><b>msglimit:</b> (Optional) Integer in the range of 1 to 10000 that identifies the number of messages not to be exceeded.</li> 
</ul>
</p>
<p>
To configure a logging discriminator:
<ol>
  <li>Configure the logging discriminator name and filtering options:
  <p>
     <div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
  <code>
    <b>logging discriminator  msg-body drops Configured from console by console</b>
  </code></div>
  </p>
  </li>
  <li><b>Application:</b>
    <ul>
      <li>To apply the logging discriminator to the console, use the command <code><b>
          logging console discriminator &lt;discriminator-name&gt;</b></code></li>

      <li>To apply the logging discriminator to the monitor, use the command <code><b> 
      logging monitor discriminator &lt;discriminator&gt;</b></code>.</li>
   </ul>
  </li>
</ol>
</p>

<h1>Verification</h1>
<p>
Configured logging settings can be viewed using the command <code><b>show logging</b></code>.
</p>

<h1>Timestamps</h1>
<p>
Timestamps are controlled by the <code><b>service timestamps</b></code> command.
This command by itself enables the adding of timestamps to debug messages and, 
by default, sets the timestamps to uptime.

</p>
<p>
Having logs and debug messages timestamped is extremely important when troubleshooting
particularly across different devices. To enable timestamps on logging and debug 
messages:
<ul>
  <li><code><b>service timestamps debug datetime msec</b></code>: Adds timestamps 
  to debug messages including milliseconds. The datetime option includes the 
  date and the time.</li>
  <li><code><b>service timestamps log datetime msec</b></code>: Adds the timestamps 
  to logging messages. Options include:
    <ul>
      <li><b>datetime:</b> This option alone enables the date (day of month and 
      month) and time(hours, minutes and seconds). Additional options include:
      <ul>
        <li>localtime: use the local timezone for timestamps.</li> 
        <li>msec: include milliseconds in the timestamp.</li> 
        <li>show-timezone: add timezone information to the timestamp.</li> 
        <li>year: include the current year in the timestamp.</li>
        </li>
        </ul>
      </li>
      <li><b>uptime:</b> does not include additional options as does datetime.</li>
    </ul>
  </li>
</ul>
</p>

<h1>Sequence Numbers</h1>
<p>
If there is more than one log message with the same time stamp, you can display 
messages with sequence numbers to view these messages. By default, sequence numbers 
in log messages are not displayed. 

Sequence numbers can be added to log messages using the command <code><b>service 
sequence-numbers</b></code>. When enabled, they are prepended to the log message 
appearing at the start of a log message.
</p>