<h1>Overview of Control Plane Policing (CoPP)</h1>
<p>
CoPP is a QoS feature used in security that rate-limits the traffic handled by the 
route processor (RP).
CoPP is a modular QoS CLI (MQC) policy to rate-limit, drop and granularly permit 
traffic to or from the RP.

The RP handles traffic that is categorized into three planes:
<ul>
  <li>Data plane</li>
  <li>Management plane</li>
  <li>Control plane</li>
</ul>
</p>
<p>
The control plane is a collection of processes that run at the process level on
the route processor (RP). These processes collectively provide high-level control for 
most IOS functions. All packets destined for the control plane pass through the central 
switch engine before they are forwarded to the process level. The control-plane 
and central switch engine are part of the RP.
</p>
<p>
Majority of traffic managed by the RP is handled by way of the control and 
management planes. Such traffic includes:
<ul>
  <li>Routing protocol updates (IGP, BGP)</li>
  <li>Management traffic such as SNMP, SSH, Telnet, NTP, HTTP(S), etc.</li>
  <li>Traffic destined for a local IP address of the switch/router i.e., the 
  local router or switch is the destination of the traffic.</li>
</ul>
</p>
<p>
Control-plane Policing (CoPP) provides rate-limiting and filtering capabilites to 
control the number of packets that have to be processed by the RP of a router or switch. 
This helps in reducing the load on 
a router’s RP at any given point in time. It helps protect the RP from 
denial-of-service (DoS) attacks, and other flooding attacks, reconnaisance attacks.
</p>
<p>
When implementing CoPP, it is important to rate-limit traffic on all interfaces destined for the 
local router. A logical interface exists on all routers called the control plane 
interface. Rate-limiting packets on this interface applies the rate-limit to all 
the physical interfaces. Quality of Service (QoS) and policing on the control 
plane interface rate-limits packets entering any interface to protect the RP.
</p>

<h1>Configuring CoPP</h1>
<p>
To implement CoPP, the following sequence of steps should be followed:
<ol>
  <li>Categorize network traffic into classes using Access Control List (ACLs).</li>
<li>Create a Class Map (CM) to identify traffic to be policed (rate-limited).</li>
<li>Create a Policy Map (PM) to define the action to take on identified traffic 
by implementing a defined policy.</li>
<li>Create a Service Policy which specifies where to apply the policy map</li>
</ol>
</p>
<p>
CoPP is hardware-accelerated if the command <code><b>mls qos</b></code> is 
applied.
</p>


<h2>Categorize Network Traffic using ACLs</h2>
<p>
Traffic to be rate-limited needs to first be identified and categorized into different classes 
based on importance, function or protocol type.
</p>
<p>
ACLs are used to identify and classify traffic to be rate-limited.
These classes include: BGP, IGP, critical applications, file management, 
interactive management, monitoring, and default. A separate ACL should be configured 
for each of these traffic categories. 
Each ACL should permit all known protocols in its class. Traffic for the default 
class should be configured to permit any type of traffic e.g 
<code><b>permit ip any any</b></code>.
</p>
<p>
Extended ACLs are usually used for classifying traffic as they can be 
configured to match the traffic port/protocol numbers.
</p>
<p>
During categorization of traffic, it is important to note that traffic for certain classes 
 such as SNMP, (T)FTP, GRE, is originated from known sources. In such cases, the 
 ACE entries in these ACLs should explicitly define the source IP address. If the 
 ports for these traffic sources is known, then the ACEs should 
 be configured to permit traffic from these specific port numbers as well.
</p>
<p>
The different traffic categories include:
<ul>
  <li><b>BGP:</b> For maintaining BGP operations such as neighbor formation and 
  maintenance, prefix exchange. BGP uses TCP port source port 179; when configuring 
  ACE entries, the BGP port number or keyword <code><b>bgp</b></code> are valid 
  high-level protocols for matching against.
  <P>
<div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
  <code>
R1(config)#<b>ip access-list extended ACL_COPP_BGP</b><br>
R1(config-ext-nacl)#<b>remark BGP traffic</b><br>
R1(config-ext-nacl)#<b>10 permit tcp any eq bgp any gt 1024</b><br>
R1(config-ext-nacl)#<b>20 permit tcp any gt 1024 any eq bgp established</b><br>
</code></div>
</P>
  </li>
  <li><b>IGP:</b> traffic for formation and maintenance of IGP protocols such as 
  EIGRP, OSPF, RIP. OSPF uses IP protocol number 89 and IPv4 multicast addresses 
  224.0.0.5 and 224.0.0.6 or IPv6 multicast address FF02::5 and FF02::6. EIGRP uses IP protocol number 88 and IPv4 multicast address 
  224.0.0.10  IPv6 multicast address FF02::A. The IP protocols can also be matched 
  using the keywords <code><b>eigrp</b></code> or <code><b>ospf</b></code>.
  
  <P>
<div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
  <code>
R1(config)#<b>ip access-list extended ACL_COPP_IGP</b><br>
R1(config-ext-nacl)#<b>10 permit ospf any host 224.0.0.5  </b><br>
R1(config-ext-nacl)#<b>20 permit ospf any host 224.0.0.6  </b><br>
R1(config-ext-nacl)#<b>30 permit ospf host 224.0.0.5 any  </b><br>
R1(config-ext-nacl)#<b>50 permit eigrp any host 224.0.0.10</b><br>
R1(config-ext-nacl)#<b>60 permit eigrp host 224.0.0.10 any</b><br>
</code></div>
</p>

  </li>
  <li><b>Monitoring and Reporting:</b> traffic for monitoring the switch or router
  such as ICMP, IP SLA.
  <p>
<div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
  <code>
R1(config)#<b>ip access-list extended ACL_COPP_MONITOR</b><br>
R1(config-ext-nacl)#<b>10 permit icmp any any</b><br>
R1(config-ext-nacl)#<b>10 permit icmp any any echo</b><br>
R1(config-ext-nacl)#<b>20 permit icmp any any echo-reply</b><br>
R1(config-ext-nacl)#<b>30 permit icmp any any unreachable</b><br>
R1(config-ext-nacl)#<b>40 permit icmp any any port-unreachable</b><br>
</code></div>
</p>
  </li>
  <li><b>Interactive Management:</b> traffic that is interactive in nature and is 
  required for routine network operations such as SSH, Telnet, SNMP, NTP, TACACS.
  This type of traffic is usually low-volume.
  <p>
  <div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
  <code>
  R1(config)#<b>ip access-list extended ACL_COPP_INT_MGMT</b><br>
  R1(config-ext-nacl)#<b>remark Interactive file management</b><br>
  R1(config-ext-nacl)#<b>10 permit tcp host 10.20.2.1 host 10.1.10.1 eq 22 </b><br>
  R1(config-ext-nacl)#<b>20 permit udp host 10.1.10.1 host 10.30.5.1 eq 161</b><br>
  R1(config-ext-nacl)#<b>30 permit udp host 10.1.10.1 host 10.30.5.1 eq 162</b><br>
  R1(config-ext-nacl)#<b>50 permit udp host 10.1.10.1 host 10.80.1.1 eq ntp</b><br>
  
  </code></div>
  </p>
  </li>
  <li><b>File Management:</b> this type of traffic is used to transfer files. 
 Protocols in this category include: TFTP, FTP.
  This type of traffic is usually high-volume.
  <p>
  <div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
  <code>
  R1(config)#<b>ip access-list ACL_COPP_FILE_MGMT</b><br>
  R1(config-ext-nacl)#<b>10 permit tcp any host 10.1.10.1  eq ftp</b><br>
  R1(config-ext-nacl)#<b>20 permit tcp host 10.1.10.1 eq ftp any</b><br>
  R1(config-ext-nacl)#<b>30 permit tcp any host 10.1.10.1 eq ftp-data established</b><br>
  R1(config-ext-nacl)#<b>40 permit tcp host 10.1.10.1 eq ftp-data any established</b><br>
  </code></div>
  </p>
  </li>
  <li><b>Critical applications:</b> protocols in this category include GRE, HSRP, 
  GLBP, DHCP, IPsec, VRRP, IGMP, multicast traffic.
  <p>
  <div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
  <code>
  R1(config)#<b>ip access-list extended ACL_COPP_CRITICAL_APPLICATIONS</b><br>
  R1(config-ext-nacl)#<b>remark Critical applications</b><br>
  R1(config-ext-nacl)#<b>10 permit udp host 0.0.0.0 host 255.255.255.255 eq bootpc</b><br>
  R1(config-ext-nacl)#<b>20 permit udp host 10.10.1.20 eq bootps any eq bootps</b><br>
  R1(config-ext-nacl)#<b>30 permit ip any host 22.0.0.2</b><br>
  </code></div>
  </p>
  <p>
  <code><b>bootpc</b></code> and <code><b>bootps</b></code> are the keywords for 
  DHCP.
  </p>
  </li>
  <li><b>Undesirable:</b> malicious traffic that should not be allowed to be 
  processed by the RP. Such traffic may be generated by malware. The port numbers, 
  transport protocol used etc of malware can only be known if the malware has 
  has been profiled .</li>
  <li><b>Default:</b> traffic that does not fit into any of the above categories.
  This traffic should be rate-limited until some specific types within this category 
  can be classified and grouped into newer groups or classified under existing
  (above) listed groups.</li>
</ul>
</p>


<h2>Create Class Maps to Define Traffic Class</h2>
<p>
Class maps are used to define classes of the traffic to be rate-limited.
A class map may reference an ACL, protocol, IP Prec or IP DSCP values in a packet.
</p>

<p>
A separate class-map should be created for each of the configured ACLs for 
each traffic category. Class-maps have a default class-map that deals with 
traffic that is not explicitly defined. A separate class-map should be explicitly 
configured for the default traffic ACL.
</p>

<p>
<ol>
<li><b>Define the class map name:</b> using the command 
<code><b>class-map &lt;match-any | match-all&gt; &lt;class-map-name&gt;</b></code>.
The matching instruction is <code><b>match-any</b></code> or <code><b>match-all</b></code>
<ul>
      <li><code><b>match-any:</b></code> traffic must match only one of the commands to be classified 
      as part of the traffic class.</li>
      <li><code><b>match-all:</b></code> traffic must match all the match commands to be part of the 
      traffic class. Care must be taken with <code><b>match-all</b></code> keyword as the traffic 
      will have to match all characteristics in all the match commands.</li>
</ul>
</li>
<li><b>Specify how the traffic will be matched:</b> using the command 
<code><b>match [access-group [&lt;acl-number&gt; | name &lt;acl&gt;] | protocol | ip prec | ip dscp]</b></code>
<ul>
    <li><b>Access-group:</b> reference the previously configured access control list  
    <code><b>match</b></code> statement. ACL names are case sensitive.</li>
    
    <li><b>Protocol:</b> You can match by protocol instead of ACL; for example 
    to match ARP packets; <code><b>match protocol arp</b></code></li>
    <li><b>IP Prec | IP dscp:</b> to match against an IP packet's Precedence or 
    DSCP fields</li>
</ul>
</li>
</ol>
</p>
<p>
<div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
  <code>
R1(config)#<b>class-map match-all CM_COPP_BGP                             </b><br>
R1(config-cmap)#<b>match access-group name ACL_COPP_BGP                   </b><br>
R1(config)#<b>class-map match-all CM_COPP_CRITICAL_APPLICATIONS           </b><br>
R1(config-cmap)#<b>match access-group name ACL_COPP_CRITICAL_APPLICATIONS </b><br>
R1(config-cmap)#<b>exit                                                   </b><br>
R1(config)#<b>class-map match-all CM_COPP_FILE_MGMT                       </b><br>
R1(config-cmap)#<b>match access-group name ACL_COPP_FILE_MGMT             </b><br>
R1(config-cmap)#<b>exit                                                   </b><br>
R1(config)#<b>class-map match-all CM_COPP_IGP                             </b><br>
R1(config-cmap)#<b>match access-group name ACL_COPP_IGP    </b> <br>
R1(config-cmap)#<b>class-map match-all CM_COPP_INT_MGMT    </b> <br>
R1(config-cmap)#<b>match access-group name ACL_COPP_MGMT   </b> <br>
R1(config-cmap)#<b>class-map match-all CM_COPP_MONITOR     </b> <br>
R1(config-cmap)#<b>match access-group name ACL_COPP_MONITOR</b> <br>
R1(config-cmap)#<b>class-map match-all CM_COPP_DEFAULT     </b> <br>
R1(config-cmap)#<b>match access-group name ACL_COPP_DEFAULT</b> <br>
</code></div>
</p>
<h4>Verification</h4>
<p>
<div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
  <code>
R1#<b>show class-map</b><br>
 Class Map match-all CM_COPP_INT_MGMT (id 5)               <br>
&nbsp;&nbsp; Match access-group name&nbsp;&nbsp;ACL_COPP_MGMT                  <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                             <br>
 Class Map match-any class-default (id 0)                  <br>
&nbsp;&nbsp; Match any&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                             <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                             <br>
 Class Map match-all CM_COPP_FILE_MGMT (id 3)              <br>
&nbsp;&nbsp; Match access-group name&nbsp;&nbsp;ACL_COPP_FILE_MGMT             <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                             <br>
 Class Map match-all CM_COPP_DEFAULT (id 7)                <br>
&nbsp;&nbsp; Match access-group name&nbsp;&nbsp;ACL_COPP_DEFAULT               <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                             <br>
 Class Map match-all CM_COPP_MONITOR (id 6)                <br>
&nbsp;&nbsp; Match access-group name&nbsp;&nbsp;ACL_COPP_MONITOR               <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                             <br>
 Class Map match-all CM_COPP_BGP (id 1)                    <br>
&nbsp;&nbsp; Match access-group name&nbsp;&nbsp;ACL_COPP_BGP                   <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                             <br>
 Class Map match-all CM_COPP_IGP (id 4)                    <br>
&nbsp;&nbsp; Match access-group name&nbsp;&nbsp;ACL_COPP_IGP                   <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                             <br>
 Class Map match-all CM_COPP_CRITICAL_APPLICATIONS (id 2)  <br>
&nbsp;&nbsp; Match access-group name&nbsp;&nbsp;ACL_COPP_CRITICAL_APPLICATIONS <br>
</code></div>
</p>

<h2>Create Policy Maps to Define a Service Policy</h2>
<p>
Policy maps are used to associate the traffic class (defined with a class map) 
with one or more policies resulting in a service policy. To configure a policy map:
<ol>
  <li><b>Define the policy map name:</b> using the command 
  <code><b>policy-map &lt;service-policy-name&gt;</b></code></li>
  <li><b>Reference a configured class map:</b> using the command <code><b>class &lt;traffic-class-name&gt;</b></code></li>
  <li><b>Define the rate-limit threshold and action:</b> at which traffic will 
  be rate-limited, and action to take for conformal traffic, and rate-limit 
  violation using the command <code><b>police &lt;cir | rate&gt; conform-action &lt;transmit | drop&gt; 
exceed-action &lt;transmit | drop&gt; violate-action &lt;transmit | drop&gt;</b></code></li>
</ol>
</p>
<p>
Each class-map should be associated with a policy map that permits all traffic.
The policy for each class should be set as <code><b>conform-action transmit exceed-action transmit</b></code>.
</p>
<p>
Some control-plane policing rates along with recommended actions:
</p>
<p>
<table width="100%" cellspacing="0">
  <thead  style="background-color: #d3d3d3;">
    <tr>
      <td style="border-bottom: 1px solid; border-top:1px solid">Class</td>
      <td style="border-bottom: 1px solid; border-top:1px solid">Rate(pps)</td>
      <td style="border-bottom: 1px solid; border-top:1px solid">Rate(bps)</td>
      <td style="border-bottom: 1px solid; border-top:1px solid">Conform action</td>
      <td style="border-bottom: 1px solid; border-top:1px solid">Exceed action</td>
    </tr>
  </thead>
  <tbody>
  <tr>
    <td style="border-bottom: 1px solid;">BGP</td>
    <td style="border-bottom: 1px solid;">500</td>
    <td style="border-bottom: 1px solid;">4000000</td>
    <td style="border-bottom: 1px solid;">Transmit</td>
    <td style="border-bottom: 1px solid;">Drop</td>
  </tr>
  <tr>
      <td style="border-bottom: 1px solid;">IGP</td>
      <td style="border-bottom: 1px solid;">50</td>
      <td style="border-bottom: 1px solid;">300000</td>
      <td style="border-bottom: 1px solid;">Transmit</td>
      <td style="border-bottom: 1px solid;">Drop</td>
    </tr>
    <tr>
    <td style="border-bottom: 1px solid;">Monitoring and reporting</td>
    <td style="border-bottom: 1px solid;">125</td>
    <td style="border-bottom: 1px solid;">900000</td>
    <td style="border-bottom: 1px solid;">Transmit</td>
    <td style="border-bottom: 1px solid;">Drop</td>
  </tr>
  <tr>
    <td style="border-bottom: 1px solid;">Interactive management</td>
    <td style="border-bottom: 1px solid;">100</td>
    <td style="border-bottom: 1px solid;">500000</td>
    <td style="border-bottom: 1px solid;">Transmit</td>
    <td style="border-bottom: 1px solid;">Drop</td>
  </tr>
  <tr>
    <td style="border-bottom: 1px solid;">File management</td>
    <td style="border-bottom: 1px solid;">500</td>
    <td style="border-bottom: 1px solid;">6000000</td>
    <td style="border-bottom: 1px solid;">Transmit</td>
    <td style="border-bottom: 1px solid;">Drop</td>
  </tr>
  <tr>
    <td style="border-bottom: 1px solid;">Critical applications</td>
    <td style="border-bottom: 1px solid;">125</td>
    <td style="border-bottom: 1px solid;">900000</td>
    <td style="border-bottom: 1px solid;">Transmit</td>
    <td style="border-bottom: 1px solid;">Drop</td>
  </tr>
  <tr>
    <td style="border-bottom: 1px solid;">Undesirable</td>
    <td style="border-bottom: 1px solid;">100</td>
    <td style="border-bottom: 1px solid;">0</td>
    <td style="border-bottom: 1px solid;">Drop</td>
    <td style="border-bottom: 1px solid;">Drop</td>
  </tr>
  <tr>
    <td style="border-bottom: 1px solid;">Default</td>
    <td style="border-bottom: 1px solid;">100</td>
    <td style="border-bottom: 1px solid;">1000000</td>
    <td style="border-bottom: 1px solid;">Transmit</td>
    <td style="border-bottom: 1px solid;">Drop</td>
  </tr>
  </tbody>
</table>
</p>
<p>
<div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
  <code>
  R1(config)#<b>policy-map PM_COPP                                                                           </b><br>
  R1(config-pmap)#<b>class CM_COPP_BGP                                                                           </b><br>
  R1(config-pmap-c-police)#<b>police cir 4000000 bc 4000000 be 4000000 conform-action transmit exceed-action drop</b><br>
   R1(config-pmap-c-police)#<b>exit                                                            </b><br>
  R1(config-pmap)#<b>class CM_COPP_IGP                                                                           </b><br>
  R1(config-pmap-c)#<b>police cir 300000 bc 60000 be 60000 c conform-action transmit exceed-action drop          </b><br>
  R1(config-pmap-c-police)#<b>exit                                           </b><br>
  R1(config-pmap)#<b>class CM_COPP_CRITICAL_APPLICATIONS                                                         </b><br>
  R1(config-pmap-c)#<b>cir 900000 bc 180000 be 180000 conform-action transmit exceed-action drop                 </b><br>
  R1(config-pmap-c-police)#                                                                                      </b><br>
  R1(config-pmap-c-police)#<b>exit                                                         </b><br>
  R1(config-pmap)#<b>class CM_COPP_MONITOR                                                                       </b><br>
  R1(config-pmap-c)#<b>police cir 900000 bc 180000 be 180000 conform-action transmit exceed-action drop          </b><br>
  R1(config-pmap-c-police)#<b>exit                                                       </b><br>
  R1(config-pmap)#<b>class CM_COPP_FILE_MGMT                                                                     </b><br>
  R1(config-pmap-c)#<b>police cir 6000000 bc 1200000 be 1200000 conform-action transmit exceed-action drop       </b><br>
  R1(config-pmap-c-police)#<b>exit                                                        </b><br>
  R1(config-pmap)#<b>class CM_COPP_INT_MGMT                                                                      </b><br>
  R1(config-pmap-c)#<b>police cir 500000 bc 100000 be 100000 conform-action transmit exceed-action drop          </b><br>

</code></div>
</p>

<h3>Verification</h3>
<p>
<div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
  <code>

R1#<b>show policy-map</b><br>
&nbsp;&nbsp;Policy Map PM_COPP                         <br>
&nbsp;&nbsp;&nbsp;&nbsp;Class CM_COPP_IGP                        <br>
&nbsp;&nbsp;&nbsp;&nbsp; police cir 300000 bc 60000 be 60000     <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; conform-action transmit               <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; exceed-action drop                    <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; violate-action drop                   <br>
&nbsp;&nbsp;&nbsp;&nbsp;Class CM_COPP_INT_MGMT                   <br>
&nbsp;&nbsp;&nbsp;&nbsp; police cir 500000 bc 100000 be 100000   <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; conform-action transmit               <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; exceed-action drop                    <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; violate-action drop                   <br>
&nbsp;&nbsp;&nbsp;&nbsp;Class CM_COPP_BGP                        <br>
&nbsp;&nbsp;&nbsp;&nbsp; police cir 4000000 bc 800000 be 800000  <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; conform-action transmit               <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; exceed-action drop                    <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; violate-action drop                   <br>
&nbsp;&nbsp;&nbsp;&nbsp;Class CM_COPP_FILE_MGMT                  <br>
&nbsp;&nbsp;&nbsp;&nbsp; police cir 6000000 bc 1200000 be 1200000<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; conform-action transmit               <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; exceed-action drop                    <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; violate-action drop                   <br>
&nbsp;&nbsp;&nbsp;&nbsp;Class CM_COPP_CRITICAL_APPLICATIONS      <br>
&nbsp;&nbsp;&nbsp;&nbsp; police cir 900000 bc 180000 be 180000   <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; conform-action transmit               <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; exceed-action drop                    <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; violate-action drop                   <br>
&nbsp;&nbsp;&nbsp;&nbsp;Class CM_COPP_MONITOR                    <br>
&nbsp;&nbsp;&nbsp;&nbsp; police cir 90000 bc 18000 be 10800      <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; conform-action transmit               <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; exceed-action drop                    <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; violate-action drop                   <br>

R1#
</code></div>       
</p>
<p>
The policy map configuration will protect a device's RP from being overwhelmed by 
control-plane traffic. For illustrative purposes, the following CIR rate for 
ICMP traffic will be made artificially low.	
</p>
<p>
<div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
  <code>
R1#<b>show policy-map</b><br>                                                        
&nbsp;&nbsp;Policy Map PM_COPP                    <br>                                  
&nbsp;&nbsp;!Output omitted for brevity           <br>                                     
&nbsp;&nbsp;&nbsp;&nbsp;Class CM_COPP_MONITOR               <br>                                  
&nbsp;&nbsp;&nbsp;&nbsp; police cir 90000 bc 18000 be 10800 <br>                                  
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; conform-action transmit          <br>                                  
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; exceed-action drop               <br>                                  
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; violate-action drop              <br>                                  
                                          <br>                                
R1# 
</code></div>
</p>

<h2>Apply the Policy Map</h2>
<p>
A policy map can be applied to a single interface or all interfaces. Depending 
on your security model, you may wish to apply different policy-maps with different
rates to all interfaces and other policies to specific interfaces for instance, 
the interface pointing to the Internet may have a more restrictive policing than 
that connected to the internal network.
</p>

<h3>Apply policy map to all interfaces</h3>
<p>
A router has a single control-plane interface. To apply the policy-map to all 
interfaces, enter the control-plane configuration mode and apply the policy-map;
</p>
<p>
<div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
  <code>
R1(config)#<b>control-plane</b><br>
R1(config-cp)#<b>service-policy input PM_COPP</b>
</code></div>
</p>
<p>
The <code><b>input</b></code> keyword enforces the policy on ingress traffic.
</p>

<h3>Apply the policy-map to a single interface</h3>
<p>
To apply the policy-map to a single interface, enter the specific interface and 
configure the policy map using the service-policy interface command;
</p>
<p>
<div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
  <code>
R1(config)#<b>interface g0/0</b><br>
R1(config-if)#<b>service-policy input PM_COPP</b>
</code></div>
</p>

<h3>Test and Verify Configuration</h3>
<p>
On a second device (another router or host device such as PC), you can test the 
control-plane policing by pinging.
</p>
<p>
<div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
  <code>
R1#<b>show policy-map control-plane</b>                                  <br>
 Control Plane                                                           <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                           <br>
&nbsp;&nbsp;Service-policy input: PM_COPP                                          <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                           <br>
&nbsp;&nbsp;&nbsp;&nbsp;Class-map: CM_COPP_IGP (match-all)                                   <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;18 packets, 2312 bytes                                             <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5 minute offered rate 0000 bps, drop rate 0000 bps                 <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Match: access-group name ACL_COPP_IGP                              <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;police:                                                            <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cir 300000 bps, bc 60000 bytes, be 60000 bytes                 <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;conformed 18 packets, 2312 bytes; actions:                       <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;transmit                                                       <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exceeded 0 packets, 0 bytes; actions:                            <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;drop                                                           <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;violated 0 packets, 0 bytes; actions:                            <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;drop                                                           <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;conformed 0000 bps, exceeded 0000 bps, violated 0000 bps         <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                           <br>
&nbsp;&nbsp;&nbsp;&nbsp;Class-map: CM_COPP_INT_MGMT (match-all)                              <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 packets, 0 bytes                                                 <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5 minute offered rate 0000 bps, drop rate 0000 bps                 <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Match: access-group name ACL_COPP_MGMT                             <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;police:                                                            <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cir 500000 bps, bc 100000 bytes, be 100000 bytes               <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;conformed 0 packets, 0 bytes; actions:                           <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;transmit                                                       <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exceeded 0 packets, 0 bytes; actions:                            <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;drop                                                           <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;violated 0 packets, 0 bytes; actions:                            <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;drop                                                           <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;conformed 0000 bps, exceeded 0000 bps, violated 0000 bps         <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                           <br>
&nbsp;&nbsp;&nbsp;&nbsp;Class-map: CM_COPP_BGP (match-all)                                   <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 packets, 0 bytes                                                 <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5 minute offered rate 0000 bps, drop rate 0000 bps                 <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Match: access-group name ACL_COPP_BGP                              <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;police:                                                            <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cir 4000000 bps, bc 800000 bytes, be 800000 bytes              <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;conformed 0 packets, 0 bytes; actions:                           <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;transmit                                                       <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exceeded 0 packets, 0 bytes; actions:                            <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;drop                                                           <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;violated 0 packets, 0 bytes; actions:                            <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;drop                                                           <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;conformed 0000 bps, exceeded 0000 bps, violated 0000 bps         <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                           <br>
&nbsp;&nbsp;&nbsp;&nbsp;Class-map: CM_COPP_FILE_MGMT (match-all)                             <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 packets, 0 bytes                                                 <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5 minute offered rate 0000 bps, drop rate 0000 bps                 <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Match: access-group name ACL_COPP_FILE_MGMT                        <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;police:                                                            <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cir 6000000 bps, bc 1200000 bytes, be 1200000 bytes            <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;conformed 0 packets, 0 bytes; actions:                           <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;transmit                                                       <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exceeded 0 packets, 0 bytes; actions:                            <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;drop                                                           <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;violated 0 packets, 0 bytes; actions:                            <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;drop                                                           <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;conformed 0000 bps, exceeded 0000 bps, violated 0000 bps         <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                           <br>
&nbsp;&nbsp;&nbsp;&nbsp;Class-map: CM_COPP_CRITICAL_APPLICATIONS (match-all)                 <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 packets, 0 bytes                                                 <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5 minute offered rate 0000 bps, drop rate 0000 bps                 <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Match: access-group name ACL_COPP_CRITICAL_APPLICATIONS            <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;police:                                                            <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cir 900000 bps, bc 180000 bytes, be 180000 bytes               <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;conformed 0 packets, 0 bytes; actions:                           <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;transmit                                                       <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exceeded 0 packets, 0 bytes; actions:                            <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;drop                                                           <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;violated 0 packets, 0 bytes; actions:                            <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;drop                                                           <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;conformed 0000 bps, exceeded 0000 bps, violated 0000 bps         <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                           <br>
&nbsp;&nbsp;&nbsp;&nbsp;Class-map: CM_COPP_MONITOR (match-all)                               <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 packets, 0 bytes                                                 <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5 minute offered rate 0000 bps, drop rate 0000 bps                 <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Match: access-group name ACL_COPP_MONITOR                          <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;police:                                                            <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cir 90000 bps, bc 18000 bytes, be 10800 bytes                  <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;conformed 0 packets, 0 bytes; actions:                           <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;transmit                                                       <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exceeded 0 packets, 0 bytes; actions:                            <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;drop                                                           <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;violated 0 packets, 0 bytes; actions:                            <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;drop                                                           <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;conformed 0000 bps, exceeded 0000 bps, violated 0000 bps         <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                           <br>
&nbsp;&nbsp;&nbsp;&nbsp;Class-map: class-default (match-any)                                 <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;56 packets, 6556 bytes                                             <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5 minute offered rate 0000 bps, drop rate 0000 bps                 <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Match: any                                                         <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                           <br>
R1#<b>show policy-map</b>                                                <br>
&nbsp;&nbsp;Policy Map PM_COPP                                                     <br>
&nbsp;&nbsp;&nbsp;&nbsp;Class CM_COPP_IGP                                                    <br>
&nbsp;&nbsp;&nbsp;&nbsp; police cir 300000 bc 60000 be 60000                                 <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; conform-action transmit                                           <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; exceed-action drop                                                <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; violate-action drop                                               <br>
&nbsp;&nbsp;&nbsp;&nbsp;Class CM_COPP_INT_MGMT                                               <br>
&nbsp;&nbsp;&nbsp;&nbsp; police cir 500000 bc 100000 be 100000                               <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; conform-action transmit                                           <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; exceed-action drop                                                <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; violate-action drop                                               <br>
&nbsp;&nbsp;&nbsp;&nbsp;Class CM_COPP_BGP                                                    <br>
&nbsp;&nbsp;&nbsp;&nbsp; police cir 4000000 bc 800000 be 800000                              <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; conform-action transmit                                           <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; exceed-action drop                                                <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; violate-action drop                                               <br>
&nbsp;&nbsp;&nbsp;&nbsp;Class CM_COPP_FILE_MGMT                                              <br>
&nbsp;&nbsp;&nbsp;&nbsp; police cir 6000000 bc 1200000 be 1200000                            <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; conform-action transmit                                           <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; exceed-action drop                                                <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; violate-action drop                                               <br>
&nbsp;&nbsp;&nbsp;&nbsp;Class CM_COPP_CRITICAL_APPLICATIONS                                  <br>
&nbsp;&nbsp;&nbsp;&nbsp; police cir 900000 bc 180000 be 180000                               <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; conform-action transmit                                           <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; exceed-action drop                                                <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; violate-action drop                                               <br>
&nbsp;&nbsp;&nbsp;&nbsp;Class CM_COPP_MONITOR                                                <br>
&nbsp;&nbsp;&nbsp;&nbsp; police cir 90000 bc 18000 be 10800                                  <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; conform-action transmit                                           <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; exceed-action drop                                                <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; violate-action drop                                               <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                           <br>
</code></div>
</p>

<p>
Pinging from another Host
</p>
<p>
<div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
  <code>
R2#<b>ping 30.255.1.1 repeat 500 size 1500</b><br>                                   
Type escape sequence to abort.                                             <br>
Sending 500, 1500-byte ICMP Echos to 30.255.1.1, timeout is 2 seconds:     <br>
!!!!!!!!!!!!.!!!!!!!!!!!!!!.!!!!!!!!!!!!!.!!!!!!!!!!!!!.!!!!!!!!!!!!!.     <br>
!!!!!!!!!!!!!.!!!!!!!!!!!!!.!!!!!!!!!!!!!.!!!!!!!!!!!!!.!!!!!!!!!!!!!!     <br>
.!!!!!!!!!!!!!!.!!!!!!!!!!!!!!.!!!!!!!!!!!!!!.!!!!!!!!!!!!!!.!!!!!!!!!     <br>
!!!!.!!!!!!!!!!!!!.!!!!!!!!!!!!!.!!!!!!!!!!!!!.!!!!!!!!!!!!!.!!!!!!!!!     <br>
!!!!.!!!!!!!!!!!!!.!!!!!!!!!!!!!.!!!!!!!!!!!!!.!!!!!!!!!!!!!.!!!!!!!!!     <br>
!!!!.!!!!!!!!!!!!!.!!!!!!!!!!!!!.!!!!!!!!!!!!!!.!!!!!!!!!!!!!.!!!!!!!!     <br>
!!!!!.!!!!!!!!!!!!!!.!!!!!!!!!!!!!.!!!!!!!!!!!!!.!!!!!!!!!!!!!.!!!!!!!     <br>
!!!!!!.!!!                                                                 <br>
Success rate is 93 percent (465/500), round-trip min/avg/max = 1/17/48 ms  <br>
</code></div>
</p>
<p>
CoPP rate-limiting can be observed to have taken effect.
</p>

<p>
<div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
  <code>
R1#<b>show policy-map control-plane</b>                                  <br>
 Control Plane&nbsp;&nbsp;                                                         <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                         <br>
&nbsp;&nbsp;Service-policy input: PM_COPP                                          <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                         <br>
&nbsp;&nbsp;&nbsp;&nbsp;Class-map: CM_COPP_IGP (match-all)                                   <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;40 packets, 4380 bytes                                             <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5 minute offered rate 0000 bps, drop rate 0000 bps                 <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Match: access-group name ACL_COPP_IGP                              <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;police:&nbsp;&nbsp;&nbsp;&nbsp;                                                        <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cir 300000 bps, bc 60000 bytes, be 60000 bytes                 <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;conformed 40 packets, 4380 bytes; actions:                       <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;transmit                                                       <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exceeded 0 packets, 0 bytes; actions:                            <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;drop&nbsp;&nbsp;                                                         <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;violated 0 packets, 0 bytes; actions:                            <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;drop&nbsp;&nbsp;                                                         <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;conformed 0000 bps, exceeded 0000 bps, violated 0000 bps         <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                         <br>
&nbsp;&nbsp;&nbsp;&nbsp;Class-map: CM_COPP_INT_MGMT (match-all)                              <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 packets, 0 bytes                                                 <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5 minute offered rate 0000 bps, drop rate 0000 bps                 <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Match: access-group name ACL_COPP_MGMT                             <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;police:&nbsp;&nbsp;&nbsp;&nbsp;                                                        <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cir 500000 bps, bc 100000 bytes, be 100000 bytes               <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;conformed 0 packets, 0 bytes; actions:                           <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;transmit                                                       <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exceeded 0 packets, 0 bytes; actions:                            <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;drop&nbsp;&nbsp;                                                         <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;violated 0 packets, 0 bytes; actions:                            <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;drop&nbsp;&nbsp;                                                         <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;conformed 0000 bps, exceeded 0000 bps, violated 0000 bps         <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                         <br>
&nbsp;&nbsp;&nbsp;&nbsp;Class-map: CM_COPP_BGP (match-all)                                   <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 packets, 0 bytes                                                 <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5 minute offered rate 0000 bps, drop rate 0000 bps                 <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Match: access-group name ACL_COPP_BGP                              <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;police:&nbsp;&nbsp;&nbsp;&nbsp;                                                        <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cir 4000000 bps, bc 800000 bytes, be 800000 bytes              <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;conformed 0 packets, 0 bytes; actions:                           <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;transmit                                                       <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exceeded 0 packets, 0 bytes; actions:                            <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;drop&nbsp;&nbsp;                                                         <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;violated 0 packets, 0 bytes; actions:                            <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;drop&nbsp;&nbsp;                                                         <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;conformed 0000 bps, exceeded 0000 bps, violated 0000 bps         <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                         <br>
&nbsp;&nbsp;&nbsp;&nbsp;Class-map: CM_COPP_FILE_MGMT (match-all)                             <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 packets, 0 bytes                                                 <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5 minute offered rate 0000 bps, drop rate 0000 bps                 <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Match: access-group name ACL_COPP_FILE_MGMT                        <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;police:&nbsp;&nbsp;&nbsp;&nbsp;                                                        <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cir 6000000 bps, bc 1200000 bytes, be 1200000 bytes            <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;conformed 0 packets, 0 bytes; actions:                           <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;transmit                                                       <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exceeded 0 packets, 0 bytes; actions:                            <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;drop&nbsp;&nbsp;                                                         <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;violated 0 packets, 0 bytes; actions:                            <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;drop&nbsp;&nbsp;                                                         <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;conformed 0000 bps, exceeded 0000 bps, violated 0000 bps         <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                         <br>
&nbsp;&nbsp;&nbsp;&nbsp;Class-map: CM_COPP_CRITICAL_APPLICATIONS (match-all)                 <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 packets, 0 bytes                                                 <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5 minute offered rate 0000 bps, drop rate 0000 bps                 <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Match: access-group name ACL_COPP_CRITICAL_APPLICATIONS            <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;police:&nbsp;&nbsp;&nbsp;&nbsp;                                                        <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cir 900000 bps, bc 180000 bytes, be 180000 bytes               <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;conformed 0 packets, 0 bytes; actions:                           <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;transmit                                                       <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exceeded 0 packets, 0 bytes; actions:                            <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;drop&nbsp;&nbsp;                                                         <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;violated 0 packets, 0 bytes; actions:                            <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;drop&nbsp;&nbsp;                                                         <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;conformed 0000 bps, exceeded 0000 bps, violated 0000 bps         <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                         <br>
&nbsp;&nbsp;&nbsp;&nbsp;Class-map: CM_COPP_MONITOR (match-all)                               <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;500 packets, 757000 bytes                                          <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5 minute offered rate 11000 bps, drop rate 0000 bps                <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Match: access-group name ACL_COPP_MONITOR                          <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;police:&nbsp;&nbsp;&nbsp;&nbsp;                                                        <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cir 90000 bps, bc 18000 bytes, be 10800 bytes                  <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;conformed 465 packets, 704010 bytes; actions:                    <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;transmit                                                       <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exceeded 35 packets, 52990 bytes; actions:                       <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;drop&nbsp;&nbsp;                                                         <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;violated 0 packets, 0 bytes; actions:                            <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;drop&nbsp;&nbsp;                                                         <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;conformed 10000 bps, exceeded 0000 bps, violated 0000 bps        <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                         <br>
&nbsp;&nbsp;&nbsp;&nbsp;Class-map: class-default (match-any)                                 <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;135 packets, 13264 bytes                                           <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5 minute offered rate 0000 bps, drop rate 0000 bps                 <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Match: any                                                         <br>
R1#
</code></div>
</p>


<h1>Troubleshooting Control-Plane Policing</h1>
<p>
Troubleshooting control plane policing requires troubleshooting of the various 
components of CoPP i.e., access control lists, class maps, 
policy maps and service policies. When troubleshooting CoPP, consider;
</p>

<h2>ACLs</h2>
<p>
When troubleshooting ACLs for CoPP, focus on the following;
<ul>
<li>Verify correct source and destination addresses, protocols, 
 port number, action (permit | deny): <code><b>show access-list</b></code></li>
 <li><b>Grouping:</b> if grouping traffic types, ensure that they are grouped 
 based on function; e.g. routing protocols (BGP, OSPF, EIGRP), management protocols 
 (SSH, TELNET, HTTP(S), TFTP, SNMP, DNS, NTP).</li>
 <li><b>Action:</b> with CoPP, a permit action in an ACL means match the traffic
 and apply the policy. Deny means exclude the traffic from the class and move on
 to the next class.</li>
 <li><b>Protocol:</b> If the wrong protocol is specified in the ACL, the wrong 
 type of traffic will be matched.</li>
 <li><b>Source and destination:</b> the correct source and destination ACLs should 
 be applied. During troubleshooting, change IP address to <code><b>any</b></code> to see the effect.</li>
 <li><b>Operators and Ports:</b> Ensure correct ACL operator and port numbers are defined.</li>
 <li>Avoid log and log-input ACL keywords for CoPP due to unexpected results in CoPP functionality.</li>
</ul>
</p>

<h2>Class Maps</h2>
<p>
<ul>
<li>Watch-out for the <code><b>match-all</b></code> and <code><b>match-any</b></code> commands.</li>
<li>Verify that the class-map is configured correctly <code><b>show class-map</b></code>. 
 Verify correct instructions (match-any, match-all), correct ACL, protocol,IP prec, DSCP.</li>
 </ul>
</p>

<h2>Policy Maps</h2>
<p>
When troubleshooting policy maps, consider;
<ul>
<li>Verify that the service policy is applied in the correct direction: 
  <code><b>show policy-map control-plane</b></code>.</li>
  <li>Verify that the policy-map is correctly configured;
   <code><b>show policy-map</b></code></li>
   <li>Check the correct class-map, rate or CIR, conform-action, exceed-action,correct order.</li>
 <li><b>Order of operations:</b> classes defined are processed from top to down.</li>
 <li><b>Class-map:</b> has the correct class-map been configured correctly.</li>
 <li><b>Policy:</b> Ensure the correct CIR in bps and rate in pps have been 
 configured. In some IOS versions, if traffic that matches a class is to be dropped,
 replace police command with <code><b>drop</b></code> keyword.</li>
 <li><b>Default-class:</b> if traffic does not match any defined class, it will 
 be subjected to conditions laid out in the default class.</li>
 <li><b>Case:</b> class names are case sensitive.</li>
</ul>
</p>

<h2>Service Policy</h2>
<p>
When troubleshooting the application of a service policy;
<ul>
  <li><b>Correct interface:</b> service policy can be applied only to one interface,
  the control-plane. If applying to a physical interface, ensure that the service
  policy is configured on the correct interface. Confirm with 
  <code><b>show policy-map interface &lt;interface-name&gt;</b></code></li>
  <li><b>Direction:</b> input for incoming packets. Confirm direction with; 
  <code><b>show policy-map control-plane</b></code>. Not all IOS versions support 
  output. For routing protocols, output CoPP would be for replies to queries / 
  requests or ACKs. For ICMP; error or informational reply, for telnet, SSH, HTTP, 
  SNMP replies or traps. Ensure the ACL and class-map are configured appropriately for replies.</li>
  <li><b>Case:</b> Policy maps are case-sensitive; verify with 
  <code><b>show policy-map control-plane</b></code></li>.
</ul>
</p>