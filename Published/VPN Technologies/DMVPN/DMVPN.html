
<h1>Contents</h1>
<p>
  <ol>
    <li><a href="#INTRODUCTION">Introduction and Overview</a></li>
    <li><a href="#GRE">Multipoint Generic Routing Encapsulation (mGRE)</a></li>
    <li><a href="#NHRP">Next Hop Resolution Protocol(NHRP)</a>
    <ol type="i">
    <li><a href="#MESSAGES">Message Types</a></li>
    <li><a href="#PHASE1">Phase 1 </a></li>
    <li><a href="#PHASE2">Phase 2</a></li>
    <li><a href="#PHASE3">Phase 3</a></li>
    </ol></li>
    <li><a href="#VERIFICATION">Verification</a></li>
    <li><a href="#OPTIMIZATION">Optimization</a></li>
  </ol>
</p>

<h1 id="INTRODUCTION">Introduction and Overview</h1>
<p>
DMVPN is a Cisco developed technology used in enterprise networks to create 
Virtual Private Networks (VPNs) to interconnect an enterprise’s various 
geographically separated offices over a public network such as the Internet.
</p>
<p>
DMVPN is a point-to-multipoint layer 3 overlay VPN providing full-meshed connectivity 
from an initial logical hub and spoke topology. 
Direct spoke-to-spoke traffic is supported. DMVPN's only requirement 
is for IP connectivity between the local and remote site. The routing policy is 
not dictated by the service provider; as such, it does not have the restrictions 
of MPLS L3VPNs such as the routing protocol that the service 
provider supports for the L3VPN. 
</p>
<p>
DMVPN is highly scalable when properly designed.
</p>
<h2>How DMVPN Works</h2>
<p>
DMVPN relies on two technologies i.e. Multipoint Generic Routing Encapsulation 
(mGRE) and Next Hop Resolution Protocol (NHRP). To configure DMVPN, the following 
steps should be followed;
<ul>
  <li>Step 1: Configuration of mGRE tunnels.</li>
  <li>Step 2: Configuration of Next Hop Resolution Protocol (NHRP).</li>
  <li>Step 3: Securing the DMVPN Tunnel with IPSec. IPsec is covered <a href="https://emmanueltoko.blogspot.com/2021/02/securingdmvpn-tunnels-with-ipsec-ikev1.html" target="_blank">here</a>.</li>
</ul>
</p>
<p>
DMVPN has three modes of operation; Phase 1, Phase 2, and Phase 3. Each phase 
incrementally adds features that improve the operation of DMVPN.
DMVPN reduces the need for n &times; <sup>(n-1)</sup> &#8260; <sub>2</sub>  
static tunnel configurations. This happens through the use of one mGRE interface 
for all connections.
</p>
<p>
 DMVPN maintains tunnels based on traffic patterns. Spoke-to-spoke tunnel 
is on-demand and this tunnel's lifetime is based on traffic utilization of the tunnel.
</p>
<p>
DMVPN supports IPv4 and IPv6 protocols for both passenger (overlay) and 
transport (underlay) traffic.
</p>

<h3>DMVPN Features</h3>
<p>
DMVPN's characteristics make its operation flexible and scalable:
<ul>
<li>
<p>
DMVPN provides full-meshed connectivity with simple configuration of hub and spoke.
</p>
<p>
DMVPN creates on-demand tunnels between nodes: the initial tunnel-mesh is 
hub-and-spoke(always on) topology.
Traffic patterns trigger spoke-to-spoke tunnels thereby creating a topology that 
dynamic shifts anywhere between a hub and spoke to full mesh topology. 
This solves management scalability problems.
</p>
</li>
<li>
<p>
It supports dynamically addressed spokes i.e. where spokes have their IP 
addresses issued through DHCP or dynamic NAT and these IP addresses are not 
consistent over time.
DMVPN supports spoke routers behind dynamic NAT and hub routers behind static NAT.
</p>
</li> 
<li>
<p>DMVPN facilitates zero-touch configuration on the hub for addition new spokes i.e., no 
configuration on the hub when adding a new spoke.</p></li>
<li><p>DMVPN features automatic IPsec triggering for building IPsec protected 
VPN tunnels. However, it remains usable with or without IPsec encryption.</p></li>
<li><p>Supports IP unicast and IP multicast traffic enabling the support of interior routing
protocols such as OSPF, EIGRP. Multicast packets are encapsulated by GRE in unicast packets.</p></li>
<li><p> DMVPN supports the configuration of one mGRE interface on each spoke which 
supports multipoint VPN connectivity. On the hub, DMVPN configuration is accomplished 
with fewer configuration commands and one tunnel interface for all spokes.</p></li>
<li><p>Dynamic tunnel destination simplifies support for dynamically addressed spokes.</p></li> 
<li>Spoke-to-spoke data-plane traffic is through the hub (phase 1) or direct (phase 2 and 3). 
However, control-plane and multicast traffic is only exchanged with the hub regardless of DMVPN phase in operation.
This results 
in the spokes forming layer 3 adjacencies only with the hub. There are no spoke-to-spoke 
layer 3 adjacencies. So routing protocol updates come only from the hub.</li>
</ul>
</p>

<h3>Connectivity</h3>
<p>
As previously indicated, DMVPN toplogies start initially with a hub to spoke 
topology. This dynamically changes to full mesh with hub to spoke and spoke-to-spoke 
topologies depending on traffic patterns.
</p>
<h4>Hub to Spokes</h4>
<p>
The two main components of a hub and spoke connection are:
<ol>
  <li>DMVPN hub/NHRP server (NHS).</li>
  <li>DMVPN spokes / NHCs:
    <ul>
      <li>Spokes register with the hub/server.</li>
      <li>Spokes manually specify the hub's address.</li>
      <li>The Registration message from the spokes is sent via NHRP Registration 
      Request message type.</li>
      <li>The hub dynamically learns the spoke's VPN address and NBMA address.</li>
      <li>Spokes establish tunnels to the hub through which exchange of IGP routing 
      information takes place.</li>
    </ul>
  </li>
</ol>
</p>

<h4>Spoke to Spoke</h4>
<p>
With the spoke-to-spoke tunnel formed, the hub is only used for control-plane 
information exchange. The spoke-to-spoke tunnel data-plane may flow through 
the hub initially but subsequent traffic is spoke-to-spoke.
</p>

<h1 id="GRE">Multipoint Generic Routing Encapsulation Tunnels (mGRE)</h1>
<p>
mGRE creates Virtual Private Network (VPN) tunnels between routers across a 
network such as the Internet. A hub
router is the central connection point of what is a star topology. DMVPN provides
for the capability to create topologies that contain more than one hub. For purposes
of understanding DMVPN, we will implement a single-hub DMVPN topology.
</p>
<p>
GRE is used as a transport mechanism for protocols such as IP by encapsulating 
the IP packets. GRE uses IP protocol number 47. 
Dynamic routing protocols such as OSPF, EIGRP are supported due 
to multicast support provided by GRE. 
Whereas GRE supports unicast packets, the default configuration of most dynamic 
routing protocols (without optimization) is to use multicast packets. Spokes can 
be configured to send encapsulated multicast packets in unicast GRE packets to 
the hub.
</p>
<p>
The tunnels created by mGRE are usually referred to as the overlay network. 
The existing transport network is referred to as the underlay network.
</p>
<p>
When network traffic is to be routed through the overlay network, a new GRE header
is added to the existing IP packet. The GRE header encapsulates the tunnel IP 
header and data. This encapsulated packet may be a multicast or unicast packet. 
This packet is then routed through the underlay network using the underlay IP 
destination address. The router at the end of the tunnel, strips the GRE header 
and routes the packet based on the previously encapsulated IP header destination 
address (for destination-based routing).
</p>
<p>
GRE tunnels support IPv4 or IPv6 addresses as underlay and/or the overlay network. 
By default, GRE does not support encryption. However, tunnel encryption can be 
added through IPSec.
</p>
<p>
The following output is a Wireshark packet capture of a GRE tunneled ICMP reply 
message:
</p>
<p>
<div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">     
      	<code>                                                             
Frame 57: 138 bytes on wire (1104 bits), 138 bytes captured (1104 bits) on interface -, id 0          <br>
Ethernet II, Src: ca:06:06:9e:00:08 (ca:06:06:9e:00:08), Dst: ca:07:06:ad:00:1c (ca:07:06:ad:00:1c)   <br>
Internet Protocol Version 4, Src: 99.255.30.1, Dst: 99.255.60.6                                       <br>
Generic Routing Encapsulation (IP)                                                                    <br>
&nbsp;&nbsp;&nbsp;&nbsp;Flags and Version: 0x0000                                                                         <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0... .... .... .... = Checksum Bit: No                                                        <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.0.. .... .... .... = Routing Bit: No                                                         <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;..0. .... .... .... = Key Bit: No                                                             <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...0 .... .... .... = Sequence Number Bit: No                                                 <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.... 0... .... .... = Strict Source Route Bit: No                                             <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.... .000 .... .... = Recursion control: 0                                                    <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.... .... 0000 0... = Flags (Reserved): 0                                                     <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.... .... .... .000 = Version: GRE (0)                                                        <br>
&nbsp;&nbsp;&nbsp;&nbsp;Protocol Type: IP (0x0800)                                                                        <br>
Internet Protocol Version 4, Src: 10.2.10.1, Dst: 172.30.1.7                                          <br>
&nbsp;&nbsp;&nbsp;&nbsp;0100 .... = Version: 4                                                                            <br>
&nbsp;&nbsp;&nbsp;&nbsp;.... 0101 = Header Length: 20 bytes (5)                                                           <br>
&nbsp;&nbsp;&nbsp;&nbsp;Differentiated Services Field: 0x00 (DSCP: CS0, ECN: Not-ECT)                                     <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0000 00.. = Differentiated Services Codepoint: Default (0)                                    <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.... ..00 = Explicit Congestion Notification: Not ECN-Capable Transport (0)                   <br>
&nbsp;&nbsp;&nbsp;&nbsp;Total Length: 100                                                                                 <br>
&nbsp;&nbsp;&nbsp;&nbsp;Identification: 0x0013 (19)                                                                       <br>
&nbsp;&nbsp;&nbsp;&nbsp;000. .... = Flags: 0x0                                                                            <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0... .... = Reserved bit: Not set                                                             <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.0.. .... = Don't fragment: Not set                                                           <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;..0. .... = More fragments: Not set                                                           <br>
&nbsp;&nbsp;&nbsp;&nbsp;...0 0000 0000 0000 = Fragment Offset: 0                                                          <br>
&nbsp;&nbsp;&nbsp;&nbsp;Time to Live: 255                                                                                 <br>
&nbsp;&nbsp;&nbsp;&nbsp;Protocol: ICMP (1)                                                                                <br>
&nbsp;&nbsp;&nbsp;&nbsp;Header Checksum: 0xfa5d [validation disabled]                                                     <br>
&nbsp;&nbsp;&nbsp;&nbsp;[Header checksum status: Unverified]                                                              <br>
&nbsp;&nbsp;&nbsp;&nbsp;Source Address: 10.2.10.1                                                                         <br>
&nbsp;&nbsp;&nbsp;&nbsp;Destination Address: 172.30.1.7                                                                   <br>
Internet Control Message Protocol                                                                     <br>
&nbsp;&nbsp;&nbsp;&nbsp;Type: 0 (Echo (ping) reply)                                                                       <br>
&nbsp;&nbsp;&nbsp;&nbsp;Code: 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                 <br>
&nbsp;&nbsp;&nbsp;&nbsp;Checksum: 0xb995 [correct]                                                                        <br>
&nbsp;&nbsp;&nbsp;&nbsp;[Checksum Status: Good]                                                                           <br>
&nbsp;&nbsp;&nbsp;&nbsp;Identifier (BE): 3 (0x0003)                                                                       <br>
&nbsp;&nbsp;&nbsp;&nbsp;Identifier (LE): 768 (0x0300)                                                                     <br>
&nbsp;&nbsp;&nbsp;&nbsp;Sequence Number (BE): 4 (0x0004)                                                                  <br>
&nbsp;&nbsp;&nbsp;&nbsp;Sequence Number (LE): 1024 (0x0400)                                                               <br>
&nbsp;&nbsp;&nbsp;&nbsp;[Request frame: 56]                                                                               <br>
&nbsp;&nbsp;&nbsp;&nbsp;[Response time: 52.565 ms]                                                                        <br>
&nbsp;&nbsp;&nbsp;&nbsp;Data (72 bytes)&nbsp;&nbsp;
</code></div>
</p>

<h2 id="GRE_CONFIGURATION">Configuration of GRE Tunnels</h2>
<p>
Control-plane neighborships only happen between spoke and hub. Spokes are not 
able to form dynamic routing protocol neighbor relationships with each other.

All spoke to spoke communication transits the hub because the hub sets itself as the
next-hop in control-plane traffic. All data plane traffic transits via the hub 
as a result.
</p>
<p>
mGRE requires the configuration of the hub and spokes. Usually the hub takes 
many more commands than those of the spokes. 
</p>

<p>
In the configuration of DMVPN, the following topology will be used for reference:
</p>
<p>
  <div class="separator" style="clear: both;"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjkwa2N5PBozihKS4IikWO62WLEOvhbsDQIeeuVXwrHRo9ISdyU0M14jOEavcs7moqz3Nw0gHyy2b3GN1tmbcWSqymP7gjNIvWfzRMlL8_EfZAnCslawvAtUPH8hTYPkup3ItW5oCmF7uNE8tmiLugZCnOG0MKlV6CYdEiG3jX2iXOMsC79r0iBS6p2AB4/s1476/DMVPN%20Topology.png" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="600" data-original-height="802" data-original-width="1476" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjkwa2N5PBozihKS4IikWO62WLEOvhbsDQIeeuVXwrHRo9ISdyU0M14jOEavcs7moqz3Nw0gHyy2b3GN1tmbcWSqymP7gjNIvWfzRMlL8_EfZAnCslawvAtUPH8hTYPkup3ItW5oCmF7uNE8tmiLugZCnOG0MKlV6CYdEiG3jX2iXOMsC79r0iBS6p2AB4/s600/DMVPN%20Topology.png"/></a></div>
</p>

<h4>Step 1: Create the tunnel interface</h4>
<p>
The global configuration command <code><b>interface tunnel &lt;tunnel-number&gt;</b></code> is used.
</p>
<p>
<div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
      	<code>
HUB#<b>configure terminal</b> <br>
HUB(config)#<b>interface tunnel 0</b>
</code></div>
</p>

<h4>Step 2: Identify the tunnel source</h4> 
<p>
A tunnel source is the interface whose IP address will be used as the source IP 
in the IP packets sent through the underlay network.
It is usually a good idea to specify a logical interface such as a loopback interface.
A loopback interface is always up and if a router has more than one Internet 
connection through different router interfaces, then any one of the other "up" interfaces can 
be used to route the tunnel traffic if the primary interface through which the 
VPN tunnel has been created goes down. If a loopback
interface is used, remember to advertise the configured network on this interface.
The configuration command is <code><b>tunnel source &lt;ip-address | interface&gt;</b></code>.
</p>
<p>
<div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
      	<code>
HUB(config-if)#<b>tunnel source g3/0</b>
</code></div>
</p>

<h3>Hub Configuration</h3>
<p>
The following set of commands are implemented on the hub router.
</p>
<h4>Step 3: Configure the mode of the tunnel to multipoint GRE</h4>
<p>
The tunnel multipoint configuration supports the creation of multiple logical 
tunnels through one tunnel interface. DMVPN is therefore able to dynamically support a 
topology that dynamically transitions from point-to-point to point-to-multipoint. 
</p>
<p>
<div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
      	<code>
HUB(config-if)#<b>tunnel mode gre multipoint</b>
</code></div>
</p>

<h4>Step 4: Allocate an IP address to the tunnel interface</h4>
<p>
The subnet should have a sufficient number of IP addresses to be able 
to accommodate the planned number of spokes and hubs in the network. Proper 
planning during the design of the network should cater for this. For this 
example, we will accommodate a combined maximum of 254 hubs and clients so a subnet mask 
of 255.255.255.0 (/24) is used.
</p>
<p>
<div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
      	<code>
HUB(config-if)#<b>ip address 172.30.1.1 255.255.255.0</b>
</code></div>
</p>

<h4>Step 5: (Optional) Define the tunnel bandwidth</h4>
<p>
The tunnel bandwidth is usually configured for routing purposes. In the tunnel 
interface configuration mode, the command is <code><b>bandwidth &lt;1 – 10000000&gt;</b></code>
The value is in kbps. The default bandwidth is 100Kbps. If the bandwidth value 
is not configured, then the tunnel priority will be low.
</p>
<p>
<div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
 <code>
HUB(config-if)#<b>bandwidth 100000</b>
</code>
</div>
</p>

<h4> Step 6: (Optional) Specify the GRE tunnel keepalive</h4>
<p>
Keepalives ensure that bi-directional communication between tunnel end-points 
remain active. In tunnel interface mode, the command is <code><b>keepalive &lt;seconds&gt; &lt;retries&gt;</b></code>.
The default keepalive time is 10 seconds and 3 retries.
</p>
<p>
<div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
 <code>
HUB(config-if)#<b>keepalive 10 5</b>
</code>
</div>
</p>

<h4> Step 7: (Optional) Define the MTU</h4>
<p>
By default, the MTU for tunnel interfaces is 1476. The rationale behind setting 
the MTU value to 1476 is that the GRE header, with a minimum size of 24 bytes, is 
added to the IP packet. Together, the new MTU size of the IP packet should total 
1500. This size is supported by many network device interfaces as the maximum 
MTU. It is recommended to specify an MTU value of 1400. In tunnel configuration 
mode, the command is <code><b>ip mtu &lt;value&gt;</b></code>.
</p>
<p>
<div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
 <code>
HUB(config-if)#<b>ip mtu 1400</b>
</code>
</div>
</p>

<h4>Step 8: Define the Maximum Segment Size (MSS)</h4>
<p>
This ensures that the router modifies the payload of a three-way handshake if 
the MSS exceeds the configured value. With DMVPN, this value is typically 1360.

During tunnel configuration, configure MTU to 1400, MSS to 1360 to ensure 
fragmentation is implemented by hosts. The general idea is to ensure that fragmentation is  
implemented by the hosts and not the routers as it is memory intensive.
</p>
<p>
<div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
 <code>
HUB(config-if)#<b>ip tcp adjust-mss 1360</b>
</code>
</div>
</p>

<h3>Spoke configuration (DMVPN Phase 1)</h3>
<p>
Configuration of the Spoke in DMVPN phase 1 is similar to the configuration of 
the hub. The only exception is that with the spoke GRE is configured instead of 
mGRE. In the configuration of the hub, replace steps 3 and 4.
</p>

<h4>Step 3: Configure the destination of the tunnel</h4>
<p>
The destination IP address should be the address of the underlay/transport 
interface of the hub;
</p>
<p>
<div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
 <code>
SPOKE7(config-if)#<b>tunnel destination 99.255.10.2</b>
</code>
</div>
</p>

<h4>Step 4: Allocate an IP address to the tunnel interface</h4>
<p>
This IP address should be in the subnet of the tunnel of the Hub
</p>
<p>
<div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
 <code>
SPOKE7(config-if)#<b>ip address 172.30.1.7 255.255.255.0</b>
</code>
</div>
</p>


<h1 id="NHRP">Next Hop Resolution Protocol (NHRP)</h1>
<p>
NHRP is used for mapping tunnel (overlay) addresses to transport (underlay) addresses. It 
is defined in <a target="_blank" href="https://www.ietf.org/rfc/rfc2332.txt">RFC 2332</a>. 
NHRP operates using the client-server model with a hub 
as the server and the spokes as the client. The clients are also referred to as 
Next Hop Clients (NHC) and the server as Next Hop Server (NHS).

Spokes are statically configured with the IP address of the hub so they can register
their tunnel and NBMA (transport) address with the hub. No manual registration of 
clients is required on the hub i.e., zero-touch configuration. This reduces 
administrative workload and improves scalability with addition of new spokes.
</p>

<h2 id="MESSAGES">NHRP Message Types</h2>
<p>
NHRP messages are encapsulated by GRE between devices.
</p>
<p>
There are the various types of messages NHCs and NHSs exchange with each other;
NHRP Registration(Request and Reply), NHRP Resolution(Request and Reply), NHRP 
Redirect, NHRP Purge, NHRP Error.
</p>

<h3>NHRP Registration</h3> 
<p>
NHRP Registration Request is sent from NHCs to NHS to know a destination spoke’s NBMA 
information along with the amount of time the registration should be maintained.
Spokes dynamically register the mapping of their NBMA and VPN IP address to the NHS. This is required 
to build the spoke-to-spoke tunnels.
NHRP Registration supports spokes with dynamic NBMA addresses or NAT.
</p>
<p>
<p>
NHRP registration packets are sent every NHRP timeout period. If no registration
reply is received, a new registration packet is sent with a delay of 1 second, 
second packet is delayed for two seconds and third four seconds. NHS is declared
down after third attempt. Use the command <code><b>show dmvpn</b></code> to confirm.
</p>
<p>
Periodic NHRP registration requests by spokes refresh the NHRP timeout period. 
In spoke to spoke tunnels, if the tunnel is not used within two minutes of expiry time, 
it is torn down.
</p>
<p>
<b>Probe state:</b> NHCs attempting to register with a down NHS start sending probe 
packets periodically to determine the availability of the NHS. The delay in 
sending of the probe packets is 1, 2, 4, 8, 16, 32, 64. After 64 seconds, no more probe packets are sent.
This can be verified by debugging messages;
</p>
<p>
<div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
 <code>
. . . 
*Feb 14 21:55:12.391: NHRP-RATE: Sending initial Registration Request for 10.100.100.1, reqid 2                        <br>
*Feb 14 21:55:14.303: <b>NHRP: Setting retrans delay to 4 for nhs  dst 10.100.100.1</b>                                       <br>
*Feb 14 21:55:14.307: NHRP-ATTR:  Requester Ext Len: Total ext_len  with NHRP attribute VPE 40                         <br>
                                                                                                                       <br>
*Feb 14 21:55:14.307: NHRP: Attempting to send packet via DEST 10.100.100.1                                            <br>
*Feb 14 21:55:14.311: NHRP: NHRP successfully mapped '10.100.100.1' to NBMA 10.10.10.10                                <br>
*Feb 14 21:55:14.315: NHRP: Encapsulation succeeded.  Sending NHRP Control Packet  NBMA Address: 10.10.10.10           <br>
*Feb 14 21:55:14.319: NHRP: Send Registration Request via Tunnel0 vrf 0, packet size: 92                               <br>
*Feb 14 21:55:14.323:&nbsp;&nbsp;src: 10.100.100.9, dst: 10.100.100.1                                                            <br>
*Feb 14 21:55:14.327:&nbsp;&nbsp;(F) afn: AF_IP(1), type: IP(800), hop: 255, ver: 1                                              <br>
*Feb 14 21:55:14.327:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shtl: 4(NSAP), sstl: 0(NSAP)                                                                <br>
*Feb 14 21:55:14.331:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pktsz: 92 extoff: 52                                                                        <br>
*Feb 14 21:55:14.331:&nbsp;&nbsp;(M) flags: "unique nat ", reqid: 2                                                              <br>
*Feb 14 21:55:14.331:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;src NBMA: 9.9.9.9                                                                           <br>
*Feb 14 21:55:14.335:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;src protocol: 10.100.100.9, dst protocol: 10.100.100.1                                      <br>
*Feb 14 21:55:14.339:&nbsp;&nbsp;(C-1) code: no error(0)                                                                         <br>
*Feb 14 21:55:14.339:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;prefix: 32, mtu: 17912, hd_time: 7200                                                     <br>
*Feb 14 21:55:14.343:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;addr_len: 0(NSAP), subaddr_len: 0(NSAP), proto_len: 0, pref: 0                            <br>
*Feb 14 21:55:14.343: Responder Address Extension(3):                                                                  <br>
*Feb 14 21:55:14.343: Forward Transit NHS Record Extension(4):                                                         <br>
*Feb 14 21:55:14.347: Reverse Transit NHS Record Extension(5):                                                         <br>
*Feb 14 21:55:14.347: NAT address Extension(9):                                                                        <br>
*Feb 14 21:55:14.347:&nbsp;&nbsp;(C-1) code: no error(0)                                                                         <br>
*Feb 14 21:55:14.351:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;prefix: 32, mtu: 17912, hd_time: 0                                                        <br>
*Feb 14 21:55:14.351:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;addr_len: 4(NSAP), subaddr_len: 0(NSAP), proto_len: 4, pref: 0                            <br>
*Feb 14 21:55:14.351:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;client NBMA: 10.10.10.10                                                                  <br>
*Feb 14 21:55:14.355:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;client protocol: 10.100.100.1                                                             <br>
*Feb 14 21:55:14.355: NHRP: 120 bytes out Tunnel0                                                                      <br>
*Feb 14 21:55:14.359: NHRP-RATE: Retransmitting Registration Request for 10.100.100.1, reqid 2, (retrans ivl 4 sec)    <br>
*Feb 14 21:55:18.171: NHRP: NHS-DOWN: 10.100.100.1                                                                     <br>
*Feb 14 21:55:18.187: NHRP: Already pending Registration Request for NHS: 10.100.100.1                                 <br>
*Feb 14 21:55:18.191: NHRP: NHS 10.100.100.1 Tunnel0 vrf 0 Cluster 0 Priority 0 Transitioned to 'E' from 'E'           <br>
                                                                                                                       <br>
*Feb 14 21:55:18.191: <b>NHRP: Setting retrans delay to 8 for nhs  dst 10.100.100.1</b>                                       <br>
*Feb 14 21:55:18.195: NHRP-ATTR:  Requester Ext Len: Total ext_len  with NHRP attribute VPE 40                         <br>
. . .                                                                                                                  <br>
*Feb 14 21:55:18.251: NHRP-RATE: Retransmitting Registration Request for 10.100.100.1, reqid 2, (retrans ivl 8 sec)    <br>
*Feb 14 21:55:25.567: <b>NHRP: Setting retrans delay to 16 for nhs  dst 10.100.100.1</b>                                      <br>
*Feb 14 21:55:25.571: NHRP-ATTR:  Requester Ext Len: Total ext_len  with NHRP attribute VPE 40                         <br>
. . .                                                                                                                  <br>
*Feb 14 21:55:25.623: NHRP-RATE: Retransmitting Registration Request for 10.100.100.1, reqid 2, (retrans ivl 16 sec)   <br>
*Feb 14 21:55:39.495: <b>NHRP: Setting retrans delay to 32 for nhs  dst 10.100.100.1,</b>                                      <br>
. . .                                                                                                                  <br>
*Feb 14 21:55:39.551: NHRP-RATE: Retransmitting Registration Request for 10.100.100.1, reqid 2, (retrans ivl 32 sec)   <br>
*Feb 14 21:56:09.879: <b>NHRP: Setting retrans delay to 64 for nhs  dst 10.100.100.1</b>                                      <br>
*Feb 14 21:56:09.883: NHRP-ATTR:  Requester Ext Len: Total ext_len  with NHRP attribute VPE 40
</code></div>
</p>

<p>
The following output is a Wireshark packet capture of an NHRP Registration Request 
packet:
</p>
<p>
<div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
 <code>
Next Hop Resolution Protocol (NHRP Registration Request)         <br>
&nbsp;&nbsp;&nbsp;&nbsp;NHRP Fixed Header                                            <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Address Family Number: IPv4 (0x0001)                     <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Protocol Type (short form): IPv4 (0x0800)                <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Protocol Type (long form): 0000000000                    <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Hop Count: 255                                           <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Packet Length: 92                                        <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NHRP Packet Checksum: 0xa772 [correct]                   <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[NHRP Packet Checksum Status: Good]                      <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Extension Offset: 52                                     <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Version: 1 (NHRP - rfc2332)                              <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NHRP Packet Type: NHRP Registration Request (3)          <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Source Address Type/Len: NSAP format/4                   <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.0.. .... = Type: NSAP format (0)                    <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;..00 0100 = Length: 4                                <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Source SubAddress Type/Len: NSAP format/0                <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.0.. .... = Type: NSAP format (0)                    <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;..00 0000 = Length: 0                                <br>
&nbsp;&nbsp;&nbsp;&nbsp;NHRP Mandatory Part                                          <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Source Protocol Len: 4                                   <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Destination Protocol Len: 4                              <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Flags: 0x8002, Uniqueness Bit, Cisco NAT Supported       <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Request ID: 0x00010003 (65539)                           <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Source NBMA Address: 99.255.60.6                         <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Source Protocol Address: 172.30.1.7                      <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Destination Protocol Address: 172.30.1.1                 <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Client Information Entry                                 <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Code: Success (0)                                    <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Prefix Length: 32                                    <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Unused: 0                                            <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Max Transmission Unit: 17916                         <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Holding Time (s): 7200                               <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Client Address Type/Len: NSAP format/0               <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.0.. .... = Type: NSAP format (0)                <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;..00 0000 = Length: 0                            <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Client Sub Address Type/Len: NSAP format/0           <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.0.. .... = Type: NSAP format (0)                <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;..00 0000 = Length: 0                            <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Client Protocol Length: 0                            <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CIE Preference Value: 0                              <br>
&nbsp;&nbsp;&nbsp;&nbsp;Responder Address Extension                                  <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1... .... .... .... = Compulsory Flag: True              <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;..00 0000 0000 0011 = Extension Type: 0x0003             <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Extension length: 0                                      <br>
&nbsp;&nbsp;&nbsp;&nbsp;Forward Transit NHS Record Extension                         <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1... .... .... .... = Compulsory Flag: True              <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;..00 0000 0000 0100 = Extension Type: 0x0004             <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Extension length: 0                                      <br>
&nbsp;&nbsp;&nbsp;&nbsp;Reverse Transit NHS Record Extension                         <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1... .... .... .... = Compulsory Flag: True              <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;..00 0000 0000 0101 = Extension Type: 0x0005             <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Extension length: 0                                      <br>
&nbsp;&nbsp;&nbsp;&nbsp;Cisco NAT Address Extension                                  <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0... .... .... .... = Compulsory Flag: False             <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;..00 0000 0000 1001 = Extension Type: 0x0009             <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Extension length: 20                                     <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Client Information Entry                                 <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Code: Success (0)                                    <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Prefix Length: 32                                    <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Unused: 0                                            <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Max Transmission Unit: 17916                         <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Holding Time (s): 0                                  <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Client Address Type/Len: NSAP format/4               <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.0.. .... = Type: NSAP format (0)                <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;..00 0100 = Length: 4                            <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Client Sub Address Type/Len: NSAP format/0           <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.0.. .... = Type: NSAP format (0)                <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;..00 0000 = Length: 0                            <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Client Protocol Length: 4                            <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CIE Preference Value: 0                              <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Client NBMA Address: 99.255.10.2                     <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Client Protocol Address: 172.30.1.1                  <br>
&nbsp;&nbsp;&nbsp;&nbsp;End of Extension                                             <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1... .... .... .... = Compulsory Flag: True              <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;..00 0000 0000 0000 = Extension Type: 0x0000             <br>
</code></div>
</p>

<h3>NHRP Resolution Message</h3>
<p>
Resolution request messages are sent to locate and provide address resolution information 
 of the DMVPN egress router toward a destination. Resolution Reply provides the 
      tunnel IP address and the NBMA of the remote spoke.
      Spokes talking to each other; spoke queries the hub for NBMA-to-VPN mappings of 
      other spokes which is required to build spoke-to-spoke tunnels.
</p>

<h3>NHRP Redirect</h3>
<p>
NHRP redirect messages are sent by an intermediate router (hub) to notify the spoke  
  originating traffic that a specific destination network can be reached by a more optimal 
  path (spoke to spoke) (Phase 3) rather than through the hub. This makes it possible 
  for DMVPN to support building dynamic spoke-to-spoke tunnels. <b>NHRP Redirect 
  suppression messages</b> can be sent by spoke to indicate that the redirected path is not feasible.
This is similar to IP redirects, when packet in/out interface is the same. 
Redirect messages are sent by hubs that are configured with the tunnel command 
<code><b> ip nhrp redirect</b></code> in DMVPN phase 3 operation.
</p>

<h3>NHRP Purge</h3>
<p>
Purge messages are sent to remove a cached NHRP entry for example after the 
  loss of a route by NHS. They are sent by the hub to spokes which previously requested 
  for NBMA-overlay address mapping.
</p>

<h3>NHRP Error</h3>
<p>

  Used to notify the sender of an NHRP packet that an error 
  has occurred.

</p>

<h2>NHRP Extension Messages</h2>
<p>
These messages are included as an extension to an NHRP packet and contain additional  
information;
<ul>
  <li><b>Responder Address:</b> To determine the address of the responding node for replies.</li>
  <li><b>Forward-Transit NHS Record and Reverse-Transit NHS Record:</b> List of 
  NHSs that an NHRP request and reply may have traversed respectively.</li>
  <li><b>Authentication:</b> conveys authentication information between a pair 
  of NHRP speakers in plain text.</li>
  <li><b>Vendor Private:</b> vendor private information between speakers.</li>
  <li><b>NAT Address:</b> DMVPN operates in NAT environment. It detects inside 
  local and inside global addresses.</li>
</ul>
  Spoke sites initiate a persistent VPN connection to the hub. DMVPN dynamically
  builds a VPN tunnel between spoke sites on an as-needed basis.
</p>

<p>
All listed NHRP packets contain a mandatory header section that must include; 
source NBMA address, source protocol address, destination protocol address and NHRP message type.
</p>



<h2>NHRP Table</h2>
<p>
All spokes statically define the hub in their configuration.

The NHS creates a mapping to NBMA to tunnel IP address for all NHCs that register 
with it. This mapping is known as the NHRP table. This table is shared by the 
NHS to NHC so that when a spoke wishes to communicate with a remote NHC, when it 
sends a resolution request to the NHS, the NHS shares the NHRP mapping with the NHC.
</p>

<h2>Configuration of NHRP</h2>
<p>

</p>

<h3>Hub Configuration</h3>
<p>
NHRP configuration takes place under the tunnel interface. 
Continuing from the previous stages on the configuration of a hub using mGRE;
</p>
<h4>Step 9: Enable NHRP on the tunnel interface</h4>
<p>
NHRP is enabled on the tunnel using the tunnel mode command 
<code><b>ip nhrp network-id &lt;1 – 4294967295&gt;</b></code>.
Network-ID is locally significant but is recommended to match on all routers. 
It identifies the DMVPN cloud on a router. One router can participate in many 
DMVPN clouds. This ID uniquely identifies each of these clouds.
</p>
<p>
<div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
 <code>
HUB(config-if)#<b>ip nhrp network-id 200</b>
</code>
</div>
</p>

<h4>Step 10: (Optional) Define the tunnel key</h4>
<p>
The tunnel key is defined using the tunnel interface configuration command 
<code><b>tunnel key &lt;0 – 4294967295&gt;</b></code>. The tunnel key 
identifies the interface in the DMVPN cloud. It provides some limited control 
over the registration of NHCs with NHSs. If configured on the NHS, the tunnel key 
must match on all the connecting NHCs. This provides some control over 
misconfigurations of NHCs registering with the wrong NHS.
</p>
<p>
<div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
 <code>
HUB(config-if)#<b>tunnel key 200</b>
</code>
</div>
</p>
<p>
Configuration of the tunnel key adds an additional 4-bytes to the DMVPN header.
</p>
<h4>Step 11: (Optional) Enable multicast support for NHRP</h4>
<p>
<div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
 <code>
HUB(config-if)#<b>ip nhrp map multicast dynamic</b>
</code>
</div>
</p>
<p>
This enables the hub to accept dynamic registrations from spokes.
</p>
<p>
This is particularly important if Interior Gateway Protocols such as OSPF and EIGRP are to be
used for routing. IGPs use multicast for sending and receiving some packet
types such as Hello packets to dynamically-learned spokes.
</p>

<h4>Step 12: (Optional) Authentication</h4>
<p>
To require spokes to authenticate with the NHS before registration or resolution 
requests can be made. The password used with NHRP authentication is stored in plain text.
</p>
<p>
<div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
 <code>
HUB(config-if)#<b>ip nhrp authentication simplesimple123</b>
</code>
</div>
</p>
<p>
This command helps prevent misconfiguration such as one NHC registering with 
the wrong NHS. If authentication is configured on the NHS, it must be configured 
on all NHCs with the same password. For security of DMVPN tunnels, IPSec is 
used instead.
</p>

<h2 id="PHASE1">DMVPN Phase 1: Point to Point</h2>
<p>
DMVPN Phase 1 creates point to point tunnels between the hub and each of the 
spokes resulting in a more traditional hub and spoke topology. For each NHC to 
communicate with any other NHC, all traffic must be sent through the hub.
</p>
<p>
In DMVPN phase 1, all traffic is sent through the hub regardless of whether the 
spokes are in the same broadcast domain. The hub places itself as the next-hop in 
all routing updates.
</p>
<p>
In Phase 1, no NHRP requests are sent. Additionally, route summarization at the 
hub is possible in phase 1 and 3 but not in DMVPN phase 2.
</p>
<p>
The default behaviour of EIGRP in DMVPN phase 1 a router makes itself as the 
next-hop by default.
</p>
<p>
If using OSPF, DMPVN phase 1 is implemented if the network type is point-to-multipoint.
This is because the hub automatically sets itself as the next-hop in routing 
updates. If the interface is broadcast, then phase 2 or 3 is implemented because OSPF 
does not modify the next-hop. It keeps it unchanged.
</p>
<h3>Spoke Configuration</h3>
<p>
Continuing the earlier configuration of mGRE on the spoke;
</p>

<h3>Step 5: Enable NHRP on the tunnel interface</h3>
<p>
NHRP is enabled using the command <code><b>ip nhrp network-id &lt;1 – 4294967295&gt;</b></code>.
The Network ID identifies the DMVPN cloud on a router. It is locally 
significant and does not have to be the same between spoke an hub but is recommended 
to match on all routers participant in the same DMVPN cloud.
</p>
<p>
<div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
 <code>
SPOKE7(config-if)#<b>ip nhrp network-id 200</b>
</code>
</div>
</p>

<h3>Step 6: (Optional) Define the tunnel key</h3>
<p>
The command <code><b>tunnel key &lt;0 – 4294967295&gt;</b></code> is used to configure the tunnel 
key. The tunnel 
key identifies the interface in the DMVPN cloud. It provides some limited control 
over the registration of NHCs with NHSs. If configured on the NHS, the tunnel key
must match on all the connecting NHCs. This provides some control over misconfigurations of
NHCs registering with the wrong NHS.
</p>
<p>
<div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
 <code>
SPOKE7(config-if)#<b>tunnel key 200</b>
</code>
</div>
</p>

<h3>Step 7: Specify the NHS NBMA address and multicast mapping</h3>
<p>
The NHS NBMA address and multicast mapping is accomplished using the command 
<code><b>ip nhrp nhs &lt;nhs_tunnel_address&gt; nbma &lt;nbma_address&gt; multicast</b></code>.
</p>
<p>
<div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
 <code>
SPOKE7(config-if)#<b>ip nhrp nhs 172.30.1.1 nbma 99.255.10.2 multicast</b>
</code>
</div>
</p>
<p>
Alternative NHRP mapping commands are needed only where a static unicast or 
multicast map is needed for a node (NHC).
</p>
<p>
<div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
 <code>
#ip nhrp nhs &lt;nhs_tunnel_address&gt;<br>
#ip nhrp map &lt;nhs_tunnel_address&gt; &lt;nhs_nbma_addr&gt;<br>
#ip nhrp map multicast &lt;nhs_nbma_addr | dynamic&gt;<br>
</code>
</div>
</p>
<p>
<div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
 <code>
SPOKE7(config-if)#<b>ip nhrp nhs 172.30.1.1</b><br>
SPOKE7(config-if)#<b>ip nhrp map 172.30.1.1 99.255.10.2</b><br>
SPOKE7(config-if)#<b>ip nhrp map multicast 99.255.10.2</b>
</code>
</div>
</p>
<p>
The value of the NBMA address of the NHS must be the same as the IP address 
configured as tunnel source IP address or specifying the tunnel 
source interface during configuring of the tunnel interface on the NHS. 
Configuring any other IP address on the NHS even if the NHC has a route to that 
interface will not activate the tunnel.
</p>

<h3 id="VERIFICATION_PHASE1">Verification</h3>
<p>

</p>

<h4><code>traceroute</code></h4>
<p>
The NHS (HUB) should always be one hop away from the NHC through the VPN tunnel. This can 
confirmed through a traceroute to the NHS from any of the NHCs.
</p>
<p>
<div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
 <code>
SPOKE2#<b>traceroute 172.30.1.7</b>                  <br>
Type escape sequence to abort.                       <br>
Tracing the route to 172.30.1.7                      <br>
VRF info: (vrf in name/id, vrf out name/id)          <br>
&nbsp;&nbsp;1 172.30.1.1 24 msec 56 msec 52 msec     <br>
&nbsp;&nbsp;2 172.30.1.7 176 msec 144 msec 140 msec  <br>
SPOKE2#
</code></div>
</p>
<p>
The NHCs should be two hops away from each other with the first hop being the NHS.
</p>
<p>
<div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
 <code>
SPOKE7#<b>traceroute 172.30.1.2</b><br>
Type escape sequence to abort.                <br>
Tracing the route to 172.30.1.2               <br>
VRF info: (vrf in name/id, vrf out name/id)   <br>
&nbsp;&nbsp;1 172.30.1.1 76 msec 76 msec 24 msec        <br>
&nbsp;&nbsp;2 172.30.1.2 132 msec 84 msec 84 msec       <br>
SPOKE7#
</code>
</div>
</p>

<h4><code>show dmvpn detail</code></h4>
<p>
<div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
 <code>
HUB#<b>show dmvpn detail</b>                                                     <br>
Legend: Attrb --> S - Static, D - Dynamic, I - Incomplete&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;N - NATed, L - Local, X - No Socket&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Ent --> Number of NHRP entries with same NBMA peer&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NHS Status: E --> Expecting Replies, R --> Responding, W --> Waiting&nbsp;&nbsp;&nbsp;&nbsp; <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UpDn Time --> Up or Down Time for a Tunnel&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>
==========================================================================&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>
Interface Tunnel0 is up/up, Addr. is 172.30.1.1, VRF ""&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <br>
&nbsp;&nbsp; Tunnel Src./Dest. addr: 99.255.10.2/MGRE, Tunnel VRF ""&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>
&nbsp;&nbsp; Protocol/Transport: "multi-GRE/IP", Protect ""&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <br>
&nbsp;&nbsp; Interface State Control: Disabled&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>
&nbsp;&nbsp; nhrp event-publisher : Disabled&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>
Type:Hub, Total NBMA Peers (v4/v6): 2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>
# Ent&nbsp;&nbsp;Peer NBMA Addr Peer Tunnel Add State&nbsp;&nbsp;UpDn Tm Attrb&nbsp;&nbsp;&nbsp;&nbsp;Target Network&nbsp;&nbsp;&nbsp;&nbsp; <br>
----- --------------- --------------- ----- -------- ----- -----------------&nbsp;&nbsp;&nbsp;&nbsp; <br>
&nbsp;&nbsp;&nbsp;&nbsp;1 99.255.30.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;172.30.1.2&nbsp;&nbsp;&nbsp;&nbsp;UP 01:18:17&nbsp;&nbsp;&nbsp;&nbsp;D&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;172.30.1.2/32&nbsp;&nbsp;&nbsp;&nbsp; <br>
&nbsp;&nbsp;&nbsp;&nbsp;1 99.255.60.6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;172.30.1.7&nbsp;&nbsp;&nbsp;&nbsp;UP 00:49:31&nbsp;&nbsp;&nbsp;&nbsp;D&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;172.30.1.7/32&nbsp;&nbsp;&nbsp;&nbsp; <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>
Crypto Session Details:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <br>
-------------------------------------------------------------------------------- <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>
Pending DMVPN Sessions:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <br>
</code></div>
</p>


<h4><code>show ip nhrp</code></h4>
<p>
View the NHRP table on the hub and the spoke. The records in the NHRP table 
expire after 5 minutes if not used. On spokes, before communicating with any 
other remote spoke, only the hub information is contained in the NHRP table.
</p>

<p>
The NHRP table can be viewed as shown below:
</p>
<p>
<div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
 <code>
HUB#<b>show ip nhrp detail</b>                   <br>        
172.30.1.2/32 via 172.30.1.2                     <br> 
&nbsp;&nbsp; Tunnel0 created 05:05:46, expire 01:39:22     <br> 
&nbsp;&nbsp; Type: dynamic, Flags: unique registered used  <br> 
&nbsp;&nbsp; NBMA address: 99.255.30.1                     <br> 
172.30.1.3/32 via 172.30.1.3                     <br> 
&nbsp;&nbsp; Tunnel0 created 04:32:30, expire 01:54:17     <br> 
&nbsp;&nbsp; Type: dynamic, Flags: unique registered used  <br> 
&nbsp;&nbsp; NBMA address: 99.255.40.6                     <br> 
172.30.1.7/32 via 172.30.1.7                     <br> 
&nbsp;&nbsp; Tunnel0 created 05:03:10, expire 01:21:34     <br> 
&nbsp;&nbsp; Type: dynamic, Flags: unique registered used  <br> 
&nbsp;&nbsp; NBMA address: 99.255.60.6                     <br> 
172.30.1.8/32 via 172.30.1.8                     <br> 
&nbsp;&nbsp; Tunnel0 created 05:00:34, expire 01:54:43     <br> 
&nbsp;&nbsp; Type: dynamic, Flags: unique registered used  <br> 
&nbsp;&nbsp; NBMA address: 99.255.60.2                     <br> 
172.30.1.100/32 via 172.30.1.100                 <br> 
&nbsp;&nbsp; Tunnel0 created 05:06:18, expire 01:39:06     <br> 
&nbsp;&nbsp; Type: dynamic, Flags: unique registered used  <br> 
&nbsp;&nbsp; NBMA address: 99.255.20.2                     <br> 
HUB#                
</code></div>
</p>

<h2 id="PHASE2">DMVPN Phase 2</h2>
<p>
In DMVPN phase 2 operation, all spoke to spoke data traffic is routed directly 
without transiting the hub. 
All routers i.e. NHCs and NHS implement multi-point GRE. A dynamic NHRP mapping 
entry appears in the NHRP table for communication with a remote spoke.

When a spoke initiates communication with a remote spoke, it sends an NHRP 
request to the hub about the remote NBMA IP address. The hub sends an NHRP forward to 
the spoke (destination) indicating the source spoke NBMA and tunnel addresses. 
The destination spoke adds this mapping entry into its NHRP table /cache. The 
destination spoke then sends the source spoke an NHRP reply (unicast) with its
NBMA and tunnel addresses.
</p>
<p>
Spokes are statically configured with the hub. The hub does not modify the next-hop 
in routing updates. If a spoke X receives a routing update from the hub and this 
update has an unchanged next-hop, the NHRP table is consulted for the next-hop NBMA address.
If the next-hop NBMA address is not in the NHRP table, an NHRP request is sent to
the hub requesting for the underlay-overlay IP address mapping of the next-hop. 
The hub will forward with request to the spoke that is the next-hop. 
</p>
<p>
Phase 2 doesn’t support summarisation (at the hub). This is the primary difference 
between phase 2 and phase 3. If the hub summarizes the routes, then spoke-to-spoke 
communication will not happen directly and DMVPN reverts to phase 1 where all 
data-plane traffic will transit the hub.
</p>

<h3>Spoke Configuration</h3>
<p>
In configuration of a phase 2 DMVPN tunnel, replace <code><b>tunnel destination </b></code> command 
with <code><b>tunnel mode gre multipoint</b></code>.
</p>
<p>
Replace:
</p>
<p>
<div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
 <code>
SPOKE7(config-if)#<b>tunnel destination 99.255.10.2</b>
</code>
</div>
</p>
<p>
with
</p>
<p>
<div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
 <code>
SPOKE7(config-if)#<b>tunnel mode gre multipoint</b>
</code>
</div>
</p>

<h3>Next-Hop</h3>
<p>
If EIGRP is configured as the overlay IGP, the hub does not modify the next hop 
attribute of remote prefixes that it advertises. 
So the <code><b>next-hop-self</b></code> feature of EIGRP on the tunnel interface 
can be disabled on the NHS. Additionally, as the hub is connected to the spokes 
through the same interface, split-horizon for EIGRP should also be disabled on 
the tunnel interface otherwise EIGRP will not advertise routes that are learned 
via the mGRE interface back out that interface;
</p>
<p>
<div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
 <code>
HUB(config)#<b>interface tunnel0</b><br>
HUB(config-if)#<b>no ip next-hop-self eigrp 100</b><br>
HUB(config-if)#<b>no ip split-horizon eigrp 100</b>
</code>
</div>
</p>
<p>
With OSPF, the interface type should be changed to BROADCAST from point-to-multipoint.
</p>
<p>
<div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
 <code>
HUB(config)#<b>interface tunnel0</b><br>
HUB(config-if)#<b>ip ospf network broadcast</b>
</code>
</div>
</p>
<p>
Like OSPF, the tunnel interface in IS-IS should be configured as a BROADCAST. 
However, database synchronisation and convergence need to be completed first. 
With eBGP, third party next-hops can be used. IBGP does not modify the next-hop by default.
</p>

<h3>Dynamic Peers</h3>
<p>
The mapping of tunnel to NBMA addresses is dynamic on the NHS. Each NHC can register 
with the NHC without any prior preconfigurations on the NHS. This results in the 
NHCs being dynamic peers. The number of spokes may grow exponentially. Dynamic 
peering makes the registration of this increasing number of NHCs scalable.
</p>
<p>
Peering is automatic under the following conditions:
<ul>
  <li>Correct authentication</li>
  <li>Proper phase 1, phase 2 matching.</li>
</ul>
</p>
<p>
The hub has open configuration accepting NHCs with the correct configuration. 
The NHCs are configured with the IP address of the hub.
</p>
<p>
The spoke to spoke tunnel information is temporary. The address of the hub is 
permanent. However, for spoke information,the tunnel is torn down after the 
communication is completed and the expiry of the tunnel session timer.
</p>

<h3>OSPF</h3>
<p>
In DMVPN phase 2, if OSPF is configured as the routing protocol for the overlay 
network, the following should be considered:
<ul>
  <li>Configure the tunnel interface on the hub with the highest priority <code><b>ip ospf priority 255</b></code>. 
  This ensures that the hub becomes the designated router (DR)</li>
  <li>The spokes should be eliminated from DR/BDR election: <code><b>ip ospf priority 0</b></code>.</li>
  <li>The tunnel interface should be set to BROADCAST: <code><b>ip ospf network broadcast</b></code>.</li>
</ul>
</p>

<h2 id="PHASE3">DMVPN Phase 3</h2>
<p>

</p>

<h3>Spoke Configuration</h3>
<p>
In DMVPN Phase 3 configuration;
</p>

<p>NHS</p>
<p>
<div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
 <code>
HUB(config)#<b>interface tunnel0</b><br>
HUB(config-if)#<b>ip nhrp redirect</b></br>
</code>
</div>
</p>

<p>NHC;</p>
<p>
<div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
 <code>
SPOKE7(config)#<b>interface tunnel0</b><br>
SPOKE7(config-if)#<b>ip nhrp shortcut </b><br>
</code>
</div>
</p>
<p>
The command <code><b>ip nhrp redirect</b></code> on the NHS checks the flow of packets on the 
physical interface and sends a redirect message to the source spoke router when 
it detects packets hairpinning out of the DMVPN cloud. <b>Hairpinning is when 
traffic is received and sent out of an interface in the same DMVPN cloud (identified 
by the NHRP network ID). Hairpinning of traffic triggers redirect messages.</b>
</p>
<p>
When NHC X wants to communicate with NHC Y:
<ul>
  <li>NHC X sends traffic to the NHS.</li>
  <li>NHS sends NHRP messages to NHC Y informing NHC Y that NHC X would like to communicate 
with it.</li>
  <li>NHC Y replies with its particulars to NHS.</li>
  <li>NHS detects that the reply from NHC Y was received through the same interface
  that it received the resolution request from NHC X (hairpining). It sends a traffic indication (redirect) message 
to NHC Y informing NHC Y that NHC X can be reached through a direct route than 
the route through the NHS.</li>
<li>NHS also sends a redirect message to NHC X indicating 
that NHC Y can be reached through a better direct route than the route through 
NHS.</li>
<li>The redirect from the NHS is known as traffic indication.</li>
<li>For NHC X and NHC Y to utilise these redirect messages from NHS, they need to 
have the command <code><b>ip nhrp shortcut</b></code> configured on their tunnel interface.</li>
</ul>

It is important to note that in DMVPN phase 3, initial data traffic is through 
the hub only if the tunnel – NBMA address mapping is not yet in the NHRP table 
of the spokes. This is because an NHRP Resolution Request is sent to the hub.
Subsequent traffic is direct to remote spoke.
</p>

<p>
<div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
 <code>
SPOKE8#<b>traceroute 10.2.12.1</b>           <br>
Type escape sequence to abort.               <br>
Tracing the route to 10.2.12.1               <br>
VRF info: (vrf in name/id, vrf out name/id)  <br>
&nbsp;&nbsp;1 172.30.1.1 96 msec 60 msec 40 msec       <br>
&nbsp;&nbsp;2 172.30.1.2 68 msec 56 msec 52 msec       <br>
SPOKE8#                                      <br>
SPOKE8#<b>traceroute 10.2.12.1</b>           <br>
Type escape sequence to abort.               <br>
Tracing the route to 10.2.12.1               <br>
VRF info: (vrf in name/id, vrf out name/id)  <br>
&nbsp;&nbsp;1 172.30.1.2 16 msec 72 msec 28 msec       <br>
SPOKE8#
</code></div>
</p>

<h4>Verification of traffic indication</h4>
<p>
<div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
 <code>
SPOKE7#<b>debug dmvpn all all</b>                                                         <br>
SPOKE7#<b>ping 10.2.10.1</b>                                                                                                                                          <br>
Type escape sequence to abort.                                                                                                                                 <br>
Sending 5, 100-byte ICMP Echos to 10.2.10.1, timeout is 2 seconds:                                                                                             <br>
!!!!!                                                                                                                                                          <br>
Success rate is 100 percent (5/5), round-trip min/avg/max = 16/82/256 ms                                                                                       <br>
SPOKE7#                                                                                                                                                        <br>
*Apr&nbsp;&nbsp;7 04:30:18.035: NHRP: NHRP could not map 172.30.1.2 to NBMA, cache entry not found                                                                       <br>
*Apr&nbsp;&nbsp;7 04:30:18.039: NHRP: MACADDR: if_in null netid-in 0 if_out Tunnel0 netid-out 1000                                                                       <br>
*Apr&nbsp;&nbsp;7 04:30:18.039: NHRP: Sending packet to NHS 172.30.1.1 on Tunnel0                                                                                        <br>
*Apr&nbsp;&nbsp;7 04:30:18.039: NHRP: NHRP successfully mapped '172.30.1.1' to NBMA 99.255.10.2                                                                          <br>
*Apr&nbsp;&nbsp;7 04:30:18.043: NHRP: Checking for delayed event NULL/172.30.1.2 on list (Tunnel0).                                                                      <br>
*Apr&nbsp;&nbsp;7 04:30:18.043: NHRP: No node found.&nbsp;&nbsp;                                                                                                                   <br>
*Apr&nbsp;&nbsp;7 04:30:18.043: NHRP: No cache for forwarding(flags:0x0) to 172.30.1.2                                                                                   <br>
*Apr&nbsp;&nbsp;7 04:30:18.043: NHRP: Updating with NHS cache for dst:172.30.1.2                                                                                         <br>
*Apr&nbsp;&nbsp;7 04:30:18.043: NHRP: Tunnel0: Cache add for target 172.30.1.2/32 next-hop 172.30.1.2                                                                    <br>
*Apr&nbsp;&nbsp;7 04:30:18.043:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;99.255.10.2                                                                                                                   <br>
*Apr&nbsp;&nbsp;7 04:30:18.043: NHRP: Adding Tunnel Endpoints (VPN: 172.30.1.2, NBMA: 99.255.10.2)                                                                       <br>
*Apr&nbsp;&nbsp;7 04:30:18.055: NHRP: Successfully attached NHRP subblock for Tunnel Endpoints (VPN: 172.30.1.2, NBMA: 99.255.10.2)                                      <br>
*Apr&nbsp;&nbsp;7 04:30:18.059&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                   <br>
SPOKE7#: NHRP: Inserted subblock node for cache: Target Inserted subblock node for cache: Target 172.30.1.2/32nhop 172.30.1.2                                  <br>
*Apr&nbsp;&nbsp;7 04:30:18.063: NHRP: Converted internal dynamic cache entry for 172.30.1.2/32 interface Tunnel0 to external                                             <br>
*Apr&nbsp;&nbsp;7 04:30:18.067: NHRP: Enqueued NHRP Resolution Request for destination: 172.30.1.2                                                                       <br>
*Apr&nbsp;&nbsp;7 04:30:18.083: NHRP: Checking for delayed event NULL/172.30.1.2 on list (Tunnel0).                                                                      <br>
*Apr&nbsp;&nbsp;7 04:30:18.083: NHRP: No node found.&nbsp;&nbsp;                                                                                                                   <br>
*Apr&nbsp;&nbsp;7 04:30:18.087: NHRP-ATTR:&nbsp;&nbsp;Requester Ext Len: Total ext_len  with NHRP attribute VPE 20                                                                 <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                   <br>
*Apr&nbsp;&nbsp;7 04:30:18.091: NHRP: Sending NHRP Resolution Request for dest: 172.30.1.2 to nexthop: 172.30.1.2 using our src: 172.30.1.7                              <br>
*Apr&nbsp;&nbsp;7 04:30:18.091: NHRP: Attempting to send packet via DEST 172.30.1.2                                                                                      <br>
*Apr&nbsp;&nbsp;7 04:30:18.095: NHRP: Setting 'used' flag on cache entry with nhop: 172.30.1.2                                                                           <br>
*Apr&nbsp;&nbsp;7 04:30:18.099: NHRP: NHRP successfully mapped '172.30.1.2' to NBMA 99.255.10.2                                                                          <br>
*Apr&nbsp;&nbsp;7 04:30:18.103: NHRP: Encapsulation succeeded.  Sending                                                                                                  <br>
SPOKE7# NHRP Control Packet&nbsp;&nbsp;NBMA Address: 99.255.10.2                                                                                                         <br>
*Apr&nbsp;&nbsp;7 04:30:18.107: NHRP: Send Resolution Request via Tunnel0 vrf 0, packet size: 72                                                                         <br>
*Apr&nbsp;&nbsp;7 04:30:18.111:&nbsp;&nbsp;src: 172.30.1.7, dst: 172.30.1.2                                                                                                        <br>
*Apr&nbsp;&nbsp;7 04:30:18.111:&nbsp;&nbsp;(F) afn: AF_IP(1), type: IP(800), hop: 255, ver: 1                                                                                      <br>
*Apr&nbsp;&nbsp;7 04:30:18.115:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shtl: 4(NSAP), sstl: 0(NSAP)                                                                                                        <br>
*Apr&nbsp;&nbsp;7 04:30:18.115:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pktsz: 72 extoff: 52                                                                                                                <br>
*Apr&nbsp;&nbsp;7 04:30:18.115:&nbsp;&nbsp;(M) flags: "router auth src-stable nat ", reqid: 3                                                                                      <br>
*Apr&nbsp;&nbsp;7 04:30:18.119:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;src NBMA: 99.255.60.6                                                                                                               <br>
*Apr&nbsp;&nbsp;7 04:30:18.119:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;src protocol: 172.30.1.7, dst protocol: 172.30.1.2                                                                                  <br>
*Apr&nbsp;&nbsp;7 04:30:18.123:&nbsp;&nbsp;(C-1) code: no error(0)                                                                                                                 <br>
*Apr&nbsp;&nbsp;7 04:30:18.127:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;prefix: 32, mtu: 17916, hd_time: 7200                                                                                             <br>
*Apr&nbsp;&nbsp;7 04:30:18.127:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;addr_len: 0(NSAP), subaddr_len: 0(NSAP), proto_len: 0, pref: 0                                                                    <br>
*Apr&nbsp;&nbsp;7 04:30:18.127: Responder Address Extension(3):                                                                                                          <br>
*Apr&nbsp;&nbsp;7 04:30:18.127: Forward Transit NHS Record Extension(4):                                                                                                 <br>
*Apr&nbsp;&nbsp;7 04:30:18.127: Reverse Transit NHS Record Extension(5):                                                                                                 <br>
*Apr&nbsp;&nbsp;7 04:30:18.127: NAT a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                  <br>
SPOKE7#ddress Extension(9):&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                  <br>
*Apr&nbsp;&nbsp;7 04:30:18.127: NHRP: 96 bytes out Tunnel0                                                                                                               <br>
*Apr&nbsp;&nbsp;7 04:30:18.127: NHRP-RATE: Sending initial Resolution Request for 172.30.1.2, reqid 3                                                                    <br>
*Apr&nbsp;&nbsp;7 04:30:18.171: NHRP-ATTR: ext_type: 32772, ext_len : 0                                                                                                  <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                   <br>
*Apr&nbsp;&nbsp;7 04:30:18.171: NHRP-ATTR: ext_type: 32773, ext_len : 0                                                                                                  <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                   <br>
*Apr&nbsp;&nbsp;7 04:30:18.175: NHRP-ATTR: ext_type: 9, ext_len : 0                                                                                                      <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                   <br>
*Apr&nbsp;&nbsp;7 04:30:18.175: NHRP-ATTR: ext_type: 32768, ext_len : 0                                                                                                  <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                   <br>
*Apr&nbsp;&nbsp;7 04:30:18.179: NHRP: Receive Traffic Indication via Tunnel0 vrf 0, packet size: 84                                                                      <br>
*Apr&nbsp;&nbsp;7 04:30:18.183:&nbsp;&nbsp;(F) afn: AF_IP(1), type: IP(800), hop: 255, ver: 1                                                                                      <br>
*Apr&nbsp;&nbsp;7 04:30:18.183:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shtl: 4(NSAP), sstl: 0(NSAP)                                                                                                        <br>
*Apr&nbsp;&nbsp;7 04:30:18.187:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pktsz: 84 extoff: 68                                                                                                                <br>
*Apr&nbsp;&nbsp;7 04:30:18.187:&nbsp;&nbsp;(M) traffic code: redirect(0)                                                                                                           <br>
*Apr&nbsp;&nbsp;7 04:30:18.187:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;src NBMA: 99.255.10.2                                                                                                               <br>
*Apr&nbsp;&nbsp;7 04:30:18.187:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;src protocol: 172.30.1.1, dst protocol: 172.30.1.7                                                                                  <br>
*Apr&nbsp;&nbsp;7 04:30:18.187:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Contents of nhrp traffic indication packet:                                                                                         <br>
*Apr&nbsp;&nbsp;7 04:30:18.187:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 45 00 00 64 00 0                                                                                                                 <br>
SPOKE7#5 00 00 FE 01 FB 6B AC 1E 01 07&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                   <br>
*Apr&nbsp;&nbsp;7 04:30:18.187:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0A 02 0A 01 08 00 A8 4B 00 01 00                                                                                                 <br>
*Apr&nbsp;&nbsp;7 04:30:18.187: Forward Transit NHS Record Extension(4):                                                                                                 <br>
*Apr&nbsp;&nbsp;7 04:30:18.187: Reverse Transit NHS Record Extension(5):                                                                                                 <br>
*Apr&nbsp;&nbsp;7 04:30:18.187: NAT address Extension(9):                                                                                                                <br>
*Apr&nbsp;&nbsp;7 04:30:18.187: NHRP: netid_in = 1000, to_us = 1                                                                                                         <br>
*Apr&nbsp;&nbsp;7 04:30:18.187: NHRP: netid_out 0, netid_in 1000                                                                                                         <br>
*Apr&nbsp;&nbsp;7 04:30:18.187: NHRP: Parsing NHRP Traffic Indication                                                                                                    <br>
*Apr&nbsp;&nbsp;7 04:30:18.259: NHRP-ATTR: ext_type: 32771, ext_len : 20                                                                                                 <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                   <br>
*Apr&nbsp;&nbsp;7 04:30:18.263: NHRP-ATTR: ext_type: 32772, ext_len : 20                                                                                                 <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                   <br>
*Apr&nbsp;&nbsp;7 04:30:18.263: NHRP-ATTR: ext_type: 32773, ext_len : 0                                                                                                  <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                   <br>
*Apr&nbsp;&nbsp;7 04:30:18.267: NHRP-ATTR: ext_type: 9, ext_len : 0                                                                                                      <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                   <br>
*Apr&nbsp;&nbsp;7 04:30:18.267: NHRP-ATTR: ext_type: 32768, ext_len : 0                                                                                                  <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                   <br>
*Apr&nbsp;&nbsp;7 04:30:18.271: NHRP: Receive Resolution Reply via Tunnel0 vrf 0, packet size: 120                                                                       <br>
*Apr&nbsp;&nbsp;7 04:30:18.271:&nbsp;&nbsp;(F) afn: AF_IP(1), type: IP(800), hop: 255, ver: 1                                                                                      <br>
*Apr&nbsp;&nbsp;7 04:30:18.271:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shtl: 4(NSAP), sstl: 0(NSAP)                                                                                                        <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                   <br>
SPOKE7#*Apr&nbsp;&nbsp;7 04:30:18.271:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pktsz: 120 extoff: 60                                                                                                        <br>
*Apr&nbsp;&nbsp;7 04:30:18.271:&nbsp;&nbsp;(M) flags: "router auth dst-stable unique src-stable nat ", reqid: 3                                                                    <br>
*Apr&nbsp;&nbsp;7 04:30:18.271:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;src NBMA: 99.255.60.6                                                                                                               <br>
*Apr&nbsp;&nbsp;7 04:30:18.271:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;src protocol: 172.30.1.7, dst protocol: 172.30.1.2                                                                                  <br>
*Apr&nbsp;&nbsp;7 04:30:18.271:&nbsp;&nbsp;(C-1) code: no error(0)                                                                                                                 <br>
*Apr&nbsp;&nbsp;7 04:30:18.271:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;prefix: 32, mtu: 17916, hd_time: 7200                                                                                             <br>
*Apr&nbsp;&nbsp;7 04:30:18.271:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;addr_len: 4(NSAP), subaddr_len: 0(NSAP), proto_len: 4, pref: 0                                                                    <br>
*Apr&nbsp;&nbsp;7 04:30:18.275:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;client NBMA: 99.255.30.1                                                                                                          <br>
*Apr&nbsp;&nbsp;7 04:30:18.275:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;client protocol: 172.30.1.2                                                                                                       <br>
*Apr&nbsp;&nbsp;7 04:30:18.275: Responder Address Extension(3):                                                                                                          <br>
*Apr&nbsp;&nbsp;7 04:30:18.275:&nbsp;&nbsp;(C) code: no error(0)                                                                                                                   <br>
*Apr&nbsp;&nbsp;7 04:30:18.275:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;prefix: 32, mtu: 17916, hd_time: 7200                                                                                             <br>
*Apr&nbsp;&nbsp;7 04:30:18.275:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;addr_len: 4(NSAP), subaddr_len: 0(NSAP), proto_len: 4, pref: 0                                                                    <br>
*Apr&nbsp;&nbsp;7 04:30:18.275:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;client NBMA: 99.255.30.1                                                                                                          <br>
*Apr&nbsp;&nbsp;7 04:30:18.275:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;client protocol: 172.30.1.2                                                                                                       <br>
*Apr&nbsp;&nbsp;7 04:30:18.275: Forward&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                  <br>
SPOKE7# Transit NHS Record Extension(4):&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                   <br>
*Apr&nbsp;&nbsp;7 04:30:18.275:&nbsp;&nbsp;(C-1) code: no error(0)                                                                                                                 <br>
*Apr&nbsp;&nbsp;7 04:30:18.275:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;prefix: 32, mtu: 17916, hd_time: 7200                                                                                             <br>
*Apr&nbsp;&nbsp;7 04:30:18.275:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;addr_len: 4(NSAP), subaddr_len: 0(NSAP), proto_len: 4, pref: 0                                                                    <br>
*Apr&nbsp;&nbsp;7 04:30:18.275:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;client NBMA: 99.255.10.2                                                                                                          <br>
*Apr&nbsp;&nbsp;7 04:30:18.275:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;client protocol: 172.30.1.1                                                                                                       <br>
*Apr&nbsp;&nbsp;7 04:30:18.275: Reverse Transit NHS Record Extension(5):                                                                                                 <br>
*Apr&nbsp;&nbsp;7 04:30:18.275: NAT address Extension(9):                                                                                                                <br>
*Apr&nbsp;&nbsp;7 04:30:18.275: NHRP: netid_in = 0, to_us = 1                                                                                                            <br>
*Apr&nbsp;&nbsp;7 04:30:18.275: NHRP: nhrp_pak_reply_from_target: answer_nbma: 99.255.30.1, responder_nbma: 99.255.30.1                                                  <br>
*Apr&nbsp;&nbsp;7 04:30:18.275: NHRP: Tunnels gave us pak src: 99.255.30.1                                                                                               <br>
*Apr&nbsp;&nbsp;7 04:30:18.275: NHRP: Checking for delayed event NULL/172.30.1.2 on list (Tunnel0).                                                                      <br>
*Apr&nbsp;&nbsp;7 04:30:18.275: NHRP: No node found.&nbsp;&nbsp;                                                                                                                   <br>
*Apr&nbsp;&nbsp;7 04:30:18.279: NHRP: No need to delay processing of resolution event nbma src:99.255.60.6 nbma dst:99.255.30.1                                          <br>
*Apr&nbsp;&nbsp;7 04:30:18.279: NHRP-ATTR: In nhrp_cach                                                                                                                  <br>
SPOKE7#e_pak LINE: 1422&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                  <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                   <br>
*Apr&nbsp;&nbsp;7 04:30:18.279: NHRP: Tunnel0: Cache update for target 172.30.1.2/32 next-hop 172.30.1.2                                                                 <br>
*Apr&nbsp;&nbsp;7 04:30:18.279:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;99.255.30.1                                                                                                                   <br>
*Apr&nbsp;&nbsp;7 04:30:18.283: NHRP: Deleted subbblock node associated with Cache:  Prefix: Deleted subbblock node associated with Cache:  Prefix: 172.30.1.2/32nhop 17 <br>
2.30.1.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                   <br>
*Apr&nbsp;&nbsp;7 04:30:18.283: NHRP: Deleted subbblock node associated with Cache:  Prefix: Deleted subbblock node associated with Cache:  Prefix: 172.30.1.2/32nhop 17 <br>
2.30.1.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                   <br>
*Apr&nbsp;&nbsp;7 04:30:18.283: NHRP: Adding Tunnel Endpoints (VPN: 172.30.1.2, NBMA: 99.255.30.1)                                                                       <br>
*Apr&nbsp;&nbsp;7 04:30:18.283: NHRP: Cleanup up 0 stale cache entries                                                                                                   <br>
*Apr&nbsp;&nbsp;7 04:30:18.287: NHRP: Successfully attached NHRP subblock for Tunnel Endpoints (VPN: 172.30.1.2, NBMA: 99.255.30.1)                                      <br>
*Apr&nbsp;&nbsp;7 04:30:18.287: NHRP: Inserted subblock node for cache: Target Inserted subblock node for cache: Target 172.30.1.2/32nhop 172.30.1.2                     <br>
*Apr&nbsp;&nbsp;7 04:30:18.295: NHRP: Setting 'used' flag on cache entry with nhop: 172.30.1.2                                                                           <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                   <br>
SPOKE7#*Apr&nbsp;&nbsp;7 04:30:18.295: NHRP: NHRP successfully mapped '172.30.1.2' to NBMA 99.255.30.1                                                                   <br>
*Apr&nbsp;&nbsp;7 04:30:18.347: NHRP: NHRP successfully mapped '172.30.1.2' to NBMA 99.255.30.1                                                                          <br>
*Apr&nbsp;&nbsp;7 04:30:18.367: NHRP: NHRP successfully mapped '172.30.1.2' to NBMA 99.255.30.1                                                                          <br>
*Apr&nbsp;&nbsp;7 04:30:18.411: NHRP: NHRP successfully mapped '172.30.1.2' to NBMA 99.255.30.1                                                                          <br>
SPOKE7#                                                                                                                                                        <br>
</code></div>
</p>
<p>
On the NHS:
</p>
<p>
<div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
 <code>
HUB#<b>debug dmvpn all all</b>                                                                    <br>
HUB#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                <br>
*Apr&nbsp;&nbsp;7 04:57:28.563: NHRP: Tunnels gave us remote_nbma: 99.255.60.6 for Redirect                                   <br>
*Apr&nbsp;&nbsp;7 04:57:28.563: NHRP: Attempting to Redirect, remote_nbma: 99.255.60.6                                        <br>
*Apr&nbsp;&nbsp;7 04:57:28.567: NHRP: inserting (99.255.60.6/10.2.10.1) in redirect table                                     <br>
*Apr&nbsp;&nbsp;7 04:57:28.571: NHRP-ATTR:&nbsp;&nbsp;Requester Ext Len: Total ext_len  with NHRP attribute VPE 16                      <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                <br>
*Apr&nbsp;&nbsp;7 04:57:28.575: NHRP: Attempting to send packet via DEST 172.30.1.7                                           <br>
*Apr&nbsp;&nbsp;7 04:57:28.579: NHRP: Encapsulation succeeded.  Sending NHRP Control Packet  NBMA Address: 99.255.60.6        <br>
*Apr&nbsp;&nbsp;7 04:57:28.583: NHRP: Send Traffic Indication via Tunnel0 vrf 0, packet size: 84                              <br>
*Apr&nbsp;&nbsp;7 04:57:28.587:&nbsp;&nbsp;src: 172.30.1.1, dst: 172.30.1.7                                                             <br>
*Apr&nbsp;&nbsp;7 04:57:28.591:&nbsp;&nbsp;(F) afn: AF_IP(1), type: IP(800), hop: 255, ver: 1                                           <br>
*Apr&nbsp;&nbsp;7 04:57:28.591:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shtl: 4(NSAP), sstl: 0(NSAP)                                                             <br>
*Apr&nbsp;&nbsp;7 04:57:28.591:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pktsz: 84 extoff: 68                                                                     <br>
*Apr&nbsp;&nbsp;7 04:57:28.595:&nbsp;&nbsp;(M) traffic code: redirect(0)                                                                <br>
*Apr&nbsp;&nbsp;7 04:57:28.595:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;src NBMA: 99.255.10.2                                                                    <br>
*Apr&nbsp;&nbsp;7 04:57:28.595:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;src protocol: 1                                                                          <br>
HUB#72.30.1.1, dst protocol: 172.30.1.7                                                                             <br>
*Apr&nbsp;&nbsp;7 04:57:28.595:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Contents of nhrp traffic indication packet:                                              <br>
*Apr&nbsp;&nbsp;7 04:57:28.595:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 45 00 00 64 00 05 00 00 FE 01 FB 6B AC 1E 01 07                                       <br>
*Apr&nbsp;&nbsp;7 04:57:28.595:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0A 02 0A 01 08 00 A8 4B 00 01 00                                                      <br>
*Apr&nbsp;&nbsp;7 04:57:28.595: Forward Transit NHS Record Extension(4):                                                      <br>
*Apr&nbsp;&nbsp;7 04:57:28.595: Reverse Transit NHS Record Extension(5):                                                      <br>
*Apr&nbsp;&nbsp;7 04:57:28.595: NAT address Extension(9):                                                                     <br>
*Apr&nbsp;&nbsp;7 04:57:28.595: NHRP: 108 bytes out Tunnel0                                                                   <br>
*Apr&nbsp;&nbsp;7 04:57:28.599: NHRP-ATTR: ext_type: 32771, ext_len : 0                                                       <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                <br>
*Apr&nbsp;&nbsp;7 04:57:28.599: NHRP-ATTR: ext_type: 32772, ext_len : 0                                                       <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                <br>
*Apr&nbsp;&nbsp;7 04:57:28.599: NHRP-ATTR: ext_type: 32773, ext_len : 0                                                       <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                <br>
*Apr&nbsp;&nbsp;7 04:57:28.599: NHRP-ATTR: ext_type: 9, ext_len : 0                                                           <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                <br>
*Apr&nbsp;&nbsp;7 04:57:28.599: NHRP-ATTR: ext_type: 32768, ext_len : 0                                                       <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                <br>
*Apr&nbsp;&nbsp;7 04:57:28.599: NHRP: Receive Resolution Request via Tunnel0 vrf 0, packet size: 72                           <br>
*Apr&nbsp;&nbsp;7 04:57:28.599:&nbsp;&nbsp;(F) afn: AF_IP(1), type: IP(800), hop: 255, ver: 1                                           <br>
*Apr&nbsp;&nbsp;7 04:57:28.599:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                 <br>
HUB#&nbsp;&nbsp; shtl: 4(NSAP), sstl: 0(NSAP)                                                                                 <br>
*Apr&nbsp;&nbsp;7 04:57:28.599:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pktsz: 72 extoff: 52                                                                     <br>
*Apr&nbsp;&nbsp;7 04:57:28.599:&nbsp;&nbsp;(M) flags: "router auth src-stable nat ", reqid: 3                                           <br>
*Apr&nbsp;&nbsp;7 04:57:28.599:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;src NBMA: 99.255.60.6                                                                    <br>
*Apr&nbsp;&nbsp;7 04:57:28.599:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;src protocol: 172.30.1.7, dst protocol: 172.30.1.2                                       <br>
*Apr&nbsp;&nbsp;7 04:57:28.599:&nbsp;&nbsp;(C-1) code: no error(0)                                                                      <br>
*Apr&nbsp;&nbsp;7 04:57:28.599:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;prefix: 32, mtu: 17916, hd_time: 7200                                                  <br>
*Apr&nbsp;&nbsp;7 04:57:28.599:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;addr_len: 0(NSAP), subaddr_len: 0(NSAP), proto_len: 0, pref: 0                         <br>
*Apr&nbsp;&nbsp;7 04:57:28.599: Responder Address Extension(3):                                                               <br>
*Apr&nbsp;&nbsp;7 04:57:28.599: Forward Transit NHS Record Extension(4):                                                      <br>
*Apr&nbsp;&nbsp;7 04:57:28.599: Reverse Transit NHS Record Extension(5):                                                      <br>
*Apr&nbsp;&nbsp;7 04:57:28.599: NAT address Extension(9):                                                                     <br>
*Apr&nbsp;&nbsp;7 04:57:28.599: NHRP: netid_in = 1000, to_us = 0                                                              <br>
*Apr&nbsp;&nbsp;7 04:57:28.599: NHRP: nhrp_rtlookup for destination on 172.30.1.2 yielded interface Tunnel0, prefixlen 24     <br>
*Apr&nbsp;&nbsp;7 04:57:28.603: NHRP: netid_out 1000, netid_in 1000                                                           <br>
*Apr&nbsp;&nbsp;7 04:57:28.603: NHRP: Forwarding requ                                                                         <br>
HUB#est due to authoritative request.                                                                               <br>
*Apr&nbsp;&nbsp;7 04:57:28.603: NHRP-ATTR: In nhrp_recv_resolution_request NHRP Resolution Request packet is forwarded to 172.30.1.2<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                  <br>
*Apr&nbsp;&nbsp;7 04:57:28.603: NHRP: Attempting to forward to destination: 172.30.1.2                                          <br>
*Apr&nbsp;&nbsp;7 04:57:28.603: NHRP: Forwarding: NHRP SAS picked source: 172.30.1.1 for destination: 172.30.1.2                <br>
*Apr&nbsp;&nbsp;7 04:57:28.603: NHRP: Attempting to send packet via DEST 172.30.1.2                                             <br>
*Apr&nbsp;&nbsp;7 04:57:28.603: NHRP: NHRP successfully mapped '172.30.1.2' to NBMA 99.255.30.1                                 <br>
*Apr&nbsp;&nbsp;7 04:57:28.607: NHRP: Encapsulation succeeded.  Sending NHRP Control Packet  NBMA Address: 99.255.30.1          <br>
*Apr&nbsp;&nbsp;7 04:57:28.607: NHRP: Forwarding Resolution Request via Tunnel0 vrf 0, packet size: 92                          <br>
*Apr&nbsp;&nbsp;7 04:57:28.607:&nbsp;&nbsp;src: 172.30.1.1, dst: 172.30.1.2                                                               <br>
*Apr&nbsp;&nbsp;7 04:57:28.607:&nbsp;&nbsp;(F) afn: AF_IP(1), type: IP(800), hop: 254, ver: 1                                             <br>
*Apr&nbsp;&nbsp;7 04:57:28.607:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shtl: 4(NSAP), sstl: 0(NSAP)                                                               <br>
*Apr&nbsp;&nbsp;7 04:57:28.607:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pktsz: 92 extoff: 52                                                                       <br>
*Apr&nbsp;&nbsp;7 04:57:28.607:&nbsp;&nbsp;(M) flags: "router auth src-s                                                                  <br>
HUB#table nat ", reqid: 3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                   <br>
*Apr&nbsp;&nbsp;7 04:57:28.607:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;src NBMA: 99.255.60.6                                                                      <br>
*Apr&nbsp;&nbsp;7 04:57:28.607:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;src protocol: 172.30.1.7, dst protocol: 172.30.1.2                                         <br>
*Apr&nbsp;&nbsp;7 04:57:28.607:&nbsp;&nbsp;(C-1) code: no error(0)                                                                        <br>
*Apr&nbsp;&nbsp;7 04:57:28.607:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;prefix: 32, mtu: 17916, hd_time: 7200                                                    <br>
*Apr&nbsp;&nbsp;7 04:57:28.607:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;addr_len: 0(NSAP), subaddr_len: 0(NSAP), proto_len: 0, pref: 0                           <br>
*Apr&nbsp;&nbsp;7 04:57:28.607: Responder Address Extension(3):                                                                 <br>
*Apr&nbsp;&nbsp;7 04:57:28.607: Forward Transit NHS Record Extension(4):                                                        <br>
*Apr&nbsp;&nbsp;7 04:57:28.607:&nbsp;&nbsp;(C-1) code: no error(0)                                                                        <br>
*Apr&nbsp;&nbsp;7 04:57:28.607:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;prefix: 32, mtu: 17916, hd_time: 7200                                                    <br>
*Apr&nbsp;&nbsp;7 04:57:28.607:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;addr_len: 4(NSAP), subaddr_len: 0(NSAP), proto_len: 4, pref: 0                           <br>
*Apr&nbsp;&nbsp;7 04:57:28.607:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;client NBMA: 99.255.10.2                                                                 <br>
*Apr&nbsp;&nbsp;7 04:57:28.607:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;client protocol: 172.30.1.1                                                              <br>
*Apr&nbsp;&nbsp;7 04:57:28.607: Reverse Transit NHS Record Extension(5):                                                        <br>
*Apr&nbsp;&nbsp;7 04:57:28.607: NAT address Extension(9):                                                                       <br>
*Apr&nbsp;&nbsp;7 04:57:28.607: NHRP: 116 bytes out Tunnel0                                                                     <br>
*Apr&nbsp;&nbsp;7 04:57:28.679: NHRP: Tun&nbsp;&nbsp;&nbsp;&nbsp;                                                                                   <br>
HUB#nels gave us remote_nbma: 99.255.30.1 for Redirect                                                                <br>
*Apr&nbsp;&nbsp;7 04:57:28.679: NHRP: Attempting to Redirect, remote_nbma: 99.255.30.1                                          <br>
*Apr&nbsp;&nbsp;7 04:57:28.683: NHRP: inserting (99.255.30.1/172.30.1.7) in redirect table                                      <br>
*Apr&nbsp;&nbsp;7 04:57:28.687: NHRP-ATTR:&nbsp;&nbsp;Requester Ext Len: Total ext_len  with NHRP attribute VPE 16                        <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                  <br>
*Apr&nbsp;&nbsp;7 04:57:28.691: NHRP: Attempting to send packet via DEST 10.2.10.1                                              <br>
*Apr&nbsp;&nbsp;7 04:57:28.695: NHRP: Encapsulation succeeded.  Sending NHRP Control Packet  NBMA Address: 99.255.30.1          <br>
*Apr&nbsp;&nbsp;7 04:57:28.695: NHRP: Send Traffic Indication via Tunnel0 vrf 0, packet size: 84                                <br>
*Apr&nbsp;&nbsp;7 04:57:28.699:&nbsp;&nbsp;src: 172.30.1.1, dst: 10.2.10.1                                                                <br>
*Apr&nbsp;&nbsp;7 04:57:28.699:&nbsp;&nbsp;(F) afn: AF_IP(1), type: IP(800), hop: 255, ver: 1                                             <br>
*Apr&nbsp;&nbsp;7 04:57:28.699:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shtl: 4(NSAP), sstl: 0(NSAP)                                                               <br>
*Apr&nbsp;&nbsp;7 04:57:28.699:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pktsz: 84 extoff: 68                                                                       <br>
*Apr&nbsp;&nbsp;7 04:57:28.699:&nbsp;&nbsp;(M) traffic code: redirect(0)                                                                  <br>
*Apr&nbsp;&nbsp;7 04:57:28.699:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;src NBMA: 99.255.10.2                                                                      <br>
*Apr&nbsp;&nbsp;7 04:57:28.699:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;src protocol: 172.30.1.1, dst protocol: 10.2.10.1                                          <br>
HUB#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                  <br>
*Apr&nbsp;&nbsp;7 04:57:28.699:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Contents of nhrp traffic indication packet:                                                <br>
*Apr&nbsp;&nbsp;7 04:57:28.699:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 45 00 00 64 00 05 00 00 FE 01 FB 6B 0A 02 0A 01                                         <br>
*Apr&nbsp;&nbsp;7 04:57:28.699:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AC 1E 01 07 00 00 B0 4B 00 01 00                                                        <br>
*Apr&nbsp;&nbsp;7 04:57:28.699: Forward Transit NHS Record Extension(4):                                                        <br>
*Apr&nbsp;&nbsp;7 04:57:28.699: Reverse Transit NHS Record Extension(5):                                                        <br>
*Apr&nbsp;&nbsp;7 04:57:28.699: NAT address Extension(9):                                                                       <br>
*Apr&nbsp;&nbsp;7 04:57:28.699: NHRP: 108 bytes out Tunnel0                                                                     <br>
</code></div>
</p>
<p>
The following is a Wireshark packet capture of an NHRP Traffic indication message:
</p>
<p>
  <div class="separator" style="clear: both;"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiUxRu5zuOQu-w2h7S68mnYcJmfXz6ctQTzE_4ZOSqI0YGtFJVehawV2v24Mx1DpDnRSQ_WcKQbn1Qci3ZATFBjTpGBo_7-jEyvGR7XYJRitxJlQzv1BxEw_u3KFUZVU0Zj97sCM1KNzsvgvcKfGd8DPNP_L3WWCKh2C26jvdkQK3RlEQeGK87IT62d6JU/s1600/NHRP%20Traffic%20Indication%20Capture.PNG" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" data-original-height="296" data-original-width="958" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiUxRu5zuOQu-w2h7S68mnYcJmfXz6ctQTzE_4ZOSqI0YGtFJVehawV2v24Mx1DpDnRSQ_WcKQbn1Qci3ZATFBjTpGBo_7-jEyvGR7XYJRitxJlQzv1BxEw_u3KFUZVU0Zj97sCM1KNzsvgvcKfGd8DPNP_L3WWCKh2C26jvdkQK3RlEQeGK87IT62d6JU/s1600/NHRP%20Traffic%20Indication%20Capture.PNG"/></a></div>
</p>
<p>
<div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
 <code>
Frame 47: 122 bytes on wire (976 bits), 122 bytes captured (976 bits) on interface -, id 0              <br>
Ethernet II, Src: ca:06:06:9e:00:08 (ca:06:06:9e:00:08), Dst: ca:07:06:ad:00:1c (ca:07:06:ad:00:1c)     <br>
Internet Protocol Version 4, Src: 99.255.10.2, Dst: 99.255.60.6                                         <br>
Generic Routing Encapsulation (NHRP)                                                                    <br>
&nbsp;&nbsp;&nbsp;&nbsp;Flags and Version: 0x0000                                                                           <br>
&nbsp;&nbsp;&nbsp;&nbsp;Protocol Type: NHRP (0x2001)                                                                        <br>
Next Hop Resolution Protocol (NHRP Traffic Indication)                                                  <br>
&nbsp;&nbsp;&nbsp;&nbsp;NHRP Fixed Header&nbsp;&nbsp;&nbsp;&nbsp;                                                                               <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Address Family Number: IPv4 (0x0001)                                                            <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Protocol Type (short form): IPv4 (0x0800)                                                       <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Protocol Type (long form): 0000000000                                                           <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Hop Count: 255&nbsp;&nbsp;&nbsp;&nbsp;                                                                              <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Packet Length: 84                                                                               <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NHRP Packet Checksum: 0xe9dc [correct]                                                          <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[NHRP Packet Checksum Status: Good]                                                             <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Extension Offset: 68                                                                            <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Version: 1 (NHRP - rfc2332)                                                                     <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NHRP Packet Type: NHRP Traffic Indication (8)                                                   <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Source Address Type/Len: NSAP format/4                                                          <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.0.. .... = Type: NSAP format (0)                                                           <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;..00 0100 = Length: 4                                                                       <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Source SubAddress Type/Len: NSAP format/0                                                       <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.0.. .... = Type: NSAP format (0)                                                           <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;..00 0000 = Length: 0                                                                       <br>
&nbsp;&nbsp;&nbsp;&nbsp;NHRP Mandatory Part&nbsp;&nbsp;                                                                               <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Source Protocol Len: 4                                                                          <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Destination Protocol Len: 4                                                                     <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Source NBMA Address: 99.255.10.2                                                                <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Source Protocol Address: 172.30.1.1                                                             <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Destination Protocol Address: 172.30.1.7                                                        <br>
&nbsp;&nbsp;&nbsp;&nbsp;Packet Causing Indication                                                                           <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Internet Protocol Version 4, Src: 172.30.1.7, Dst: 10.2.10.1                                    <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0100 .... = Version: 4                                                                      <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.... 0101 = Header Length: 20 bytes (5)                                                     <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Differentiated Services Field: 0x00 (DSCP: CS0, ECN: Not-ECT)                               <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0000 00.. = Differentiated Services Codepoint: Default (0)                              <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.... ..00 = Explicit Congestion Notification: Not ECN-Capable Transport (0)             <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Total Length: 100                                                                           <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Identification: 0x000f (15)                                                                 <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;000. .... = Flags: 0x0                                                                      <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0... .... = Reserved bit: Not set                                                       <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.0.. .... = Don't fragment: Not set                                                     <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;..0. .... = More fragments: Not set                                                     <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...0 0000 0000 0000 = Fragment Offset: 0                                                    <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Time to Live: 254                                                                           <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Protocol: ICMP (1)                                                                          <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Header Checksum: 0xfb61 [validation disabled]                                               <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[Header checksum status: Unverified]                                                        <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Source Address: 172.30.1.7                                                                  <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Destination Address: 10.2.10.1                                                              <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Internet Control Message Protocol                                                               <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Type: 8 (Echo (ping) request)                                                               <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Code: 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                               <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Checksum: 0xb321 [unverified] [in ICMP error packet]                                        <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[Checksum Status: Unverified]                                                               <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Identifier (BE): 3 (0x0003)                                                                 <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Identifier (LE): 768 (0x0300)                                                               <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Sequence Number (BE): 0 (0x0000)                                                            <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Sequence Number (LE): 0 (0x0000)                                                            <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HiPerConTracer Trace Service                                                                    <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Magic Number: 0x80040000                                                                    <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Send TTL: 128                                                                               <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Round: 5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                              <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Checksum Tweak: 0x0000                                                                      <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Send Time Stamp: Jan  7, 2057 08:02:17.879552000 UTC                                        <br>
&nbsp;&nbsp;&nbsp;&nbsp;Forward Transit NHS Record Extension                                                                <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1... .... .... .... = Compulsory Flag: True                                                     <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;..00 0000 0000 0100 = Extension Type: 0x0004                                                    <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Extension length: 0                                                                             <br>
&nbsp;&nbsp;&nbsp;&nbsp;Reverse Transit NHS Record Extension                                                                <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1... .... .... .... = Compulsory Flag: True                                                     <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;..00 0000 0000 0101 = Extension Type: 0x0005                                                    <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Extension length: 0                                                                             <br>
&nbsp;&nbsp;&nbsp;&nbsp;Cisco NAT Address Extension                                                                         <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0... .... .... .... = Compulsory Flag: False                                                    <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;..00 0000 0000 1001 = Extension Type: 0x0009                                                    <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Extension length: 0                                                                             <br>
&nbsp;&nbsp;&nbsp;&nbsp;End of Extension&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                              <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1... .... .... .... = Compulsory Flag: True                                                     <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;..00 0000 0000 0000 = Extension Type: 0x0000                                                    <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Extension length: 0                                                                             <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                              <br>
</code></div>
</p>

<h4>Routing Protocols</h4>
<p>
In DMVPN phase 3, if EIGRP is configured as the routing protocol over the overlay 
network, EIGRP, by default, changes the next-hop to the router it is running on.
In phase 3, the configuration of <code><b>next-hop-self</b></code> feature is 
usually ignored as the redirect on the NHS and shortcut on NHC will take care of 
spoke to spoke communication; its presence or absence in NHS configuration has no 
effect on the next-hop behaviour.
</p>

<p>
It is important to note that control-plane and IP multicast traffic still go 
through the hub regardless of DMVPN phase. This means that if an IGP such as 
OSPF is configured, the NHS should be configured as the Designated Router (DR) 
to distribute updates to the NHCs. With EIGRP, the next-hop-self feature should
be disabled in order for the Phase 3 redirects to be successful.

All neighborships of IGPs are with the NHS. NHCs cannot form IGP neighborships 
as they do not send multicast traffic to each other.
</p>

<h4>Summarization</h4>
<p>
In phase 3, when summarisation is implemented at the hub, this gets advertised to 
the spokes with the hub as the next-hop. 
</p>

<p>
When summary routes are configured on routers the summary routes hide network 
convergence. The summary route is installed on the NHS tunnel IP (through EIGRP) 
and advertised to spokes. This reduces the unnecessary traffic entering the tunnel 
as remote NHCs do not have to receive the EIGRP updates or queries on routes 
internal to the NHS subnet. Also, convergence in the internal subnets of NHCs do
not get sent to other NHCs by the NHSs.

When an NHRP redirect occurs, NHRP will install a more specific route to the 
remote NHC hence no NHO occurs.

Both entries in <code><b>show dmvpn detail</b></code> will be DT1 and not DT2 showing no next-hop-override occurs.
</p>

<p>
<div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
 <code>
HUB(config)#<b>router eigrp EIGRP_HUB</b> <br>
HUB(config-router)#<b>address-family ipv4 unicast auto 1</b><br>
HUB(config-router-af)#<b>af-interface tunnel0</b><br>
HUB(config-router-af-interface)#<b>summary-address 10.7.0.0/16</b><br>
 </code></div>
</p>

<p>
The spokes will receive this summary route from the hub: 
</p>
<p>
<div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
 <code>
SPOKE2#<b>show ip route eigrp</b>                                               <br>
Codes: L - local, C - connected, S - static, R - RIP, M - mobile, B - BGP       <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; D - EIGRP, EX - EIGRP external, O - OSPF, IA - OSPF inter area           <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; N1 - OSPF NSSA external type 1, N2 - OSPF NSSA external type 2           <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; E1 - OSPF external type 1, E2 - OSPF external type 2                     <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; i - IS-IS, su - IS-IS summary, L1 - IS-IS level-1, L2 - IS-IS level-2    <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ia - IS-IS inter area, * - candidate default, U - per-user static route  <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; o - ODR, P - periodic downloaded static route, H - NHRP, l - LISP        <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; + - replicated route, % - next hop override                              <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                        <br>
Gateway of last resort is not set&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                       <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                        <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10.0.0.0/8 is variably subnetted, 21 subnets, 3 masks                     <br>
D&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10.1.10.0/24 [90/76800640] via 172.30.1.1, 04:23:39, Tunnel0           <br>
D&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10.1.11.0/24 [90/76800640] via 172.30.1.1, 04:23:39, Tunnel0           <br>
D&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10.1.12.0/24 [90/76800640] via 172.30.1.1, 04:23:39, Tunnel0           <br>
<span style="background:#d3d3d3;">D&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10.7.0.0/16 [90/104960000] via 172.30.1.1, 00:00:14, Tunnel0</span><br>
D&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10.8.10.0/24 [90/104960000] via 172.30.1.8, 03:24:09, Tunnel0 <br>
D&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10.8.11.0/24 [90/104960000] via 172.30.1.8, 03:24:09, Tunnel0 <br>
D&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10.8.12.0/24 [90/104960000] via 172.30.1.8, 03:24:09, Tunnel0 <br>
</code></div>
</p>

<p>
If the spokes send or receive traffic from a host in a component network of the 
summary address, NHRP installs a more specific route in the routing table 
that is identified with the code ‘H’.
</p>
<p>
<div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
 <code>
SPOKE2#<b>ping 10.7.10.1</b><br>
Type escape sequence to abort.<br>
Sending 5, 100-byte ICMP Echos to 10.7.10.1, timeout is 2 seconds:<br>
!!!!!<br>
Success rate is 100 percent (5/5), round-trip min/avg/max = 40/85/152 ms<br>
SPOKE2#<b>show ip route</b>                                                    <br>
Codes: L - local, C - connected, S - static, R - RIP, M - mobile, B - BGP      <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; D - EIGRP, EX - EIGRP external, O - OSPF, IA - OSPF inter area          <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; N1 - OSPF NSSA external type 1, N2 - OSPF NSSA external type 2          <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; E1 - OSPF external type 1, E2 - OSPF external type 2                    <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; i - IS-IS, su - IS-IS summary, L1 - IS-IS level-1, L2 - IS-IS level-2   <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ia - IS-IS inter area, * - candidate default, U - per-user static route <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; o - ODR, P - periodic downloaded static route, H - NHRP, l - LISP       <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; + - replicated route, % - next hop override                             <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                         <br>
Gateway of last resort is not set&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                        <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                         <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10.0.0.0/8 is variably subnetted, 22 subnets, 3 masks                    <br>
D&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10.1.10.0/24 [90/76800640] via 172.30.1.1, 04:24:14, Tunnel0          <br>
D&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10.1.11.0/24 [90/76800640] via 172.30.1.1, 04:24:14, Tunnel0          <br>
D&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10.1.12.0/24 [90/76800640] via 172.30.1.1, 04:24:14, Tunnel0          <br>
C&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10.2.10.0/24 is directly connected, Loopback10                        <br>
L&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10.2.10.1/32 is directly connected, Loopback10                        <br>
C&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10.2.11.0/24 is directly connected, Loopback11                        <br>
L&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10.2.11.1/32 is directly connected, Loopback11                        <br>
C&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10.2.12.0/24 is directly connected, Loopback12                        <br>
L&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10.2.12.1/32 is directly connected, Loopback12                        <br>
C&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10.2.13.0/24 is directly connected, Loopback13                        <br>
L&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10.2.13.1/32 is directly connected, Loopback13                        <br>
D&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10.7.0.0/16 [90/104960000] via 172.30.1.1, 00:00:49, Tunnel0          <br>
<span style="background:#d3d3d3;">H&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  10.7.10.0/24 [250/1] via 172.30.1.7, 00:00:04, Tunnel0</span><br>
D&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10.8.10.0/24 [90/104960000] via 172.30.1.8, 03:24:44, Tunnel0 <br>
D&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10.8.11.0/24 [90/104960000] via 172.30.1.8, 03:24:44, Tunnel0 <br>
D&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10.8.12.0/24 [90/104960000] via 172.30.1.8, 03:24:44, Tunnel0 <br>
!output omitted...<br><br>
SPOKE2#<b>show ip route 10.7.10.0</b>                      <br>
Routing entry for 10.7.10.0/24                             <br>
&nbsp;&nbsp;Known via "nhrp", distance 250, metric 1                 <br>
&nbsp;&nbsp;Last update from 172.30.1.7 on Tunnel0, 00:03:17 ago     <br>
&nbsp;&nbsp;Routing Descriptor Blocks:                               <br>
&nbsp;&nbsp;* 172.30.1.7, from 172.30.1.7, 00:03:17 ago, via Tunnel0 <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Route metric is 1, traffic share count is 1          <br>
</code></div>
</p>
<p>
The <code><b>ip nhrp shortcut</b></code> command on the spoke is required for 
the installation of NHRP routes in the routing table. NHRP installed routes have 
an administrative distance (AD) of 250.
</p>
<p>
This NHRP installed route is also reflected in the NHRP table:
</p>
<p>
<div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
 <code>
SPOKE2#<b>show ip nhrp</b>                            <br>   
10.7.10.0/24 via 172.30.1.7                           <br>
&nbsp;&nbsp; Tunnel0 created 00:00:21, expire 01:59:37<br>      
&nbsp;&nbsp; Type: dynamic, <span style="background:#d3d3d3;">Flags: router used rib</span><br>      
&nbsp;&nbsp; NBMA address: 99.255.60.6                <br>      
172.30.1.1/32 via 172.30.1.1                          <br>
&nbsp;&nbsp; Tunnel0 created 04:35:26, never expire   <br>      
&nbsp;&nbsp; Type: static, Flags: used                <br>      
&nbsp;&nbsp; NBMA address: 99.255.10.2
</code></div>
</p>

<p>
In the NHRP table, entries have the flag "rib" indicating that a route has been
generated and installed in the routing table.
</p>
<p>
In the output of the DMVPN mapping table, NHRP installed routes have the flag 
<code><b>DT1</b></code>.
<p>
<div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
 <code>
SPOKE2#<b>show dmvpn detail</b>                                                                                     <br>
Legend: Attrb --&gt; S - Static, D - Dynamic, I - Incomplete&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;N - NATed, L - Local, X - No Socket&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;         <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Ent --&gt; Number of NHRP entries with same NBMA peer&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;         <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NHS Status: E --&gt; Expecting Replies, R --&gt; Responding, W --&gt; Waiting&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;         <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UpDn Time --&gt; Up or Down Time for a Tunnel&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;         <br>
==========================================================================&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          <br>
Interface Tunnel0 is up/up, Addr. is 172.30.1.2, VRF ""&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;         <br>
&nbsp;&nbsp; Tunnel Src./Dest. addr: 99.255.30.1/MGRE, Tunnel VRF ""&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          <br>
&nbsp;&nbsp; Protocol/Transport: "multi-GRE/IP", Protect ""&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;         <br>
&nbsp;&nbsp; Interface State Control: Disabled&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          <br>
&nbsp;&nbsp; nhrp event-publisher : Disabled&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          <br>
IPv4 NHS:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;         <br>
172.30.1.1&nbsp;&nbsp;RE NBMA Address: 99.255.10.2 priority = 0 cluster = 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;         <br>
Type:Spoke, Total NBMA Peers (v4/v6): 3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;         <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          <br>
# Ent&nbsp;&nbsp;Peer NBMA Addr Peer Tunnel Add State&nbsp;&nbsp;UpDn Tm Attrb&nbsp;&nbsp;&nbsp;&nbsp;Target Network&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          <br>
----- --------------- --------------- ----- -------- ----- -----------------&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          <br>
&nbsp;&nbsp;&nbsp;&nbsp;1 99.255.60.6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;172.30.1.7&nbsp;&nbsp;&nbsp;&nbsp;UP 00:40:42&nbsp;&nbsp;<span style="background:#d3d3d3;">DT1</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 10.7.10.0/24  <br>
&nbsp;&nbsp;&nbsp;&nbsp;2 99.255.60.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;172.30.1.8&nbsp;&nbsp;&nbsp;&nbsp;UP 00:03:29&nbsp;&nbsp;DT2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 10.8.10.0/24&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;99.255.60.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;172.30.1.8&nbsp;&nbsp;&nbsp;&nbsp;UP 00:03:29&nbsp;&nbsp;&nbsp;&nbsp;D&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;172.30.1.8/32&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          <br>
&nbsp;&nbsp;&nbsp;&nbsp;1 99.255.10.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;172.30.1.1&nbsp;&nbsp;&nbsp;&nbsp;UP 05:15:48&nbsp;&nbsp;&nbsp;&nbsp;S&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;172.30.1.1/32&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          <br>
Crypto Session Details:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;         <br>
--------------------------------------------------------------------------------&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          <br>
Pending DMVPN Sessions:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;         <br>
</code></div>
</p>
<p>
One key limitation of OSPF as the overlay protocol is that all the tunnel interfaces 
must be in the same area. Due to OSPF's strict summarization policies that do 
not permit summarization in an area, the spokes will have to receive all the 
routes in the same area as on the hub. Because of this, EIGRP and BGP have an 
edge of OSPF and IS-IS(link-state protocols) as the preferred overlay routing 
protocol.
</p>

<h4>Next-hop Override</h4>
<p>
When the shortcut feature has been applied to a specific route, if the prefixes 
are more specific, then the route learned through the overlay 
routing protocol will have the next-hop override flag(%) is set.
</p>
<p>
NHRP manipulates the routing table as necessary. An installed route is indicated 
by the code <code><b>‘H’</b></code>. A next hop override is indicated by the
code <code><b>‘%’</b></code>. To display 
explicit NHRP shortcuts, <code><b>show ip route next-hop-override</b></code>. 
The shortcut has a symbol <code><b>NHO</b></code> and has a lower metric (255).
On the routing table, the route with the next-hop-override still displays its 
original next-hop. However, to confirm that this next-hop is overridden, use the 
command <code><b>ip cef &lt;prefix&gt;</b></code>.
</p>
<p>
<div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
 <code>
SPOKE2#<b>ping 10.8.10.1</b>                                                          <br>            
Type escape sequence to abort.                                                        <br>     
Sending 5, 100-byte ICMP Echos to 10.8.10.1, timeout is 2 seconds:                    <br>     
!!!!!                                                                                 <br>     
Success rate is 100 percent (5/5), round-trip min/avg/max = 20/39/48 ms               <br>     
SPOKE2#                                                                               <br>     
SPOKE2#<b>show ip route eigrp</b>                                                     <br>            
Codes: L - local, C - connected, S - static, R - RIP, M - mobile, B - BGP&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;     <br>     
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; D - EIGRP, EX - EIGRP external, O - OSPF, IA - OSPF inter area&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;     <br>     
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; N1 - OSPF NSSA external type 1, N2 - OSPF NSSA external type 2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;     <br>     
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; E1 - OSPF external type 1, E2 - OSPF external type 2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;     <br>     
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; i - IS-IS, su - IS-IS summary, L1 - IS-IS level-1, L2 - IS-IS level-2&nbsp;&nbsp;&nbsp;&nbsp;      <br>     
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ia - IS-IS inter area, * - candidate default, U - per-user static route&nbsp;&nbsp;      <br>     
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; o - ODR, P - periodic downloaded static route, H - NHRP, l - LISP&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      <br>     
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; + - replicated route, % - next hop override&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      <br>     
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      <br>     
Gateway of last resort is not set&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;     <br>     
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      <br>     
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10.0.0.0/8 is variably subnetted, 22 subnets, 3 masks&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;     <br>     
D&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10.1.10.0/24 [90/76800640] via 172.30.1.1, 05:20:53, Tunnel0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;     <br>     
D&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10.1.11.0/24 [90/76800640] via 172.30.1.1, 05:20:53, Tunnel0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;     <br>     
D&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10.1.12.0/24 [90/76800640] via 172.30.1.1, 05:20:54, Tunnel0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;     <br>     
D&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10.7.0.0/16 [90/104960000] via 172.30.1.1, 00:57:29, Tunnel0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;     <br>     
<span style="background:#d3d3d3;">D&nbsp;&nbsp; %&nbsp;&nbsp;&nbsp;&nbsp;10.8.10.0/24 [90/104960000] via 172.30.1.8, 04:21:24, Tunnel0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      <br>     
D&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10.8.11.0/24 [90/104960000] via 172.30.1.8, 04:21:24, Tunnel0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      <br>     
D&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10.8.12.0/24 [90/104960000] via 172.30.1.8, 04:21:24, Tunnel0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      <br>     
SPOKE2#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;     <br>     
SPOKE2#<b>show ip route 10.8.10.0</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;     <br>            
Routing entry for 10.8.10.0/24&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      <br>     
&nbsp;&nbsp;Known via "eigrp 1", distance 90, metric 104960000, type internal&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;     <br>     
&nbsp;&nbsp;Redistributing via eigrp 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      <br>     
&nbsp;&nbsp;Last update from 172.30.1.8 on Tunnel0, 04:21:27 ago&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      <br>     
&nbsp;&nbsp;Routing Descriptor Blocks:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      <br>     
&nbsp;&nbsp;* 172.30.1.8, from 172.30.1.1, 04:21:27 ago, via Tunnel0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      <br>     
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Route metric is 104960000, traffic share count is 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;     <br>     
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Total delay is 105000 microseconds, minimum bandwidth is 100 Kbit&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;     <br>     
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Reliability 255/255, minimum MTU 1400 bytes&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;     <br>     
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Loading 2/255, Hops 2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;     <br>     
SPOKE2#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;     <br>     
SPOKE2#<b>show dmvpn detail</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;     <br>            
Legend: Attrb --&gt; S - Static, D - Dynamic, I - Incomplete&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;         <br>     
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;N - NATed, L - Local, X - No Socket&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;     <br>     
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Ent --&gt; Number of NHRP entries with same NBMA peer&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        <br>     
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NHS Status: E --&gt; Expecting Replies, R --&gt; Responding, W --&gt; Waiting          <br>     
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UpDn Time --> Up or Down Time for a Tunnel&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      <br>     
==========================================================================&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      <br>     
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      <br>     
Interface Tunnel0 is up/up, Addr. is 172.30.1.2, VRF ""&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;     <br>     
&nbsp;&nbsp; Tunnel Src./Dest. addr: 99.255.30.1/MGRE, Tunnel VRF ""&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      <br>     
&nbsp;&nbsp; Protocol/Transport: "multi-GRE/IP", Protect ""&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;     <br>     
&nbsp;&nbsp; Interface State Control: Disabled&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      <br>     
&nbsp;&nbsp; nhrp event-publisher : Disabled&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      <br>     
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      <br>     
IPv4 NHS:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;     <br>     
172.30.1.1&nbsp;&nbsp;RE NBMA Address: 99.255.10.2 priority = 0 cluster = 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;     <br>     
Type:Spoke, Total NBMA Peers (v4/v6): 3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;     <br>     
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      <br>     
# Ent&nbsp;&nbsp;Peer NBMA Addr Peer Tunnel Add State&nbsp;&nbsp;UpDn Tm Attrb&nbsp;&nbsp;&nbsp;&nbsp;Target Network&nbsp;&nbsp;&nbsp;&nbsp;      <br>     
----- --------------- --------------- ----- -------- ----- -----------------&nbsp;&nbsp;&nbsp;&nbsp;      <br>     
&nbsp;&nbsp;&nbsp;&nbsp;1 99.255.60.6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;172.30.1.7&nbsp;&nbsp;&nbsp;&nbsp;UP 00:56:58&nbsp;&nbsp;DT1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 10.7.10.0/24&nbsp;&nbsp;&nbsp;&nbsp;      <br>     
&nbsp;&nbsp;&nbsp;&nbsp;<span style="background:#d3d3d3;">2 99.255.60.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;172.30.1.8&nbsp;&nbsp;&nbsp;&nbsp;UP 00:19:45&nbsp;&nbsp;DT2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 10.8.10.0/24</span>&nbsp;&nbsp;&nbsp;&nbsp;      <br>     
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;99.255.60.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;172.30.1.8&nbsp;&nbsp;&nbsp;&nbsp;UP 00:19:45&nbsp;&nbsp;&nbsp;&nbsp;D&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;172.30.1.8/32&nbsp;&nbsp;&nbsp;&nbsp;      <br>     
&nbsp;&nbsp;&nbsp;&nbsp;1 99.255.10.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;172.30.1.1&nbsp;&nbsp;&nbsp;&nbsp;UP 05:32:04&nbsp;&nbsp;&nbsp;&nbsp;S&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;172.30.1.1/32&nbsp;&nbsp;&nbsp;&nbsp;      <br>     
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      <br>    
!Some output omitted                                                                  <br>
</code></div>
</p>
<p>
The next-hop override flag is also set in the NHRP table for this route:
</p>
<p>
<div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
 <code>
SPOKE2#<b>show ip nhrp detail</b>             <br>
10.7.10.0/24 via 172.30.1.7                   <br>
&nbsp;&nbsp; Tunnel0 created 01:12:43, expire 00:47:15  <br>
&nbsp;&nbsp; Type: dynamic, Flags: router used rib      <br>
&nbsp;&nbsp; NBMA address: 99.255.60.6                  <br>
10.8.10.0/24 via 172.30.1.8                   <br>
&nbsp;&nbsp; Tunnel0 created 00:35:30, expire 01:24:29  <br>
&nbsp;&nbsp; <span style="background:#d3d3d3;">Type: dynamic, Flags: router used rib nho</span><br>
&nbsp;&nbsp; NBMA address: 99.255.60.2                  <br>
172.30.1.1/32 via 172.30.1.1                  <br>
&nbsp;&nbsp; Tunnel0 created 05:47:49, never expire     <br>
&nbsp;&nbsp; Type: static, Flags: used                  <br>
&nbsp;&nbsp; NBMA address: 99.255.10.2                  <br>
172.30.1.8/32 via 172.30.1.8                  <br>
&nbsp;&nbsp; Tunnel0 created 00:35:30, expire 01:24:29  <br>
&nbsp;&nbsp; Type: dynamic, Flags: router used          <br>
&nbsp;&nbsp; NBMA address: 99.255.60.2
</code></div>
</p>
<p>

</p>

<h1>Routing in DMVPN</h1>
<p>
DMVPN was developed by Cisco Systems with EIGRP in mind, as a routing protocol. 
To fully utilise the features of DMVPN, EIGRP is recommended as the routing 
protocol of the overlay network. However, other routing protocols such as OSPF, 
RIP, IS-IS can be used as routing protocols as well in DMVPN configurations.

If using EIGRP for the internal networks, split horizon needs to be disabled 
on the tunnel interface.

As EIGRP always maintain loop-free routes using the feasibility condition, 
disabling split-horizon does not introduce loops. However, it might be 
preferrable to disable it entirely.
</p>
<p>
<div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
 <code>
HUB#<b>configure terminal</b>                       <br>
HUB(config)#<b>interface tunnel 10</b>              <br>
HUB(config-if)#<b>no ip split-horizon eigrp 100</b> <br>
HUB(config-if)#<b>no ip next-hop-self eigrp 100</b>
</code></div>
</p>
<p> 
When configuring a routing protocol over the overlay network, never advertise 
the underlay network in routing protocol over the overlay network.
</p>

<h1 id="VERIFICATION">Verification of DMVPN</h1>
<p>

</p>

<h2>Viewing DMVPN Tunnel States</h2>
<p>
The tunnel interface experiences varying states based on the stage of tunnel 
creation or if the tunnel experienced problems during establishment or operation. 
Addition of encryption to the tunnel also affects the state of the DMVPN tunnels. 
</p>

<h3><code>show dmvpn interface &lt;interface&gt; detail</b></code> </h3>
<p>
The specified interface is the tunnel interface.
</p>

<p>
This command displays tunnel interface, role, state, peers and uptime.

Tunnel states can be any of the following:
<ol>
  <li><b>INTF:</b> Line protocol of DMVPN tunnel is down</li>
  <li><b>IKE:</b> DMVPN tunnels configured with IPSec have not yet successfully established an IKE session.</li>
  <li><b>IPSec:</b> An IKE session is established but an IPSec SA has not yet been established.</li>
  <li><b>NHRP:</b> The DMVPN spoke router has not yet successfully registered.</li>
  <li><b>Up:</b> Spoke has registered with hub and received ACK (positive registration reply). 
  An up interface state must be maintained for traffic to flow. 
</ol>
</p>
<p>

<p>
<div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
 <code>
SPOKE8#<b>show dmvpn interface tunnel0 detail</b>                                    <br>
Legend: Attrb --&gt; S - Static, D - Dynamic, I - Incomplete                         <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;N - NATed, L - Local, X - No Socket&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                  <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Ent --&gt; Number of NHRP entries with same NBMA peer&nbsp;&nbsp;&nbsp;&nbsp;                  <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NHS Status: E --&gt; Expecting Replies, R --&gt; Responding, W --&gt; Waiting<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UpDn Time --&gt; Up or Down Time for a Tunnel&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                  <br>
==========================================================================           <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                   <br>
Interface Tunnel0 is up/up, Addr. is 172.30.1.8, VRF ""&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                  <br>
&nbsp;&nbsp; Tunnel Src./Dest. addr: 99.255.60.2/MGRE, Tunnel VRF ""&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                   <br>
&nbsp;&nbsp; Protocol/Transport: "multi-GRE/IP", Protect ""&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                  <br>
&nbsp;&nbsp; Interface State Control: Disabled&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                   <br>
&nbsp;&nbsp; nhrp event-publisher : Disabled&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                   <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                   <br>
IPv4 NHS:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                  <br>
172.30.1.1&nbsp;&nbsp;RE NBMA Address: 99.255.10.2 priority = 0 cluster = 0&nbsp;&nbsp;                  <br>
Type:Spoke, Total NBMA Peers (v4/v6): 4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                  <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                   <br>
# Ent&nbsp;&nbsp;Peer NBMA Addr Peer Tunnel Add State&nbsp;&nbsp;UpDn Tm Attrb&nbsp;&nbsp;&nbsp;&nbsp;Target Network         <br>
----- --------------- --------------- ----- -------- ----- -----------------         <br>
&nbsp;&nbsp;&nbsp;&nbsp;1 99.255.10.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;172.30.1.1&nbsp;&nbsp;&nbsp;&nbsp;UP 00:21:37&nbsp;&nbsp;&nbsp;&nbsp;S&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;172.30.1.1/32         <br>
&nbsp;&nbsp;&nbsp;&nbsp;1 99.255.30.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;172.30.1.2&nbsp;&nbsp;&nbsp;&nbsp;UP 00:06:04&nbsp;&nbsp;&nbsp;&nbsp;D&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;172.30.1.2/32         <br>
&nbsp;&nbsp;&nbsp;&nbsp;1 99.255.60.6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;172.30.1.7&nbsp;&nbsp;&nbsp;&nbsp;UP 00:21:20&nbsp;&nbsp;&nbsp;&nbsp;D&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;172.30.1.7/32         <br>
&nbsp;&nbsp;&nbsp;&nbsp;1 99.255.60.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;172.30.1.8&nbsp;&nbsp;&nbsp;&nbsp;UP 00:21:20&nbsp;&nbsp;DLX&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;172.30.1.8/32         <br>

    </code></div>
</p>

<h3><code>show dmvpn detail</code></h3>

<p>
Run from the hub displays the mapping between the tunnel address and NBMA address.
This command displays local tunnel and NBMA ip addresses, tunnel health 
monitoring and VRF contexts IPSec crypto info.
</p>
<p>
<div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
 <code>
SPOKE8#<b>show dmvpn detail</b>                                                       <br>
Legend: Attrb --&gt; S - Static, D - Dynamic, I - Incomplete                          <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;N - NATed, L - Local, X - No Socket&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                   <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Ent --&gt; Number of NHRP entries with same NBMA peer&nbsp;&nbsp;&nbsp;&nbsp;                   <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NHS Status: E --&gt; Expecting Replies, R --&gt; Responding, W --&gt; Waiting <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UpDn Time --&gt; Up or Down Time for a Tunnel&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                   <br>
==========================================================================            <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                  <br>
Interface Tunnel0 is up/up, Addr. is 172.30.1.8, VRF ""&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                   <br>
&nbsp;&nbsp; Tunnel Src./Dest. addr: 99.255.60.2/MGRE, Tunnel VRF ""&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                  <br>
&nbsp;&nbsp; Protocol/Transport: "multi-GRE/IP", Protect ""&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                   <br>
&nbsp;&nbsp; Interface State Control: Disabled&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                  <br>
&nbsp;&nbsp; nhrp event-publisher : Disabled&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                  <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                  <br>
IPv4 NHS:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                   <br>
172.30.1.1&nbsp;&nbsp;RE NBMA Address: 99.255.10.2 priority = 0 cluster = 0&nbsp;&nbsp;                   <br>
Type:Spoke, Total NBMA Peers (v4/v6): 4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                   <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                  <br>
# Ent&nbsp;&nbsp;Peer NBMA Addr Peer Tunnel Add State&nbsp;&nbsp;UpDn Tm Attrb&nbsp;&nbsp;&nbsp;&nbsp;Target Network          <br>
----- --------------- --------------- ----- -------- ----- -----------------          <br>
&nbsp;&nbsp;&nbsp;&nbsp;1 99.255.10.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;172.30.1.1&nbsp;&nbsp;&nbsp;&nbsp;UP 00:25:40&nbsp;&nbsp;&nbsp;&nbsp;S&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;172.30.1.1/32          <br>
&nbsp;&nbsp;&nbsp;&nbsp;1 99.255.30.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;172.30.1.2&nbsp;&nbsp;&nbsp;&nbsp;UP 00:10:07&nbsp;&nbsp;&nbsp;&nbsp;D&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;172.30.1.2/32          <br>
&nbsp;&nbsp;&nbsp;&nbsp;1 99.255.60.6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;172.30.1.7&nbsp;&nbsp;&nbsp;&nbsp;UP 00:25:22&nbsp;&nbsp;&nbsp;&nbsp;D&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;172.30.1.7/32          <br>
&nbsp;&nbsp;&nbsp;&nbsp;1 99.255.60.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;172.30.1.8&nbsp;&nbsp;&nbsp;&nbsp;UP 00:25:22&nbsp;&nbsp;DLX&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;172.30.1.8/32          <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                  <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                  <br>
Crypto Session Details:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                   <br>
--------------------------------------------------------------------------------      <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                  <br>
Pending DMVPN Sessions:                                                               <br>
</code></div>
</p>

</p>
<h2>Viewing the NHRP Cache</h2>
<p>

</p>

<h3><code>show ip nhrp [brief | detail]</code></h3>
<p>
The displays the local NHRP cache. The <code><b>detail</b></code> keyword lists routers that submitted
an NHRP request and its request ID. The NHRP cache displays NHRP mapping entries and NHRP message flags.
</p>
<p>
<div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
 <code>
SPOKE8#<b>show ip nhrp brief</b>                                             <br>
&nbsp;&nbsp; Target&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Via&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NBMA&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Mode&nbsp;&nbsp; Intfc&nbsp;&nbsp; Claimed&nbsp;&nbsp; <br>
172.30.1.1/32&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;172.30.1.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;99.255.10.2&nbsp;&nbsp;&nbsp;&nbsp; static&nbsp;&nbsp; Tu0&nbsp;&nbsp;&nbsp;&nbsp; &lt;&nbsp;&nbsp; &gt;  <br>
172.30.1.2/32&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;172.30.1.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;99.255.30.1&nbsp;&nbsp;&nbsp;&nbsp; dynamic&nbsp;&nbsp;Tu0&nbsp;&nbsp;&nbsp;&nbsp; &lt;&nbsp;&nbsp; &gt;  <br>
172.30.1.7/32&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;172.30.1.7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;99.255.60.6&nbsp;&nbsp;&nbsp;&nbsp; dynamic&nbsp;&nbsp;Tu0&nbsp;&nbsp;&nbsp;&nbsp; &lt;&nbsp;&nbsp; &gt;  <br>
172.30.1.8/32&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;172.30.1.8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;99.255.60.2&nbsp;&nbsp;&nbsp;&nbsp; dynamic&nbsp;&nbsp;Tu0&nbsp;&nbsp;&nbsp;&nbsp; &lt;&nbsp;&nbsp; &gt;  <br>
SPOKE8#                                                                      <br>
SPOKE8#<b>show ip nhrp detail</b>                                            <br>
172.30.1.1/32 via 172.30.1.1                                                 <br>
&nbsp;&nbsp; Tunnel0 created 00:33:52, never expire                                    <br>
&nbsp;&nbsp; Type: static, Flags: used                                                 <br>
&nbsp;&nbsp; NBMA address: 99.255.10.2                                                 <br>
172.30.1.2/32 via 172.30.1.2                                                 <br>
&nbsp;&nbsp; Tunnel0 created 00:18:18, expire 01:41:41                                 <br>
&nbsp;&nbsp; Type: dynamic, Flags: router used                                         <br>
&nbsp;&nbsp; NBMA address: 99.255.30.1                                                 <br>
172.30.1.7/32 via 172.30.1.7                                                 <br>
&nbsp;&nbsp; Tunnel0 created 00:33:34, expire 01:26:25                                 <br>
&nbsp;&nbsp; Type: dynamic, Flags: router implicit used                                <br>
&nbsp;&nbsp; NBMA address: 99.255.60.6                                                 <br>
172.30.1.8/32 via 172.30.1.8                                                 <br>
&nbsp;&nbsp; Tunnel0 created 00:33:34, expire 01:26:25                                 <br>
&nbsp;&nbsp; Type: dynamic, Flags: router unique local                                 <br>
&nbsp;&nbsp; NBMA address: 99.255.60.2                                                 <br>
&nbsp;&nbsp;&nbsp;&nbsp;(no-socket)                                                              <br>
&nbsp;&nbsp;Requester: 172.30.1.7 Request ID: 7                                        <br>
SPOKE8#
</code></div>
</p>
<p>
The local NHRP cache contains:
<ol>
  <li>Network entry for hosts (/32 or 128) or subnets (/24, /25, /16) and tunnel to NBMA address.</li>
  <li>Interface number, duration of tunnel existence. Included is the amount of time 
to expiry of the tunnel for dynamic entries. Static entries do not expire.</li>
<li>NHRP mapping types;
<ul>
  <li><b>Static:</b> an entry created statically, on tunnel interface.</li>
  <li><b>Dynamic:</b> an entry created from a spoke that register.</li>
  <li><b>Incomplete:</b> a temporary entry placed locally while an NHRP resolution request is processing.</li>
  <li><b>Local:</b> a typical entry is of a local network that was advertised for an NHRP resolution reply.</li>
  <li><b>(no socket):</b> These mapping entries do not have an associated IPSec 
  socket and encryption isn’t triggered yet.</li>
  <li><b>NBMA address:</b> transport IP address where the entry was received.</li>
</ul>
</li>
</ol>
</p>
<p>
NHRP message flags specify attributes of an NHRP cache entry or of the peer for which the entry was created.
<ol>
  <li><b>Used:</b> this NHRP mapping was used to forward data packets within last 60 seconds.</li>
  <li><b>Implicit:</b> Mapping entry was learned implicitly for example source 
  mapping information gleaned from an NHRP resolution request was received by 
  local router or forwarded through local router.</li>
  <li><b>Unique:</b> This mapping entry must be unique and can’t be overwritten 
  with a mapping entry that has the same tunnel IP address but different NBMA address.</li>
  <li><b>Router:</b> mapping entry is from a remote router that provides access 
  to a network or host behind the remote router.</li>
  <li><b>Rib:</b> mapping entry has a corresponding routing entry in the routing table [H].</li>
  <li><b>Nho:</b> mapping entry has a corresponding path overriding the next hop
  for a remote network as installed by another routing protocol.</li>
  <li><b>Nhop:</b> Mapping entry for remote next hop address for remote tunnel 
  interface and its associated NBMA address.</li>
</ol>
</p>

<h3><code>show ip nhrp traffic</code></h3>
<p>
The <code><b>show ip nhrp traffic</b></code> command is used to view the 
statistics on NHRP packets sent and received.
</p>
<p>
<div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
 <code>
HUB#<b>show ip nhrp traffic</b><br>
Tunnel0: Max-send limit:100Pkts/10Sec, Usage:0%                           <br>
&nbsp;&nbsp; Sent: Total 16&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;             <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 8 Resolution Request&nbsp;&nbsp;0 Resolution Reply&nbsp;&nbsp;0 Registration Request <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4 Registration Reply&nbsp;&nbsp;0 Purge Request&nbsp;&nbsp;0 Purge Reply             <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0 Error Indication&nbsp;&nbsp;4 Traffic Indication&nbsp;&nbsp;0 Redirect Suppress    <br>
&nbsp;&nbsp; Rcvd: Total 12&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;             <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 8 Resolution Request&nbsp;&nbsp;0 Resolution Reply&nbsp;&nbsp;4 Registration Request <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0 Registration Reply&nbsp;&nbsp;0 Purge Request&nbsp;&nbsp;0 Purge Reply             <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0 Error Indication&nbsp;&nbsp;0 Traffic Indication&nbsp;&nbsp;0 Redirect Suppress    <br>
</code></div>
</p>


<h2>Overlay Routes</h2>
<p>

</p>

<h3><code>show ip route</code></h3>
<p>
Overlay routes have the tunnel interface as the exit interface.
</p>

<h1 id="OPTIMIZATION">Optimization of DMVPN Operation</h1>
<p>

</p>

<h2>Unique IP NHRP Registration</h2>
<p>
During registration, NHCs instruct NHS to keep their NBMA address unique. If a 
loss of connectivity occurs between the NHC and NHS and a new NBMA address is 
given to the NHC, say through DHCP, before the NHRP NHC cache timeout, the new 
registration is blocked. This can be suppressed by using the command; 
<code><b>ip nhrp registration no-unique</b></code> on the NHC tunnel interface. 
Verify using the command <code><b>show ip nhrp 10.100.100.8</b></code>.
</p>

<h2>Recursive Routing Problems</h2>
<p>
Recursive routing happens when the transport/NBMA network is advertised into the same routing
protocol that runs on the overlay network. One of the main preconditions for 
recursive routing is the routing protocol in the overlay network having a lower 
Administrative Distance (AD) than the routing protocol being used in the underlay
network. An example of this can be where EIGRP is running on the overlay network 
and OSPF in the underlay network.
</p>
<p>
The two routers that have a DMVPN tunnel formed will share their routes using 
the EIGRP over the tunnel. EIGRP having an AD (90) lower than OSPF (110) will 
have its underlay route selected as the preferred route over the OSPF route by 
the remote router. This remote router will attempt to route underlay traffic 
through the tunnel. This will obviously fail. As it keeps attempting to route 
underlay traffic through the tunnel, the OSPF neighborship in the underlay 
network times out and gets terminated. As the router loses the tunnel, it creates
a new OSPF neighborship with its underlay neighbor resulting in the reformation
of the tunnel. Then EIGRP sends the same update of the underlay network across 
the tunnel. This process repeats continuously.
</p>

<h3>Solution</h3>
<p>
<ul>
<li>Removing the transport network from the overlay routing protocol resolves
recursive routing.</li>
<li>Front-door VRF</li>
</ul>
</P>

<h2 id="FVRF"> Front-Door Virtual Route Forwarding (FVRF)</h2>
<p>
A DMVPN tunnel source or destination can be made to be separate from the DMVPN 
tunnel itself. The VRF associated with the transport network is known as front-foor
VRF. Using a front-door VRF for every DMVPN tunnel prevents route recursion because
the transport and overlay networks remain in separate routing tables. The transport 
network and interface can be associated with the transport VRF and the tunnel 
network and interface associated with the tunnel VRF.
</p>

<h3>Configuring FVRF</h3>
<p>
The VRF can be created using the older global configuration command 
<code><b>ip vrf &lt;vrf_name&gt;</b></code> or the newer global configuration command  
<code><b>vrf definition &lt;vrf_name&gt;</b></code> which supports IPv6 in 
addition to support for IPv4 through address families.
</p>
<p>
Front-door VRF can be configured using the following sequence of steps:
<ol>
<li>
<p>Create the front-door VRF; <code><b>ip vrf &lt;vrf_name&gt;</b></code>. If configuring
IPv6 FVRFs, use the command <code><b>vrf definition &lt;vrf_name&gt;</b></code> as it is the 
only command of the two that supports IPv6.
</p>
<p>
<div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
 <code>
SPOKE1(config)#<b>vrf definition FVRF</b><br>
SPOKE1(config-vrf)#<b>address-family ipv4</b>
</code></div>
</p>
<p>
If the VRF is created using the command <code><b>vrf definition &lt;vrf_name&gt;</b></code>, 
the appropriate address-family needs to be activated. In the above example, IPv4 
has been activated.
</p>
</li>
<li>
  <p>
  Associate the front-door FVRF to the interface; <code><b>vrf forwarding &lt;vrf_name&gt;</b></code>.
  </p>
  <p>
  <div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
 <code>
  SPOKE1(config-if)#<b>interface g0/0</b><br>
  SPOKE1(config-if)#<b>vrf forwarding FVRF</b><br>
  SPOKE1(config-if)#<b>ip address 99.255.20.2 255.255.255.252</b><br>
  </code></div>
  </p>
</li>
<li>
  <p>
  Make the DMVPN VRF-aware: <code><b>tunnel vrf &lt;fvrf_name&gt;</b></code>.
  </p>
  <p>
    <div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
 <code>
  SPOKE1(config)#<b>interface tunnel 0                        </b> <br>
  SPOKE1(config-if)#<b>ip address 172.30.1.100 255.255.255.0  </b> <br>
  SPOKE1(config-if)#<b>tunnel mode gre multipoint             </b> <br>
  SPOKE1(config-if)#<b>tunnel source g0/0                     </b> <br>
  SPOKE1(config-if)#<b>tunnel vrf FVRF                        </b>
</code></div>
  </p>
  </li>
</ol>
</p>
<p>
<b>Note:</b> FVRF interfaces with static IP addressing require only a static default route in
the FVRF context. Interfaces that receive addresses through DHCP do not require 
the configuration of a static route.
</p>
<p>
   <div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
 <code>
SPOKE1(config)#<b>ip route vrf FVRF 0.0.0.0 0.0.0.0 99.255.20.1</b>
</code></div>
</p>

<h3>Verification of FVRF</h3>
<p>
FVRF configuration and operation can be verified using the command 
<code><b>show dmvpn detail</b></code>.
</p>
<p>
 <div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
 <code>
SPOKE1#<b>show dmvpn detail</b>                                                       <br>
Legend: Attrb --&gt; S - Static, D - Dynamic, I - Incomplete&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;N - NATed, L - Local, X - No Socket&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;           <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Ent --&gt; Number of NHRP entries with same NBMA peer&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;           <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NHS Status: E --&gt; Expecting Replies, R --&gt; Responding, W --&gt; Waiting <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UpDn Time --&gt; Up or Down Time for a Tunnel&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;           <br>
==========================================================================&nbsp;&nbsp;          <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          <br>
Interface Tunnel0 is up/up, Addr. is 172.30.1.100, VRF ""&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;           <br>
&nbsp;&nbsp; Tunnel Src./Dest. addr: 99.255.20.2/MGRE, Tunnel VRF "FVRF"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          <br>
&nbsp;&nbsp; Protocol/Transport: "multi-GRE/IP", Protect ""&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;           <br>
&nbsp;&nbsp; Interface State Control: Disabled&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          <br>
&nbsp;&nbsp; nhrp event-publisher : Disabled&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          <br>
IPv4 NHS:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;           <br>
172.30.1.1&nbsp;&nbsp;RE priority = 0 cluster = 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;           <br>
Type:Spoke, Total NBMA Peers (v4/v6): 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;           <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          <br>
# Ent&nbsp;&nbsp;Peer NBMA Addr Peer Tunnel Add State&nbsp;&nbsp;UpDn Tm Attrb&nbsp;&nbsp;&nbsp;&nbsp;Target Network          <br>
----- --------------- --------------- ----- -------- ----- -----------------          <br>
&nbsp;&nbsp;&nbsp;&nbsp;1 99.255.10.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;172.30.1.1&nbsp;&nbsp;&nbsp;&nbsp;UP 00:25:24&nbsp;&nbsp;&nbsp;&nbsp;S&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;172.30.1.1/32          <br>
!output omitted
</code></div>
</p>

<h2>DMVPN Failure Detection and High Availability</h2>
<p>

</p>
<h3>Hold time</h3>
<p>
By default, an NHRP mapping stays in the NHRP cache for 7200 seconds (2 hours) 
(holdtime). It can be modified to the recommended value of 600 seconds using the
tunnel configuration command <code><b>ip nhrp holdtime &lt;1 – 65535&gt;</b></code>.
</p>

<h3>Multi-hub Topologies</h3>
<p>
Additional hubs can be added by additional mapping statements to the tunnel 
interface. A muti-hub topology increases redundancy and provides high availability.
</p>

<h3>NHRP Timeout</h3>
<p>
NHRP timeout period is one third of the holdtime period which is 2400 seconds. 
This can be changed with the command <code><b>ip nhrp registration timeout 240</b></code>.
</p>

<h1 id="DMVPN_IPv6">IPv6 DMVPN Configuration</h1>
<p>
IPv6 commands are similar to IPv4 commands. To create mGRE tunnels;
</p>
<p>
<div style="background-color:#f4f0ec; border-style:solid;border-width:1px;border-color:#D3D3D3">
 <code>
SPOKE8(config-if)#<b>tunnel mode gre multipoint ipv6</b>
</code></div>
</p>
<p>
A unique IPv6 link-local address should be assigned to the tunnel inteface when 
the tunnelling protocol is IPv6. IPv6 routing protocols use link-local addresses
to discover each other and install in the RIB.
</p>


<h2>IPv6 DMVPN Commands</h2>
<p>
<ul>
  <li><code><b>show ipv6 nhrp (brief|detail)</b></code></li>
  <li><code><b>show dmvpn [ipv6] [detail]</b></code></li>
  <li><code><b>show ipv6 nhrp traffic</b></code></li>
  <li><code><b>show ipv6 nhrp nhs detail</b></code></li>
</ul>
</p>

<h1 id="SECURITY"><a href="https://emmanueltoko.blogspot.com/2021/02/securingdmvpn-tunnels-with-ipsec-ikev1.html">Securing the DMVPN Tunnel with IPSec</a></h1>
<p>
Securing DMVPN tunnels is explained <a href="https://emmanueltoko.blogspot.com/2021/02/securingdmvpn-tunnels-with-ipsec-ikev1.html">here</a>.
</p>